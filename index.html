<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™ - ŸÖÿ™ÿ¨ÿ± ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™ ŸÅŸä ÿπŸÖÿßŸÜ</title>
    
    <!-- Firebase SDK v9 (ÿ£ÿ≠ÿØÿ´ ÿ•ÿµÿØÿßÿ±) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBDlQYnTunZMDwIFsysgPbmovHkPj0f3M8",
            authDomain: "wesamstorenew.firebaseapp.com",
            projectId: "wesamstorenew",
            storageBucket: "wesamstorenew.appspot.com",
            messagingSenderId: "956353010212",
            appId: "1:956353010212:web:2e5ee949fa8f4ea713d6b1",
            measurementId: "G-EDLFXHCPBB"
        };

        // ÿ™ŸáŸäÿ¶ÿ© Firebase ŸÖÿπ ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°
        let firebaseInitialized = false;
        let firebaseError = null;
        let db, auth, storage;

        try {
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÖÿß ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßŸÑÿ™ŸáŸäÿ¶ÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã
            if (!firebase.apps.length) {
                const app = firebase.initializeApp(firebaseConfig);
                console.log("‚úÖ Firebase App initialized:", app.name);
            } else {
                console.log("‚úÖ Firebase App already initialized");
            }
            
            // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿÆÿØŸÖÿßÿ™
            db = firebase.firestore();
            auth = firebase.auth();
            try { storage = firebase.storage(); } catch(e){ console.warn("Storage init failed", e); storage = null; }
// ÿ•ÿπÿØÿßÿØ ÿ•ÿπÿØÿßÿØÿßÿ™ CORS ŸÑŸÑÿ™ÿÆÿ≤ŸäŸÜ
            if (storage) {
                console.log("‚úÖ Firebase Storage initialized");
            }
            
            firebaseInitialized = true;
            firebaseInitialized = true;
            window.db = db;
            window.auth = auth;
            window.storage = storage;

            console.log("‚úÖ Firebase services initialized successfully");
            
            // ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿßÿ™ÿµÿßŸÑ
            testFirebaseConnection();
            
        } catch (error) {
            console.error("‚ùå Firebase initialization error:", error);
            firebaseInitialized = false;
            firebaseError = error.message;
            
            setTimeout(() => {
                showConnectionMessage('error', `ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ: ${error.message}`);
            }, 1000);
        }
        
        // ÿßÿÆÿ™ÿ®ÿßÿ± ÿßÿ™ÿµÿßŸÑ Firebase
        async function testFirebaseConnection() {
            console.log("=== Testing Firebase Connection ===");
            
            if (!firebaseInitialized) {
                console.error("‚ùå Firebase not initialized");
                showConnectionMessage('error', 'Firebase ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ™Ÿá');
                return { success: false };
            }
            
            try {
                // ÿßÿÆÿ™ÿ®ÿßÿ± Firestore
                const productsRef = db.collection('products');
                const snapshot = await productsRef.limit(1).get();
                
                console.log("‚úÖ Firestore connection successful");
                console.log(`üìä Total products: ${snapshot.size}`);
                
                // ÿßÿÆÿ™ÿ®ÿßÿ± Authentication (ÿ®ÿØŸàŸÜ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ)
                const authState = auth.currentUser;
                console.log("‚úÖ Auth service working");
                
                // ÿßÿÆÿ™ÿ®ÿßÿ± Storage
                try {
                    const storageRef = storage.ref();
                    console.log("‚úÖ Storage service working");
                } catch (storageError) {
                    console.warn("‚ö†Ô∏è Storage may have CORS issues:", storageError);
                }
                
                showConnectionMessage('success', 'ÿ™ŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                return { success: true, hasProducts: snapshot.size > 0 };
                
            } catch (error) {
                console.error("‚ùå Firebase connection test failed:", error);
                
                let errorMessage = "ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™";
                if (error.code) {
                    switch (error.code) {
                        case 'failed-precondition':
                            errorMessage = "Ÿäÿ±ÿ¨Ÿâ ÿ™ŸÖŸäÿ≤ Firestore ŸÅŸä ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ Firebase";
                            break;
                        case 'permission-denied':
                            errorMessage = "ÿÆÿ∑ÿ£ ŸÅŸä ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸàÿµŸàŸÑ";
                            break;
                        case 'unavailable':
                            errorMessage = "ÿßŸÑÿÆÿØŸÖÿ© ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ÿ© ÿ≠ÿßŸÑŸäÿßŸã";
                            break;
                        default:
                            errorMessage = `ÿÆÿ∑ÿ£: ${error.code}`;
                    }
                }
                
                showConnectionMessage('error', errorMessage);
                return { success: false, error: error.message };
            }
        }
        
        // ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ
        function showConnectionMessage(type, message) {
            const statusDiv = document.getElementById('connectionStatus');
            if (!statusDiv) return;
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'warning' ? 'fa-exclamation-triangle' : 
                        'fa-times-circle';
            
            statusDiv.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
            statusDiv.className = `connection-status ${type}`;
            statusDiv.style.display = 'flex';
            
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿπÿØ 5 ÿ´ŸàÿßŸÜŸç
            setTimeout(() => {
                statusDiv.style.opacity = '0';
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                    statusDiv.style.opacity = '1';
                }, 1000);
            }, 5000);
        }
        
        // ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑÿπÿßŸÑŸÖŸä
        window.firebase = firebase;
        window.db = db;
        window.auth = auth;
        window.storage = storage;
        firebaseInitialized = firebaseInitialized;
        window.firebaseError = firebaseError;

        // ===== ŸÖÿ≥ÿßÿπÿØÿßÿ™ Firebase =====
        function getDbSafe() {
            if (window.db) return window.db;
            try {
                if (window.firebase && window.firebase.firestore) {
                    window.db = window.firebase.firestore();
                    return window.db;
                }
            } catch (e) {}
            return null;
        }

        
    

        // ===== Timestamp helper (prevents FieldValue errors if Firebase partially fails) =====
        function getServerTimestamp() {
            try {
                const st = firebase?.firestore?.FieldValue?.serverTimestamp;
                return (typeof st === 'function') ? st() : new Date();
            } catch (e) {
                return new Date();
            }
        }
</script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #1a237e;
            --secondary-color: #283593;
            --accent-color: #4fc3f7;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --light-color: #f8f9fa;
            --dark-color: #333;
            --text-color: #333;
            --border-color: #e0e0e0;
        }

        body {
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Logo Styling */
        .logo-text {
            font-family: 'Cairo', sans-serif;
            font-weight: 800;
            font-size: 2.2rem;
            background: linear-gradient(45deg, #FFFFFF, var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
            letter-spacing: 1px;
        }

        .logo-subtext {
            font-family: 'Cairo', sans-serif;
            font-weight: 300;
            font-size: 1rem;
            color: #e3f2fd;
            margin-right: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 9999;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            animation: slideInLeft 0.5s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .connection-status.success {
            background-color: var(--success-color);
            color: white;
        }
        
        .connection-status.warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .connection-status.error {
            background-color: var(--danger-color);
            color: white;
        }
        
        .connection-status.info {
            background-color: var(--accent-color);
            color: white;
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Loading Overlay */
        .firebase-loading {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.2rem;
        }

        .firebase-loading i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--accent-color);
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Connection Error Banner */
        .firebase-error-banner {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            background-color: #f44336;
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 9998;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: none;
        }

        .firebase-error-banner.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .error-retry-btn {
            background-color: white;
            color: #f44336;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            margin-right: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 10px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 5px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            display: flex;
            align-items: center;
        }

        .logo-icon i {
            font-size: 2.5rem;
            color: var(--accent-color);
            text-shadow: 0 2px 8px rgba(79, 195, 247, 0.4);
        }

        .logo-img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border-radius: 8px;
            background-color: white;
            padding: 5px;
            display: none;
        }

        .logo-img.active {
            display: block;
        }

        .logo-text-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .logo-main {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .logo-slogan {
            color: #e3f2fd;
            font-size: 0.75rem;
            margin-top: 2px;
            text-align: right;
        }

        .contact-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.85rem;
            flex-wrap: wrap;
        }

        .contact-info i {
            margin-left: 5px;
            color: var(--accent-color);
        }

        .phone-number {
            background-color: rgba(79, 195, 247, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* Social Media Links */
        .social-links {
            display: flex;
            gap: 10px;
            margin-left: 10px;
        }

        .social-link {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .social-link.whatsapp {
            background-color: #25D366;
        }

        .social-link.facebook {
            background-color: #1877F2;
        }

        .social-link.map {
            background-color: #34A853;
        }

        .social-link.youtube {
            background-color: #FF0000;
        }

        .social-link:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        .header-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tagline {
            font-size: 0.85rem;
            color: #e3f2fd;
            flex: 1;
        }

        .specialization {
            background-color: rgba(79, 195, 247, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #e3f2fd;
            margin-right: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .admin-login-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: flex;
        
            align-items: center;
            gap: 8px;
        }

        .admin-login-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .cart-icon {
            position: relative;
            font-size: 1.2rem;
            cursor: pointer;
            margin-right: 10px;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 30px auto;
            width: 90%;
            max-width: 400px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalFade 0.3s;
        }

        @keyframes modalFade {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .modal-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.6rem;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background-color: white;
            color: var(--text-color);
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2);
        }

        .login-btn, .logout-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .login-btn:hover {
            background-color: var(--secondary-color);
        }

        .logout-btn {
            background-color: var(--danger-color);
            margin-top: 8px;
        }

        .logout-btn:hover {
            background-color: #d32f2f;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin: 15px 0;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .admin-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-tabs {
            position: relative;
            pointer-events: auto;
            display: flex;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            flex: 1;
            min-width: 120px;
        }

        .admin-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background-color: white;
        }

        .admin-content {
            padding: 20px;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .admin-settings-section {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--light-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        /* Product Ordering */
        .product-order-section {
            margin-top: 20px;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .product-order-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
            margin-top: 10px;
        }

        .product-order-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            cursor: move;
            transition: all 0.3s;
            background-color: white;
        }

        .product-order-item:hover {
            background-color: #f9f9f9;
        }

        .product-order-item.dragging {
            opacity: 0.5;
            background-color: #f0f0f0;
        }

        .product-order-item-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
            margin-left: 10px;
            background-color: #f5f5f5;
        }

        .product-order-item-details {
            flex: 1;
        }

        .product-order-item-name {
            font-weight: 600;
            color: var(--text-color);
        }

        .product-order-item-price {
            font-weight: 700;
            color: var(--success-color);
            margin-left: 15px;
        }

        /* Logo Upload Section */
        .logo-upload-section {
            margin-top: 20px;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .logo-preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }

        .logo-preview {
            width: 150px;
            height: 150px;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-color: white;
            position: relative;
        }

        .logo-remove-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .logo-upload-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        /* Category Ordering */
        .category-order-section {
            margin-top: 20px;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .category-order-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
            margin-top: 10px;
        }

        .category-order-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            cursor: move;
            transition: all 0.3s;
            background-color: white;
        }

        .category-order-item:hover {
            background-color: #f9f9f9;
        }

        .category-order-item-name {
            font-weight: 600;
            color: var(--text-color);
            flex: 1;
        }

        .category-order-item-count {
            background-color: var(--accent-color);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .save-btn, .delete-btn, .upload-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .save-btn {
            background-color: var(--success-color);
            color: white;
        }

        .save-btn:hover {
            background-color: #388e3c;
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .delete-btn:hover {
            background-color: #d32f2f;
        }

        /* Categories Section */
        .categories-section {
            padding: 25px 0;
        }

        .section-title {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.6rem;
            position: relative;
            padding-bottom: 12px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 50%;
            transform: translateX(50%);
            width: 70px;
            height: 3px;
            background-color: var(--accent-color);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .category-card.active {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        .category-icon {
            height: 100px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .category-name {
            padding: 12px;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .category-count {
            background-color: #e8f5e9;
            color: var(--success-color);
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.75rem;
            margin-top: 5px;
            display: inline-block;
        }

        /* Products Section */
        .products-section {
            padding: 15px 0 30px;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .products-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .search-box {
            position: relative;
            min-width: 220px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background-color: white;
            color: var(--text-color);
        }

        .sort-options select {
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 160px;
            color: var(--text-color);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            height: 180px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            position: relative;
            cursor: pointer;
        }

        .product-image img {
            max-width: 100%;
            max-height: 140px;
            object-fit: contain;
            transition: transform 0.3s;
        }

        .video-icon {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: rgba(255, 0, 0, 0.8);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            z-index: 10;
        }

        .product-category {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: rgba(26, 35, 126, 0.85);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .more-images-badge {
            position: absolute;
            bottom: 12px;
            left: 12px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 6px;
            border-radius: 15px;
            font-size: 0.75rem;
            display: none;
        }

        .more-images-badge.show {
            display: block;
        }

        .product-details {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
            min-height: 50px;
            cursor: pointer;
        }

        .product-description {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 12px;
            line-height: 1.5;
            max-height: 50px;
            overflow: hidden;
            position: relative;
        }

        .product-description.expanded {
            max-height: none;
            overflow: visible;
        }

        .read-more {
            color: var(--accent-color);
            background: none;
            border: none;
            font-size: 0.8rem;
            cursor: pointer;
            padding: 0;
            margin-top: 5px;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--success-color);
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .delivery-fee {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .product-stock {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 12px;
            color: #666;
        }

        .product-stock.in-stock {
            color: var(--success-color);
        }

        .product-stock.low-stock {
            color: var(--warning-color);
        }

        .product-stock.out-of-stock {
            color: var(--danger-color);
        }

        .product-actions {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            gap: 8px;
        }

        .buy-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            flex: 1;
        }

        .buy-btn:hover {
            background-color: #388e3c;
        }

        .details-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
        }

        /* Footer */
        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 30px 0 15px;
            margin-top: 40px;
        }

        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 25px;
            margin-bottom: 25px;
        }

        .footer-section {
            flex: 1;
            min-width: 220px;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--accent-color);
            position: relative;
            padding-bottom: 8px;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 45px;
            height: 3px;
            background-color: var(--accent-color);
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1.1rem;
            color: var(--primary-color);
            grid-column: 1 / -1;
        }

        /* Cart Popup Modal */
        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            overflow-y: auto;
        }

        .cart-modal-content {
            background-color: white;
            margin: 30px auto;
            width: 96%;
            max-width: 980px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalFade 0.3s;
            display: flex;
            flex-direction: column;
            max-height: 92vh;
            overflow: hidden;
        }

        /* Split Cart Layout (Products left - Customer info right) */
        .cart-body{
            flex: 1;
            display: flex;
            gap: 16px;
            overflow: hidden;
            direction: ltr; /* ŸÑÿ∂ŸÖÿßŸÜ ÿ£ŸÜ ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ£ŸàŸÑ Ÿäÿ∏Ÿáÿ± Ÿäÿ≥ÿßÿ±ÿßŸã */
        }
        .cart-left, .cart-right{
            direction: rtl; /* ŸÜÿµ ÿπÿ±ÿ®Ÿä ÿØÿßÿÆŸÑ ÿßŸÑÿ£ÿπŸÖÿØÿ© */
            min-width: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .cart-left{
            flex: 1.15;
        }
        .cart-right{
            flex: 0.85;
            min-width: 320px;
            border-left: 1px solid var(--border-color);
            background: #fff;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 18px;
            max-height: none;
        }

        .customer-info {
            padding: 18px;
            border-top: none;
            flex: 1;
            overflow-y: auto;
            max-height: none;
        }

        .cart-footer {
            padding: 18px;
            border-top: 1px solid var(--border-color);
            background-color: var(--light-color);
            flex-shrink: 0;
        }

        @media (max-width: 900px) {
            .cart-body{
                flex-direction: column;
                direction: rtl;
            }
            .cart-right{
                min-width: 0;
                border-left: none;
                border-top: 1px solid var(--border-color);
            }
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            max-height: 50vh;
        }

        .cart-item {
    display: flex;
    align-items: flex-start;
    padding: 18px;
    border-bottom: 1px solid var(--border-color);
    gap: 18px;
}

.cart-item-image {
    width: 110px;
    height: 110px;
    border-radius: 10px;
    overflow: hidden;
    background-color: #f5f5f5;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.cart-item-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.cart-item-details {
    flex: 1;
    font-size: 0.95rem;
}

.cart-item-name {
    font-size: 1.05rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 6px;
}

.cart-item-price {
    font-size: 1rem;
    font-weight: 800;
    color: var(--success-color);
}

.cart-item-quantity {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 8px;
}
.quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background-color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .quantity-btn:hover {
            background-color: var(--light-color);
        }

        .remove-item {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
        }

        .customer-info {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
            max-height: 32vh;
            overflow-y: auto;
        }

        .shipping-options {
            margin-top: 20px;
        }

        .shipping-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
        }

        .shipping-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(26, 35, 126, 0.05);
        }

        .delivery-address {
            margin-top: 15px;
            display: none;
        }

        .delivery-address.show {
            display: block;
        }

        .cart-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            background-color: var(--light-color);
            flex-shrink: 0;
        }

        .order-summary {
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-row.total {
            font-weight: 700;
            font-size: 1.1rem;
            border-top: 2px solid var(--border-color);
            padding-top: 10px;
            margin-top: 10px;
        }

        .checkout-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .whatsapp-btn, .email-btn {
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .whatsapp-btn {
            background-color: #25D366;
            color: white;
        }

        .whatsapp-btn:hover {
            background-color: #128C7E;
        }

        .email-btn {
            background-color: var(--accent-color);
            color: white;
        }

        .email-btn:hover {
            background-color: #29b6f6;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* Gallery Modal */
        .gallery-modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1002;
            overflow-y: auto;
        }

        .gallery-modal-content {
            background-color: white;
            margin: 30px auto;
            width: 90%;
            max-width: 800px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalFade 0.3s;
        }

        .gallery-main-image {
            height: 400px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .gallery-thumbnails {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            overflow-x: auto;
            background-color: var(--light-color);
        }

        .gallery-thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            flex-shrink: 0;
        }

        .gallery-thumbnail.active {
            border-color: var(--primary-color);
        }

        .video-btn {
            background-color: #FF0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            transition: all 0.3s;
        }

        /* Admin Access Panel */
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 5000;
        
            pointer-events: auto;
            display: block;}

            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1003;
            justify-content: center;
            align-items: center;
        }

            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .access-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .access-btn {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: white;
            color: var(--text-color);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .access-close-btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--light-color);
            color: var(--text-color);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        /* Products Table */
        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .products-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: right;
            font-weight: 600;
        }

        .products-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            text-align: right;
        }

        .product-image-small {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 5px;
        }

        .edit-btn {
            background-color: var(--accent-color);
            color: white;
        }

        .remove-btn {
            background-color: var(--danger-color);
            color: white;
        }

        /* Add Category Section */
        .add-category-section {
            margin-top: 20px;
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .categories-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: white;
            margin-top: 10px;
            padding: 10px;
        }

        .category-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .product-order-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .cart-modal-content {
                width: 95%;
                max-height: 90vh;
            }
            
            .cart-items {
                max-height: 45vh;
            }
            
            .customer-info {
                max-height: 28vh;
            }
            
            .products-table {
                display: block;
                overflow-x: auto;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                width: 100%;
            }
            
                bottom: 15px;
                right: 15px;
            }
            
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .cart-items {
                max-height: 40vh;
            }
            
            .customer-info {
                max-height: 26vh;
            }
            
                bottom: 10px;
                right: 10px;
            }
            
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }
        
            .cart-item {
                gap: 12px;
            }

            .cart-item-image {
                width: 90px;
                height: 90px;
            }

            .cart-item-name {
                font-size: 1rem;
            }
}
    /* ====== Professional Home + Service (New) ====== */
.top-nav {
    position: sticky;
    top: 0;
    z-index: 999;
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.06);
}
.top-nav .nav-inner{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:10px 0;
}
.nav-links{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
}
.nav-links button{
    border:1px solid rgba(0,0,0,0.08);
    background:#fff;
    padding:10px 14px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
    transition: all .2s ease;
}
.nav-links button.active,
.nav-links button:hover{
    transform: translateY(-1px);
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    border-color: rgba(0,0,0,0.12);
}
.nav-cta{
    display:flex;
    gap:10px;
    align-items:center;
}
.nav-cta a{
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 14px;
    border-radius:12px;
    border:1px solid rgba(0,0,0,0.08);
    background:#fff;
    font-weight:800;
    color:#222;
}
.nav-cta a:hover{
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    transform: translateY(-1px);
}
.hero{ padding:18px 0 6px; }
.hero-card{
    border-radius: 18px;
    padding: 18px;
    border: 1px solid rgba(0,0,0,0.08);
    background: linear-gradient(135deg, rgba(33,150,243,0.08), rgba(76,175,80,0.06));
    box-shadow: 0 14px 32px rgba(0,0,0,0.08);
}
.hero-grid{
    display:grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap:14px;
    align-items:stretch;
}
.hero h1{ margin:0 0 8px 0; font-size: 1.4rem; }
.hero p{ margin:0 0 12px 0; color:#444; line-height:1.7; }
.trust-badges{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:12px;
}
.badge{
    background:#fff;
    border:1px solid rgba(0,0,0,0.08);
    border-radius:999px;
    padding:8px 12px;
    font-weight:700;
    font-size:0.9rem;
    display:inline-flex;
    align-items:center;
    gap:8px;
}
.hero-actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:14px;
}
.btn-primary, .btn-secondary{
    border:none;
    cursor:pointer;
    padding:12px 14px;
    border-radius:14px;
    font-weight:900;
    display:inline-flex;
    align-items:center;
    gap:10px;
    text-decoration:none;
}
.btn-primary{
    background:#25D366;
    color:#fff;
    box-shadow: 0 12px 26px rgba(37,211,102,0.22);
}
.btn-secondary{
    background:#fff;
    color:#222;
    border:1px solid rgba(0,0,0,0.10);
}
.btn-secondary:hover, .btn-primary:hover{
    transform: translateY(-1px);
    box-shadow: 0 14px 30px rgba(0,0,0,0.10);
}
.hero-side{
    border-radius:18px;
    background:#fff;
    border:1px solid rgba(0,0,0,0.08);
    padding:14px;
}
.hero-side h3{ margin:0 0 10px 0; font-size:1.05rem; }
.quick-list{
    list-style:none;
    padding:0;
    margin:0;
    display:grid;
    gap:8px;
}
.quick-list li{
    display:flex;
    gap:10px;
    align-items:flex-start;
    padding:10px 12px;
    border-radius:14px;
    border:1px dashed rgba(0,0,0,0.12);
    background: rgba(0,0,0,0.02);
}
.section-hint{ color:#666; margin-top:6px; font-size:0.95rem; line-height:1.6; }

/* Service Request Modal */
.service-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
}
.service-grid .form-group{ margin-bottom:0; }
.service-grid .span-2{ grid-column: 1 / -1; }
.service-actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:flex-start;
    margin-top:10px;
}
.mini-btn{
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(0,0,0,0.10);
    background:#fff;
    cursor:pointer;
    font-weight:800;
    display:inline-flex;
    align-items:center;
    gap:8px;
}
.mini-btn:hover{
    box-shadow: 0 10px 22px rgba(0,0,0,0.10);
    transform: translateY(-1px);
}
.note{ font-size:0.9rem; color:#666; line-height:1.6; margin-top:6px; }
.upload-status{ margin-top:8px; font-size:0.95rem; font-weight:800; }
.upload-status.ok{ color:#2e7d32; }
.upload-status.err{ color:#c62828; }

/* Mobile */
@media (max-width: 900px){
    .hero-grid{ grid-template-columns: 1fr; }
    .service-grid{ grid-template-columns: 1fr; }
    .top-nav .nav-inner{ flex-direction:column; align-items:stretch; }
    .nav-cta{ justify-content:space-between; }
}


/* === Cart Split Layout Override (v6) === */
#cartModal .cart-modal-content{
    width: 96%;
    max-width: 980px;
}
#cartModal .cart-modal-content .cart-body{
    flex: 1;
    display: flex;
    gap: 16px;
    overflow: hidden;
    direction: ltr;
}
#cartModal .cart-modal-content .cart-left,
#cartModal .cart-modal-content .cart-right{
    direction: rtl;
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}
#cartModal .cart-modal-content .cart-left{ flex: 1.15; }
#cartModal .cart-modal-content .cart-right{
    flex: 0.85;
    min-width: 320px;
    border-left: 1px solid var(--border-color);
    background: #fff;
}

#cartModal .cart-modal-content #cartItems.cart-items{
    flex: 1;
    overflow-y: auto;
    padding: 18px;
    max-height: none;
}

#cartModal .cart-modal-content .customer-info{
    padding: 18px;
    border-top: none;
    flex: 1;
    overflow-y: auto;
    max-height: none;
}

#cartModal .cart-modal-content .cart-footer{
    padding: 18px;
    border-top: 1px solid var(--border-color);
    background-color: var(--light-color);
    flex-shrink: 0;
}

@media (max-width: 900px){
    #cartModal .cart-modal-content{ width: 98%; max-width: 100%; }
    #cartModal .cart-modal-content .cart-body{ flex-direction: column; direction: rtl; }
    #cartModal .cart-modal-content .cart-right{
        min-width: 0;
        border-left: none;
        border-top: 1px solid var(--border-color);
    }
}


/* ====== Fix: Cart split layout on mobile (ensure products/images show) ====== */
@media (max-width: 768px) {
  /* allow vertical scrolling for stacked layout */
  .cart-body{
    flex-direction: column !important;
    direction: rtl !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }
  /* prevent clipping */
  .cart-left, .cart-right{
    overflow: visible !important;
  }
  /* keep products list visible and scrollable */
  .cart-items{
    max-height: 38vh !important;
    overflow-y: auto !important;
  }
  /* keep right section visually separated */
  .cart-right{
    min-width: 0 !important;
    border-left: none !important;
    border-top: 1px solid var(--border-color) !important;
  }
}

@media (max-width: 480px) {
  .cart-items{
    max-height: 34vh !important;
  }
  .cart-item-image{
    width: 90px !important;
    height: 90px !important;
  }
}


        /* ===== Gallery Modal Fixes ===== */
        .gallery-header{
            background-color: var(--primary-color);
            color: white;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            border-radius: 12px 12px 0 0;
        }
        .gallery-header h3{
            margin: 0;
            font-size: 1.05rem;
            font-weight: 800;
            line-height: 1.4;
        }
        /* Ensure close button visible on colored header */
        #closeGalleryModal{
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            line-height: 1;
            padding: 4px 10px;
            border-radius: 10px;
        }
        #closeGalleryModal:hover{
            background-color: rgba(255,255,255,0.15);
        }
        /* Thumbnails: show actual image */
        .gallery-thumbnail img{
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }


        /* ===== Gallery Image Fit Fix ===== */
        .gallery-main-image{
            height: min(62vh, 520px);
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
            overflow: hidden;
        }
        #galleryMainImage{
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
        }


        /* ===== Video Button (Premium Pulse Style) ===== */
        .video-btn-card{
            position:absolute;
            top:12px;
            left:12px;
            width:56px;
            height:56px;
            border-radius:50%;
            border:none;
            background: linear-gradient(135deg,#ff3b3b,#c80000);
            color:#fff;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:22px;
            z-index:25;
            box-shadow:0 8px 20px rgba(0,0,0,0.35);
            animation:pulseVideoBtn 1.8s infinite;
            transition:transform .2s ease;
        }
        .video-btn-card:hover{
            transform:scale(1.12);
        }
        .video-btn-card i{
            margin-left:3px;
            pointer-events:none;
        }
        @keyframes pulseVideoBtn{
            0%{ box-shadow:0 0 0 0 rgba(255,0,0,.6);}
            70%{ box-shadow:0 0 0 18px rgba(255,0,0,0);}
            100%{ box-shadow:0 0 0 0 rgba(255,0,0,0);}
        }


        /* ===== Platform Colors for Video Button ===== */
        .video-btn-card.video-youtube{ background: linear-gradient(135deg,#ff3b3b,#c80000); }
        .video-btn-card.video-facebook{ background: linear-gradient(135deg,#1877F2,#0d47a1); }
        .video-btn-card.video-tiktok{ background: linear-gradient(135deg,#000000,#333333); }
        .video-btn-card.video-instagram{ background: linear-gradient(135deg,#f09433,#bc1888,#4c68d7); }

</style>

<style>
/* Inline social buttons next to WhatsApp/Email */
.nav-social-inline{
    margin-right:8px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:34px;
    height:34px;
    border-radius:50%;
    color:#fff;
    text-decoration:none;
    font-size:15px;
}

.nav-social-inline.youtube{ background:#ff0000; }
.nav-social-inline.facebook{ background:#1877f2; }
.nav-social-inline.whatsapp{ background:#25d366; }
.nav-social-inline.maps{ background:#4caf50; }
</style>


<style>
/* Hide legacy video iframe modal completely (was causing empty box) */
#videoModal{ display:none !important; }
</style>


<style>
/* ===== Mobile Top Bar (Pro) ===== */
.m-topbar{ display:none; }
.m-drawer, .m-drawer-backdrop{ display:none; }

@media (max-width: 768px){
  /* hide the big desktop header on mobile */
  header{ display:none !important; }

  /* show top bar */
  .m-topbar{
    display:block; left:0;
    right:0;
    ;
    
    top: 0;
    z-index: 3000;
    background: rgba(255,255,255,0.94);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.08);
  }
  .m-topbar-inner{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 10px 0;
  }
  .m-icon-btn{
    width: 42px;
    height: 42px;
    border-radius: 12px;
    border: 1px solid rgba(0,0,0,0.10);
    background:#fff;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow: 0 10px 22px rgba(0,0,0,0.06);
  }
  .m-icon-btn:active{ transform: scale(0.98); }

  .m-brand{
    flex: 1;
    text-align:center;
    overflow:hidden;
    white-space:nowrap;
    text-overflow:ellipsis;
    font-weight:900;
    color: var(--primary-color);
  }
  .m-brand-name{
    font-size: 1.05rem;
    letter-spacing: .2px;
  }

  .m-cart-btn{
    position: relative;
  }
  .m-badge{
    position:absolute;
    top:-7px;
    right:-7px;
    width: 20px;
    height: 20px;
    border-radius: 999px;
    background: var(--danger-color);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: .75rem;
    font-weight: 900;
    border: 2px solid #fff;
  }

  /* Add padding so content doesn't stick under topbar */
  body{ padding-top: calc(62px + env(safe-area-inset-top)); }
}

/* Drawer */
@media (max-width: 768px){
  .m-drawer-backdrop{
    display:none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    z-index: 3001;
  }
  .m-drawer{
    display:block;
    position: fixed;
    top: 0;
    right: -92%;
    width: min(92%, 360px);
    height: 100%;
    background: #fff;
    z-index: 3002;
    box-shadow: -10px 0 30px rgba(0,0,0,0.25);
    transition: right .25s ease;
    border-left: 1px solid rgba(0,0,0,0.08);
  }
  .m-drawer.open{ right: 0; }
  .m-drawer-backdrop.show{ display:block; }

  .m-drawer-header{
    padding: 14px 14px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
  }
  .m-drawer-title{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:900;
  }
  .m-drawer-title i{ color: var(--accent-color); }

  .m-drawer-body{ padding: 14px; }

  .m-search{
    display:flex;
    align-items:center;
    gap:10px;
    padding: 12px 12px;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,0.10);
    background: rgba(0,0,0,0.02);
  }
  .m-search input{
    border:none;
    outline:none;
    background: transparent;
    width: 100%;
    font-size: .95rem;
  }

  .m-quick-actions{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 12px;
  }
  .m-qa{
    text-decoration:none;
    padding: 12px 12px;
    border-radius: 14px;
    font-weight: 900;
    color:#fff;
    display:flex;
    align-items:center;
    gap: 10px;
    justify-content:center;
  }
  .m-qa.whatsapp{ background:#25D366; }
  .m-qa.facebook{ background:#1877F2; }
  .m-qa.youtube{ background:#FF0000; }
  .m-qa.maps{ background:#34A853; }
  .m-qa.email{ background: var(--accent-color); }

  .m-info{
    margin-top: 14px;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 14px;
    padding: 12px;
    background: #fff;
  }
  .m-info-row{
    display:flex;
    align-items:center;
    gap: 10px;
    padding: 8px 0;
    color:#222;
    font-weight: 800;
    border-bottom: 1px dashed rgba(0,0,0,0.08);
  }
  .m-info-row:last-child{ border-bottom:none; }
  .m-info-row i{ color: var(--primary-color); width: 18px; text-align:center; }

  .m-links{
    margin-top: 14px;
    display:grid;
    gap: 10px;
  }
  .m-link-btn{
    width: 100%;
    padding: 12px 12px;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,0.10);
    background: #fff;
    cursor:pointer;
    font-weight: 900;
    display:flex;
    align-items:center;
    justify-content:flex-start;
    gap: 10px;
  }
  .m-link-btn i{ color: var(--primary-color); }
}
/* ===== /Mobile Top Bar ===== */
</style>


<style>
/* ===== Mobile Header Fix (hide duplicated header/nav + safe-area) ===== */
@media (max-width: 768px){
  /* hide any legacy nav rows that still appear under the top bar */
  .top-nav{ display:none !important; }
  .nav-links, .nav-cta{ display:none !important; }

  /* in case some header fragments are outside <header> */
  .header-top, .header-bottom{ display:none !important; }

  /* iOS safe-area support */
  .m-topbar{
    padding-top: env(safe-area-inset-top);
  }
}
/* ===== /Mobile Header Fix ===== */
</style>


<style>
/* ===== Bigger & clickable mobile quick icons ===== */
@media (max-width: 768px){
  .m-qs{
    width: 56px !important;
    height: 56px !important;
    font-size: 26px !important;
  }
  .m-quickstrip-inner{ gap:16px !important; }
}
</style>


<style>
/* Mobile circular social buttons like desktop */
@media (max-width: 768px){
  .mobile-social-icons{
    display:flex;
    justify-content:center;
    gap:16px;
    margin-top:14px;
    flex-wrap:wrap;
  }

  .mobile-social-icons .msi{
    width:56px;
    height:56px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-size:24px;
    text-decoration:none;
    box-shadow:0 6px 14px rgba(0,0,0,0.25);
    transition:0.2s ease;
  }

  .mobile-social-icons .msi:hover{
    transform:scale(1.08);
  }

  .mobile-social-icons .whatsapp{ background:#25D366; }
  .mobile-social-icons .facebook{ background:#1877F2; }
  .mobile-social-icons .maps{ background:#34A853; }
  .mobile-social-icons .youtube{ background:#FF0000; }
}
</style>


<style>
/* Mobile Quick Strip buttons styling */
@media (max-width: 768px){
  .m-quickstrip{
    position: sticky;
    top: 0;
    z-index: 2999;
    background: rgba(255,255,255,0.94);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.08);
  }
  .m-quickstrip-inner{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:14px;
    padding: 10px 0 12px;
  }
  .m-qs{
    width: 46px;
    height: 46px;
    border-radius: 50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    text-decoration:none;
    font-size: 20px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.18);
    transition: .2s ease;
  }
  .m-qs:active{ transform: scale(0.98); }
  .m-qs.whatsapp{ background:#25D366; }
  .m-qs.facebook{ background:#1877F2; }
  .m-qs.maps{ background:#34A853; }
  .m-qs.youtube{ background:#FF0000; }
  .m-qs.email{ background: var(--accent-color); }
}
</style>


<style>
/* Ensure mobile top icons are clickable and above overlays */
@media (max-width: 768px){
  .m-quickstrip{ position: sticky; top: calc(62px + env(safe-area-inset-top)); z-index: 4000; pointer-events: auto; }
  .m-quickstrip *{ pointer-events: auto; }
}
</style>


<style>
/* === FIX: Ensure cart icon & modal visible on mobile === */
@media (max-width: 768px){
  .cart-icon,
  .header-actions .cart-icon{
    display: inline-flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  #cartModal{
    z-index: 6000 !important;
  }

  .cart-modal,
  .cart-modal-content{
    display: none;
  }

  .cart-modal.show{
    display: block !important;
  }

  .cart-modal.show .cart-modal-content{
    display: flex !important;
  }
}
</style>


<style>
/* Mobile quickstrip cart button */
@media (max-width: 768px){
  .m-qs.cart{
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border: none;
    cursor: pointer;
    position: relative;
  }
  .m-qs.cart i{ pointer-events:none; }
  .m-qs-badge{
    position:absolute;
    top:-7px;
    right:-7px;
    min-width:20px;
    height:20px;
    padding:0 6px;
    border-radius:999px;
    background: var(--danger-color);
    color:#fff;
    font-size:12px;
    font-weight:900;
    display:flex;
    align-items:center;
    justify-content:center;
    border: 2px solid #fff;
    line-height:1;
    box-shadow: 0 6px 12px rgba(0,0,0,0.18);
  }
}
</style>


<style>
/* ‚úÖ ÿ∂ŸÖÿßŸÜ ÿ£ŸÜ ÿ≤ÿ± ÿßŸÑÿ≥ŸÑÿ© ŸÇÿßÿ®ŸÑ ŸÑŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ */
#mCartBtn, #cartIcon, .m-cart-btn, .cart-icon{
  cursor: pointer;
  pointer-events: auto;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}
</style>


<!-- ===== 3D ICONS + ORANGE / BLUE THEME (ADDED) ===== -->
<style>
:root {
  --primary-color: #0d47a1;
  --secondary-color: #1565c0;
  --accent-color: #ff8f00;
  --warning-color: #ff9800;
  --success-color: #2e7d32;
  --danger-color: #d32f2f;
  --light-color: #ffffff;
  --dark-color: #1f1f1f;
  --text-color: #222;
  --border-color: #e0e0e0;
}

/* 3D Icons */
i, .icon, .fa, .fas, .fab {
  transition: transform .25s ease, box-shadow .25s ease, filter .25s ease;
  filter: drop-shadow(0 2px 2px rgba(0,0,0,.18));
}
i:hover, .fa:hover {
  transform: translateY(-2px) scale(1.06);
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
}
.social-link, .nav-social-inline, .m-qa {
  box-shadow: inset 0 2px 3px rgba(255,255,255,.35),
              inset 0 -3px 4px rgba(0,0,0,.25),
              0 6px 14px rgba(0,0,0,.25);
}
.social-link:hover, .nav-social-inline:hover, .m-qa:hover {
  transform: translateY(-3px) scale(1.08);
  box-shadow: inset 0 1px 2px rgba(255,255,255,.4),
              inset 0 -2px 3px rgba(0,0,0,.25),
              0 10px 22px rgba(0,0,0,.35);
}
</style>


<!-- ===== HEADER VISIBILITY FIX (FINAL) ===== -->
<style>
header.glass {
  background: linear-gradient(
      135deg,
      rgba(13,71,161,0.85),
      rgba(21,101,192,0.75)
    ),
    rgba(255,255,255,0.65);
  backdrop-filter: blur(14px) saturate(140%);
  -webkit-backdrop-filter: blur(14px) saturate(140%);
  border-bottom: 1px solid rgba(255,255,255,0.25);
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
}
header.glass, header.glass * {
  color: #ffffff !important;
}
header.glass i {
  color: var(--accent-color) !important;
}
.m-topbar.glass {
  background: linear-gradient(
      135deg,
      rgba(13,71,161,0.9),
      rgba(21,101,192,0.85)
    );
  border-bottom: 1px solid rgba(255,255,255,0.25);
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);
}
.m-brand, .m-brand-name {
  color: #ffffff !important;
}
</style>


<!-- ===== SMART COLOR PALETTE (APPLIED) ===== -->
<style>
:root{
  --blue-main:#0d47a1;
  --orange-main:#ff8f00;
  --green-ok:#4CAF50;
  --purple-smart:#7E57C2;
  --red-alert:#E53935;
  --yellow-offer:#FFD54F;
  --cyan-info:#4FC3F7;
}

/* Section backgrounds */
.section-alt{
  background: linear-gradient(135deg,
    rgba(13,71,161,0.04),
    rgba(255,143,0,0.04)
  );
}

/* Product cards */
.product-card{
  background: linear-gradient(180deg,#ffffff,#f5f9ff);
}

/* Badges */
.badge.stock{background:var(--green-ok);color:#fff;}
.badge.wifi{background:var(--purple-smart);color:#fff;}
.badge.offer{background:var(--yellow-offer);color:#333;}
.badge.info{background:var(--cyan-info);color:#003;}

.badge{
  padding:4px 10px;
  border-radius:999px;
  font-size:.75rem;
  font-weight:800;
}

/* Icon coloring by meaning */
.icon-power, .fa-bolt{color:var(--cyan-info);}
.icon-cart, .fa-shopping-cart{color:var(--orange-main);}
.icon-warranty, .fa-shield-check{color:var(--green-ok);}
.icon-smart, .fa-wifi{color:var(--purple-smart);}

/* Secondary buttons */
.btn-info{background:var(--cyan-info);color:#003;}
.btn-success{background:var(--green-ok);color:#fff;}
.btn-purple{background:var(--purple-smart);color:#fff;}

/* Section divider */
.section-divider{
  height:3px;
  margin:24px 0;
  background:linear-gradient(90deg,
    var(--blue-main),
    var(--orange-main),
    var(--green-ok)
  );
}
</style>


<style>
/* ===== Account / Admin Buttons (No Floating Buttons) ===== */
.user-account-btn{
  border:none;
  cursor:pointer;
  padding:10px 14px;
  border-radius:10px;
  font-weight:700;
  background:linear-gradient(135deg, #0A58CA, #084298);
  color:#fff;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow: 0 10px 22px rgba(0,0,0,0.18);
  transition: transform .2s ease;
}
.user-account-btn:hover{ transform: translateY(-2px); }
.auth-tabs, .account-tabs{ display:flex; gap:10px; margin-bottom:14px; }
.auth-tab, .account-tab{
  flex:1; border:1px solid #e5e5e5; background:#fff;
  padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:700;
}
.auth-tab.active, .account-tab.active{ border-color: var(--blue, #0A58CA); box-shadow:0 8px 18px rgba(0,0,0,0.08); }
.account-header{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:12px; border-radius:14px;
  background: rgba(10,88,202,0.06); margin-bottom:14px;
}
.account-badge{ display:flex; align-items:center; gap:10px; }
.account-badge i{ font-size:1.8rem; color: var(--blue, #0A58CA); }
.mini-list{ display:flex; flex-direction:column; gap:10px; }
.mini-item{ background:#fff; border:1px solid #eee; border-radius:14px; padding:12px; box-shadow:0 10px 18px rgba(0,0,0,0.06); }
.mini-item .row{ display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.mini-muted{ opacity:.75; font-size:.9rem; }
</style>

</head>
<body>

<!-- ===== Mobile Top Bar (Professional) ===== -->
<div class="m-topbar" id="mTopbar">
  <div class="m-topbar-inner container">
    <button class="m-icon-btn" id="mMenuBtn" aria-label="ÿßŸÑŸÇÿßÿ¶ŸÖÿ©">
      <i class="fas fa-bars"></i>
    </button>

    <div class="m-brand" id="mBrand">
      <span class="m-brand-name" id="mStoreNameMobile">Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™</span>
    </div>

    <button class="m-icon-btn m-cart-btn" id="mCartBtn" aria-label="ÿßŸÑÿ≥ŸÑÿ©">
      <i class="fas fa-shopping-cart"></i>
      <span class="m-badge" id="mCartCount">0</span>
    </button>
  </div>
</div>

<!-- Mobile Quick Actions Strip (visible on mobile) -->
<div class="m-quickstrip" id="mQuickStrip">
  <div class="container m-quickstrip-inner">
    <a class="m-qs whatsapp" id="mQSWhatsApp" href="https://wa.me/962790781206" aria-label="Ÿàÿßÿ™ÿ≥ÿßÿ®" target="_blank" rel="noopener">
      <i class="fab fa-whatsapp"></i>
    </a>
    <a class="m-qs facebook" id="mQSFb" href="https://facebook.com" aria-label="ŸÅŸäÿ≥ÿ®ŸàŸÉ" target="_blank" rel="noopener">
      <i class="fab fa-facebook-f"></i>
    </a>
    <a class="m-qs maps" id="mQSMaps" href="https://maps.google.com" aria-label="ÿßŸÑŸÖŸàŸÇÿπ" target="_blank" rel="noopener">
      <i class="fas fa-location-dot"></i>
    </a>
    <a class="m-qs youtube" id="mQSYt" href="https://youtube.com" aria-label="ŸäŸàÿ™ŸäŸàÿ®" target="_blank" rel="noopener">
      <i class="fab fa-youtube"></i>
    </a>
    <a class="m-qs email" id="mQSEmail" href="mailto:wesamelectronics@gmail.com" aria-label="ÿßŸÑÿ•ŸäŸÖŸäŸÑ">
      <i class="fas fa-envelope"></i>
    </a>

    <button class="m-qs cart" id="mQSCart" type="button" aria-label="ÿßŸÑÿ≥ŸÑÿ©">
      <i class="fas fa-cart-shopping"></i>
      <span class="m-qs-badge" id="mQSCartCount" style="display:none;">0</span>
    </button>
</div>
</div>

</div>
<!-- /Mobile Quick Actions Strip -->


<!-- Mobile Drawer -->
<div class="m-drawer-backdrop" id="mDrawerBackdrop"></div>
<aside class="m-drawer" id="mDrawer" aria-hidden="true">
  <div class="m-drawer-header">
    <div class="m-drawer-title">
      <i class="fas fa-store"></i>
      <span id="mDrawerStoreName">Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™</span>
    </div>
    <button class="m-icon-btn" id="mCloseDrawer" aria-label="ÿ•ÿ∫ŸÑÿßŸÇ">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="m-drawer-body">
    <div class="m-search">
      <i class="fas fa-search"></i>
      <input type="text" id="mSearchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨..." />
    </div>

    <div class="m-quick-actions mobile-social-icons">

  <a href="https://wa.me/962790781206" class="msi whatsapp" target="_blank" rel="noopener">
    <i class="fab fa-whatsapp"></i>
  </a>

  <a href="https://facebook.com" class="msi facebook" target="_blank" rel="noopener">
    <i class="fab fa-facebook-f"></i>
  </a>

  <a href="https://maps.google.com" class="msi maps" target="_blank" rel="noopener">
    <i class="fas fa-map-marker-alt"></i>
  </a>

  <a href="https://youtube.com" class="msi youtube" target="_blank" rel="noopener">
    <i class="fab fa-youtube"></i>
  </a>

</div>

    <div class="m-info">
      <div class="m-info-row">
        <i class="fas fa-phone"></i>
        <span id="mPhoneText">0790781206</span>
      </div>
      <div class="m-info-row">
        <i class="fas fa-location-dot"></i>
        <span id="mAddressText">ÿπŸÖÿßŸÜ - ÿ¥ŸÅÿßÿ®ÿØÿ±ÿßŸÜ</span>
      </div>
      <div class="m-info-row">
        <i class="fas fa-truck"></i>
        <span>ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÖÿ™ÿßÿ≠</span>
      </div>
    </div>

    <div class="m-links">
      <button class="m-link-btn" id="mGoCategories"><i class="fas fa-list"></i> ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ</button>
      <button class="m-link-btn" id="mGoProducts"><i class="fas fa-box-open"></i> ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</button>
      <button class="m-link-btn" id="mOpenService"><i class="fas fa-screwdriver-wrench"></i> ÿ∑ŸÑÿ® ÿµŸäÿßŸÜÿ©</button>
      <button class="m-link-btn" id="mUserAccountBtn"><i class="fas fa-user"></i> ÿ≠ÿ≥ÿßÿ®Ÿä</button>
      <button class="m-link-btn" id="mAdminPanelBtn"><i class="fas fa-user-cog"></i> ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</button>
    </div>
  </div>
</aside>
<!-- ===== /Mobile Top Bar ===== -->

    <!-- Loading Overlay -->
    <div id="firebaseLoading" class="firebase-loading" style="display: none;">
        <i class="fas fa-spinner"></i>
        <p>ÿ¨ÿßÿ±Ÿä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...</p>
    </div>

    <!-- Error Banner -->
    <div id="firebaseErrorBanner" class="firebase-error-banner">
        <span id="errorMessage">ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</span>
        <button class="error-retry-btn" onclick="retryFirebaseConnection()">ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©</button>
    </div>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status"></div>

    <!-- Header Section -->
    <header>
        <div class="container">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-tv" id="logoIcon"></i>
                        <img src="" alt="ÿ¥ÿπÿßÿ± ÿßŸÑŸÖÿ™ÿ¨ÿ±" class="logo-img" id="logoImage">
                    </div>
                    <div class="logo-text-container">
                        <div class="logo-main">
                            <span class="logo-subtext" id="storeNameHeader">Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™</span>
                            <span class="logo-text" id="wesamLogo">wesam</span>
                        </div>
                        <p class="logo-slogan" id="storeSloganHeader">ŸÖÿ™ÿÆÿµÿµŸàŸÜ ŸÅŸä ÿ£ÿ¨Ÿáÿ≤ÿ© TV-LCD-LED ŸàÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™</p>
                    </div>
                </div>
                <div class="contact-info">
                    <div class="phone-number">
                        <i class="fas fa-phone"></i> <span id="phoneNumberHeader">0790781206</span>
                    </div>
                    <div>
                        <i class="fas fa-map-marker-alt"></i> <span id="storeAddressHeader">ÿπŸÖÿßŸÜ - ÿ¥ŸÅÿßÿ®ÿØÿ±ÿßŸÜ</span>
                    </div>
                    <div>
                        <i class="fas fa-truck"></i> ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÖÿ™ÿßÿ≠
                    </div>
                    <!-- Social Media Links -->
                    <div class="social-links" id="socialLinks"></div>
                </div>
            </div>
            <div class="header-bottom">
                <p class="tagline" id="storeTaglineHeader">ÿ£ŸÅÿ∂ŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ© ÿ®ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± - ÿ¨ŸàÿØÿ© Ÿàÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä</p>
                <div class="specialization" id="specializationHeader">
                    <i class="fas fa-tv"></i>
                    TV - LCD - LED - ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™
                </div>
                <div class="header-actions">
                    <div class="cart-icon" id="cartIcon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                    <button class="user-account-btn" id="userAccountBtn" type="button">
                        <i class="fas fa-user"></i> ÿ≠ÿ≥ÿßÿ®Ÿä
                    </button>
                    <button class="admin-login-btn" id="adminLoginBtn" type="button">
                        <i class="fas fa-user-cog"></i> ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿØŸäÿ±</h3>
                <button class="close-modal" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="adminEmail">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
                    <input type="email" id="adminEmail" placeholder="example@email.com" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="adminPassword">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                    <input type="password" id="adminPassword" placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" autocomplete="current-password">
                </div>

                <button class="login-btn" id="loginBtn">
                    <span class="btn-text">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</span>
                </button>

                <p id="loginError" style="color: #f44336; margin-top: 10px; display: none;">ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©</p>
</div>
        </div>
    </div>

    <!-- User Auth Modal -->
    <div id="userAuthModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> ÿ≠ÿ≥ÿßÿ®Ÿä</h3>
                <button class="close-modal" id="closeUserAuthModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" type="button" data-tab="login">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>
                    <button class="auth-tab" type="button" data-tab="register">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
                </div>

                <div class="auth-pane" id="authLoginPane">
                    <div class="form-group">
                        <label for="userEmailLogin">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
                        <input type="email" id="userEmailLogin" placeholder="example@email.com" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="userPasswordLogin">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                        <input type="password" id="userPasswordLogin" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
                    </div>
                    <button class="login-btn" id="userLoginBtn" type="button">
                        <span class="btn-text">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</span>
                    </button>
                    <p id="userAuthError" style="color:#f44336; margin-top:10px; display:none;"></p>
                    <p style="color:#666; margin-top:12px; font-size:.9rem;">
                        ÿπŸÜÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ≥Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™ŸÉ Ÿàÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ© ÿØÿßÿÆŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ.
                    </p>
                </div>

                <div class="auth-pane" id="authRegisterPane" style="display:none;">
                    <div class="form-group">
                        <label for="userNameRegister">ÿßŸÑÿßÿ≥ŸÖ</label>
                        <input type="text" id="userNameRegister" placeholder="ÿßÿ≥ŸÖŸÉ">
                    </div>
                    <div class="form-group">
                        <label for="userPhoneRegister">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</label>
                        <input type="tel" id="userPhoneRegister" placeholder="07XXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label for="userEmailRegister">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
                        <input type="email" id="userEmailRegister" placeholder="example@email.com" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="userPasswordRegister">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                        <input type="password" id="userPasswordRegister" placeholder="ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ 6 ÿ£ÿ≠ÿ±ŸÅ" autocomplete="new-password">
                    </div>
                    <button class="login-btn" id="userRegisterBtn" type="button">
                        <span class="btn-text">ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®</span>
                    </button>
                    <p id="userAuthErrorRegister" style="color:#f44336; margin-top:10px; display:none;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- User Account Modal -->
    <div id="userAccountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-id-card"></i> ÿ≠ÿ≥ÿßÿ®Ÿä</h3>
                <button class="close-modal" id="closeUserAccountModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="account-header">
                    <div class="account-badge">
                        <i class="fas fa-user-circle"></i>
                        <div>
                            <div id="accountName" style="font-weight:700;">ŸÖÿ≥ÿ™ÿÆÿØŸÖ</div>
                            <div id="accountEmail" style="opacity:.8; font-size:.9rem;"></div>
                        </div>
                    </div>
                    <button class="logout-btn" id="userLogoutBtn" type="button"><i class="fas fa-sign-out-alt"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
                </div>

                <div class="account-tabs">
                    <button class="account-tab active" type="button" data-tab="orders">ŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™Ÿä</button>
                    <button class="account-tab" type="button" data-tab="requests">ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ©</button>
                </div>

                <div class="account-pane" id="accountOrdersPane">
                    <div id="userOrdersList" class="mini-list"></div>
                </div>

                <div class="account-pane" id="accountRequestsPane" style="display:none;">
                    <div id="userServiceRequestsList" class="mini-list"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- Product Gallery Modal -->
    <div id="galleryModal" class="gallery-modal">
        <div class="gallery-modal-content">
            <div class="gallery-header">
                <h3 id="galleryProductName"></h3>
                <button class="close-modal" id="closeGalleryModal">&times;</button>
            </div>
            <div class="gallery-main-image">
                <img id="galleryMainImage" src="" alt="ÿµŸàÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨">
            </div>
            <div class="gallery-thumbnails" id="galleryThumbnails"></div>
            <div class="product-details-modal" id="galleryProductDetails"></div>
        </div>
    </div>

    <!-- Cart Popup Modal -->
    <div id="cartModal" class="cart-modal">
        <div class="cart-modal-content">
            <div class="cart-header">
                <h3>ÿ≥ŸÑÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ</h3>
                <button class="close-modal" id="closeCart">&times;</button>
            </div>
            <div class="cart-body">
                <div class="cart-left">
                    <div class="cart-items" id="cartItems"></div>

                    <div class="cart-footer">
                <div class="order-summary">
                    <h4>ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ®</h4>
                    <div class="summary-row">
                        <span>ÿ≥ÿπÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:</span>
                        <span id="subtotalPrice">0 ÿØŸäŸÜÿßÿ±</span>
                    </div>
                    <div class="summary-row">
                        <span>ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ:</span>
                        <span id="shippingFee">0 ÿØŸäŸÜÿßÿ±</span>
                    </div>
                    <div class="summary-row total">
                        <span>ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä:</span>
                        <span id="totalPrice">0 ÿØŸäŸÜÿßÿ±</span>
                    </div>
                </div>
                
                <div class="checkout-options">
                    <button class="whatsapp-btn" id="whatsappOrderBtn">
                        <i class="fab fa-whatsapp"></i> ÿ•ÿ±ÿ≥ÿßŸÑ ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®
                    </button>
                    <button class="email-btn" id="emailOrderBtn">
                        <i class="fas fa-envelope"></i> ÿ•ÿ±ÿ≥ÿßŸÑ ÿ®ÿßŸÑÿ®ÿ±ŸäÿØ
                    </button>
                </div>
            </div>
                </div>

                <div class="cart-right">
                    <div class="customer-info">
                <h4>ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿπŸÖŸäŸÑ</h4>
                <div class="form-group">
                    <label for="customerName">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ *</label>
                    <input type="text" id="customerName" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ ÿßŸÑŸÉÿßŸÖŸÑ" required>
                </div>
                <div class="form-group">
                    <label for="customerPhone">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ *</label>
                    <input type="tel" id="customerPhone" placeholder="07XXXXXXXX" required>
                </div>
                
                <div class="shipping-options">
                    <h4>ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ¥ÿ≠ŸÜ</h4>
                    <div class="shipping-option" id="pickupOption">
                        <input type="radio" name="shipping" id="pickup" value="pickup" checked>
                        <label for="pickup" style="margin-right: 10px; cursor: pointer;">
                            <strong>ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ¨ÿ±</strong><br>
                            <small>ÿπŸÖÿßŸÜ - ÿ¥ŸÅÿßÿ®ÿØÿ±ÿßŸÜ (ŸÖÿ¨ÿßŸÜÿßŸã)</small>
                        </label>
                    </div>
                    <div class="shipping-option" id="deliveryOption">
                        <input type="radio" name="shipping" id="delivery" value="delivery">
                        <label for="delivery" style="margin-right: 10px; cursor: pointer;">
                            <strong>ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÑŸÑŸÖŸÜÿ≤ŸÑ</strong><br>
                            <small>ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ: 2 ÿØŸäŸÜÿßÿ±</small>
                        </label>
                    </div>
                </div>
                
                <div class="delivery-address" id="deliveryAddress">
                    <div class="form-group">
                        <label for="customerAddress">ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ™ŸàÿµŸäŸÑ *</label>
                        <textarea id="customerAddress" placeholder="ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜŸÉ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä..." rows="3"></textarea>
                    </div>
                </div>
            </div>
                </div>
            </div>
</div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-header">
            <h3><i class="fas fa-user-cog"></i> ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿØŸäÿ±</h3>
            <button class="logout-btn" id="adminLogoutBtn">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
        </div>
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="addProduct" type="button" onclick="return switchAdminTab('addProduct')">ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ÿ¨ÿØŸäÿØ</button>
            <button class="admin-tab" data-tab="manageProducts" type="button" onclick="return switchAdminTab('manageProducts')">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</button>
            <button class="admin-tab" data-tab="productOrder" type="button" onclick="return switchAdminTab('productOrder')">ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</button>
            <button class="admin-tab" data-tab="categoryOrder" type="button" onclick="return switchAdminTab('categoryOrder')">ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™</button>
            <button class="admin-tab" data-tab="addCategory" type="button" onclick="return switchAdminTab('addCategory')">ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿµŸÜŸäŸÅ ÿ¨ÿØŸäÿØ</button>
            <button class="admin-tab" data-tab="storeSettings" type="button" onclick="return switchAdminTab('storeSettings')">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿ¨ÿ±</button>
            <button class="admin-tab" data-tab="serviceRequests" type="button" onclick="return switchAdminTab('serviceRequests')">ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ©</button>
            <button class="admin-tab" data-tab="pageContent" type="button" onclick="return switchAdminTab('pageContent')">ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿµŸÅÿ≠ÿ©</button>
        </div>
        <div class="admin-content">
            <!-- Add Product Section -->
            <div id="addProductSection" class="admin-section active">
                <h3><i class="fas fa-plus-circle"></i> ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ÿ¨ ÿ¨ÿØŸäÿØ</h3>
                <form id="addProductForm" class="product-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productName">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ *</label>
                            <input type="text" id="productName" required>
                        </div>
                        <div class="form-group">
                            <label for="productCategory">ÿßŸÑŸÅÿ¶ÿ© *</label>
                            <select id="productCategory" required>
                                <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ¶ÿ©</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productPrice">ÿ≥ÿπÿ± ÿßŸÑÿ®Ÿäÿπ (ÿØŸäŸÜÿßÿ±) *</label>
                            <input type="number" id="productPrice" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="productStock">ÿßŸÑŸÉŸÖŸäÿ© ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ *</label>
                            <input type="number" id="productStock" min="0" required>
                        </div>
                        <div class="form-group" style="display:flex; align-items:flex-end;">
                            <label style="display:flex; gap:10px; align-items:center; cursor:pointer;">
                                <input type="checkbox" id="productFeatured" style="transform:scale(1.2);">
                                ÿπÿ±ÿ∂ ÿ∂ŸÖŸÜ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ© ŸàÿßŸÑÿ£ŸÅÿ∂ŸÑ
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDescription">ŸàÿµŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨ (ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™)</label>
                        <textarea id="productDescription" placeholder="ÿ£ÿØÿÆŸÑ ŸÖŸàÿßÿµŸÅÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ©..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productDeliveryFee">ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ (ÿØŸäŸÜÿßÿ±)</label>
                            <input type="number" id="productDeliveryFee" min="0" step="0.01" value="2">
                        </div>
                        <div class="form-group">
                            <label for="productVideoUrl">ÿ±ÿßÿ®ÿ∑ ŸÅŸäÿØŸäŸà ÿßŸÑŸÖŸÜÿ™ÿ¨ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                            <input type="url" id="productVideoUrl" placeholder="https://youtube.com/watch?v=...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="productImageUrl">ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© (URL) *</label>
                        <input type="url" id="productImageUrl" class="image-url-input" 
                               placeholder="https://example.com/image.jpg" required>
                    </div>
                    
                    <div class="additional-images-section">
                        <label>ÿµŸàÿ± ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <div class="additional-images-container" id="additionalImagesContainer">
                            <div class="form-group additional-image-input">
                                <input type="url" class="additional-image-url" 
                                       placeholder="https://example.com/image2.jpg">
                            </div>
                        </div>
                        <button type="button" class="add-image-btn" id="addImageBtn">
                            <i class="fas fa-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ÿµŸàÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
                        </button>
                    </div>
                    
                    <div class="image-preview-container" id="imagePreviewContainer"></div>
                    
                    <div class="url-help">
                        <i class="fas fa-info-circle"></i>
                        ÿ£ÿØÿÆŸÑ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑŸÉÿßŸÖŸÑ. ŸäŸÖŸÉŸÜŸÉ ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© ÿπŸÑŸâ 
                        <a href="https://imgbb.com" target="_blank">ImgBB</a> ÿ£Ÿà 
                        <a href="https://postimages.org" target="_blank">PostImages</a> ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ±ÿßÿ®ÿ∑ ŸÖÿ¨ÿßŸÜŸä
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="save-btn">
                            <i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨
                        </button>
                        <button type="button" class="delete-btn" id="clearFormBtn">
                            <i class="fas fa-times"></i> ŸÖÿ≥ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Manage Products Section -->
            <div id="manageProductsSection" class="admin-section">
                <h3><i class="fas fa-edit"></i> ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</h3>
                <div class="products-list">
                    <table class="products-table" id="productsTable">
                        <thead>
                            <tr>
                                <th>ÿßŸÑÿµŸàÿ±ÿ©</th>
                                <th>ÿßŸÑÿßÿ≥ŸÖ</th>
                                <th>ÿßŸÑŸÅÿ¶ÿ©</th>
                                <th>ÿßŸÑÿ≥ÿπÿ±</th>
                                <th>ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ</th>
                                <th>ŸÅŸäÿØŸäŸà</th>
                                <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Product Ordering Section -->
            <div id="productOrderSection" class="admin-section">
                <h3><i class="fas fa-sort-amount-down"></i> ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</h3>
                <div class="product-order-section">
                    <p>ÿßÿ≥ÿ≠ÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑÿ£ÿπŸÑŸâ ÿ£Ÿà ŸÑÿ£ÿ≥ŸÅŸÑ ŸÑÿ™ÿ∫ŸäŸäÿ± ÿ™ÿ±ÿ™Ÿäÿ® ÿπÿ±ÿ∂Ÿáÿß ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©:</p>
                    <div class="product-order-list" id="productOrderList"></div>
                    <div class="form-actions">
                        <button class="save-btn" id="saveProductOrderBtn">
                            <i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®
                        </button>
                    </div>
                </div>
            </div>

            <!-- Category Ordering Section -->
            <div id="categoryOrderSection" class="admin-section">
                <h3><i class="fas fa-sort-alpha-down"></i> ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™</h3>
                <div class="category-order-section">
                    <p>ÿßÿ≥ÿ≠ÿ® ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™ ŸÑÿ£ÿπŸÑŸâ ÿ£Ÿà ŸÑÿ£ÿ≥ŸÅŸÑ ŸÑÿ™ÿ∫ŸäŸäÿ± ÿ™ÿ±ÿ™Ÿäÿ® ÿπÿ±ÿ∂Ÿáÿß ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©:</p>
                    <div class="category-order-list" id="categoryOrderList"></div>
                    <div class="form-actions">
                        <button class="save-btn" id="saveCategoryOrderBtn">
                            <i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™
                        </button>
                    </div>
                </div>
            </div>

            <!-- Add Category Section -->
            <div id="addCategorySection" class="admin-section">
                <h3><i class="fas fa-folder-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿµŸÜŸäŸÅ ÿ¨ÿØŸäÿØ</h3>
                <div class="add-category-section">
                    <form id="addCategoryForm">
                        <div class="form-group">
                            <label for="newCategoryName">ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ¨ÿØŸäÿØ *</label>
                            <input type="text" id="newCategoryName" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿµŸÜŸäŸÅ" required>
                        </div>
                        <div class="form-group">
                            <label for="newCategoryIcon">ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ</label>
                            <select id="newCategoryIcon">
                                <option value="fas fa-headphones">ÿ≥ŸÖÿßÿπÿßÿ™</option>
                                <option value="fas fa-tv">ÿ™ŸÑŸÅÿ≤ŸäŸàŸÜ</option>
                                <option value="fas fa-microchip">ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™</option>
                                <option value="fas fa-mobile-alt">ÿ¨ŸàÿßŸÑÿßÿ™</option>
                                <option value="fas fa-laptop">ŸÑÿßÿ®ÿ™Ÿàÿ®</option>
                                <option value="fas fa-tablet-alt">ÿ™ÿßÿ®ŸÑÿ™</option>
                                <option value="fas fa-gamepad">ÿ£ŸÑÿπÿßÿ®</option>
                                <option value="fas fa-camera">ŸÉÿßŸÖŸäÿ±ÿßÿ™</option>
                                <option value="fas fa-battery-full">ÿ®ÿ∑ÿßÿ±Ÿäÿßÿ™</option>
                                <option value="fas fa-plug">ÿ¥Ÿàÿßÿ≠ŸÜ</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="save-btn">
                                <i class="fas fa-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ
                            </button>
                        </div>
                    </form>
                    
                    <h4 style="margin-top: 30px;">ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©</h4>
                    <div class="categories-list" id="categoriesList">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶ÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™ ŸáŸÜÿß -->
                    </div>
                </div>
            </div>
            
            <!-- Store Settings Section -->
            <div id="storeSettingsSection" class="admin-section">
                <h3><i class="fas fa-cog"></i> ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿ¨ÿ±</h3>
                <div class="admin-settings-section">
                    <h4><i class="fas fa-link"></i> ÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑÿ™ŸàÿßÿµŸÑ ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπŸä</h4>
                    <form id="storeSettingsForm">
                        <div class="form-group">
                            <label for="whatsappLink">ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</label>
                            <input type="url" id="whatsappLink" placeholder="https://wa.me/962790781206">
                            <small style="color: #666;">ÿ±ÿßÿ®ÿ∑ Ÿàÿßÿ™ÿ≥ÿßÿ® ÿßŸÑŸÖÿ™ÿ¨ÿ± ŸÑŸÑÿ™ŸàÿßÿµŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="facebookLink">ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÅŸäÿ≥ÿ®ŸàŸÉ</label>
                            <input type="url" id="facebookLink" placeholder="https://facebook.com/ÿµŸÅÿ≠ÿ™ŸÉŸÖ">
                        </div>
                        
                        <div class="form-group">
                            <label for="googleMapsLink">ÿ±ÿßÿ®ÿ∑ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ¨Ÿàÿ¨ŸÑ</label>
                            <input type="url" id="googleMapsLink" placeholder="https://goo.gl/maps/ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖŸàŸÇÿπ">
                        </div>
                        
                        <div class="form-group">
                            <label for="youtubeLink">ÿ±ÿßÿ®ÿ∑ ŸäŸàÿ™ŸäŸàÿ®</label>
                            <input type="url" id="youtubeLink" placeholder="https://youtube.com/c/ŸÇŸÜÿßÿ™ŸÉŸÖ">
                        </div>

<div class="form-group">
    <label for="storeEmailSettings">ÿßŸäŸÖŸäŸÑ ÿßŸÑŸÖÿ™ÿ¨ÿ±</label>
    <input type="email" id="storeEmailSettings" placeholder="wesamelectronics@gmail.com">
    <small style="color: #666;">ÿ≥ŸäŸèÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ©/ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿπÿ®ÿ± ÿßŸÑÿ®ÿ±ŸäÿØ</small>
</div>

                        <div class="form-actions">
                            <button type="submit" class="save-btn" id="saveSettingsBtn">
                                <i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            

<!-- Service Requests Section (New) -->
<div id="serviceRequestsSection" class="admin-section">
    <h3><i class="fas fa-tools"></i> ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ©</h3>
    <div class="admin-settings-section">
        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center;">
            <div>
                <p style="margin:0; color:#666;">
                    ŸáŸÜÿß ÿ™ÿ∏Ÿáÿ± ÿ¨ŸÖŸäÿπ ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ© (ÿ®ÿØŸàŸÜ ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿµŸàÿ±). ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ŸàŸÜÿ≥ÿÆ ÿ±ÿ≥ÿßŸÑÿ© Ÿàÿßÿ™ÿ≥ÿßÿ®.
                </p>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <button type="button" class="save-btn" id="refreshServiceRequestsBtn">
                    <i class="fas fa-rotate"></i> ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                </button>
            </div>
        </div>

        <div style="overflow:auto; margin-top:12px;">
            <table class="products-table" style="min-width: 900px;">
                <thead>
                    <tr>
                        <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                        <th>ÿßŸÑÿπŸÖŸäŸÑ</th>
                        <th>ÿßŸÑŸáÿßÿ™ŸÅ</th>
                        <th>ÿßŸÑÿ¨Ÿáÿßÿ≤</th>
                        <th>ÿßŸÑÿ≠ÿ¨ŸÖ</th>
                        <th>ÿßŸÑÿ≠ÿßŸÑÿ©</th>
                        <th>ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                    </tr>
                </thead>
                <tbody id="serviceRequestsTableBody">
                    <tr>
                        <td colspan="7" style="text-align:center; padding:18px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿπÿØ</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

            <!-- Page Content Section -->
            <div id="pageContentSection" class="admin-section">
                <h3><i class="fas fa-edit"></i> ÿ™ÿπÿØŸäŸÑ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿµŸÅÿ≠ÿ©</h3>
                <div class="admin-settings-section">
                    <h4><i class="fas fa-header"></i> ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸáŸäÿØÿ±</h4>
                    <form id="headerContentForm">
                        <div class="form-group">
                            <label for="storeName">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ™ÿ¨ÿ±</label>
                            <input type="text" id="storeName" placeholder="Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™">
                        </div>
                        
                        <div class="form-group">
                            <label for="wesamLogoText">ÿ¥ÿπÿßÿ± wesam</label>
                            <input type="text" id="wesamLogoText" placeholder="wesam">
                        </div>
                        
                        <div class="form-group">
                            <label for="storeSlogan">ÿ¥ÿπÿßÿ± ÿßŸÑŸÖÿ™ÿ¨ÿ±</label>
                            <input type="text" id="storeSlogan" placeholder="ŸÖÿ™ÿÆÿµÿµŸàŸÜ ŸÅŸä ÿ£ÿ¨Ÿáÿ≤ÿ© TV-LCD-LED ŸàÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phoneNumber">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</label>
                                <input type="text" id="phoneNumber" placeholder="0790781206">
                            </div>
                            <div class="form-group">
                                <label for="storeAddress">ÿßŸÑÿπŸÜŸàÿßŸÜ</label>
                                <input type="text" id="storeAddress" placeholder="ÿπŸÖÿßŸÜ - ÿ¥ŸÅÿßÿ®ÿØÿ±ÿßŸÜ">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="storeTagline">ÿßŸÑÿπÿ®ÿßÿ±ÿ© ÿßŸÑÿ™ÿ±ŸàŸäÿ¨Ÿäÿ©</label>
                            <textarea id="storeTagline" rows="2" placeholder="ÿ£ŸÅÿ∂ŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ© ÿ®ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± - ÿ¨ŸàÿØÿ© Ÿàÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="specializationText">ŸÜÿµ ÿßŸÑÿ™ÿÆÿµÿµ</label>
                            <input type="text" id="specializationText" placeholder="TV - LCD - LED - ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™">
                        </div>
                    </form>
                    
                    <h4 style="margin-top: 30px;"><i class="fas fa-shoe-prints"></i> ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÅŸàÿ™ÿ±</h4>
                    <form id="footerContentForm">
                        <div class="form-group">
                            <label for="footerAbout">ŸàÿµŸÅ ÿßŸÑŸÖÿ™ÿ¨ÿ± (ŸÅŸä ÿßŸÑŸÅŸàÿ™ÿ±)</label>
                            <textarea id="footerAbout" rows="3" placeholder="ŸÖÿ™ÿ¨ÿ± Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™ ŸáŸà ÿßŸÑŸàÿ¨Ÿáÿ© ÿßŸÑŸÖŸÅÿ∂ŸÑÿ© ŸÅŸä ÿπŸÖÿßŸÜ ŸÑÿ¥ÿ±ÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ© ŸàÿßŸÑÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™ ÿ∞ÿßÿ™ ÿßŸÑÿ¨ŸàÿØÿ© ÿßŸÑÿπÿßŸÑŸäÿ©. ŸÜŸÇÿØŸÖ ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÖÿπ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä."></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="storeEmail">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
                                <input type="email" id="storeEmail" placeholder="wesamelectronics@gmail.com">
                            </div>
                            <div class="form-group">
                                <label for="workingHours">ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ</label>
                                <input type="text" id="workingHours" placeholder="9:00 ÿµ - 10:00 ŸÖ">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="servicesList">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿÆÿØŸÖÿßÿ™ (ŸÉŸÑ ÿÆÿØŸÖÿ© ŸÅŸä ÿ≥ÿ∑ÿ±)</label>
                            <textarea id="servicesList" rows="4" placeholder="ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ ŸÑÿ¨ŸÖŸäÿπ ŸÖŸÜÿßÿ∑ŸÇ ÿπŸÖÿßŸÜ
ÿØŸÅÿπ ÿπŸÜÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ
ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä ŸÅŸä ÿ≠ÿßŸÑÿ© Ÿàÿ¨ŸàÿØ ÿπŸäÿ®
ÿ£ÿ≥ÿπÿßÿ± ÿ™ŸÜÿßŸÅÿ≥Ÿäÿ© Ÿàÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ©"></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="save-btn" id="savePageContentBtn">
                                <i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿµŸÅÿ≠ÿ©
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>

<!-- Top Navigation (New) -->
<div class="top-nav">
    <div class="container">
        <div class="nav-inner">
            <div class="nav-links">
                <button id="navServiceBtn" class="active" type="button"><i class="fas fa-tools"></i> ÿßŸÑÿµŸäÿßŸÜÿ©</button>
                <button id="navShopBtn" type="button"><i class="fas fa-store"></i> ÿßŸÑŸÖÿ™ÿ¨ÿ±</button>
            </div>
            <div class="nav-cta">
                <a id="navWhatsApp" href="https://wa.me/962790781206" target="_blank" rel="noopener">
                    <i class="fab fa-whatsapp"></i> Ÿàÿßÿ™ÿ≥ÿßÿ®
                </a>
                <a id="navEmail" href="mailto:wesamelectronics@gmail.com">
                    <i class="fas fa-envelope"></i> ÿßŸäŸÖŸäŸÑ
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Hero + Service Main Section (New) -->
<section class="hero" id="serviceHome">
    <div class="container">
        <div class="hero-card">
            <div class="hero-grid">
                <div>
                    <h1><i class="fas fa-tools"></i> ŸÇÿ≥ŸÖ ÿßŸÑÿµŸäÿßŸÜÿ© - ŸÇÿØŸëŸÖ ÿ∑ŸÑÿ®ŸÉ ÿÆŸÑÿßŸÑ ÿØŸÇŸäŸÇÿ©</h1>
                    <p>
                        ÿµŸäÿßŸÜÿ© ÿ£ÿ¨Ÿáÿ≤ÿ© TV / LCD / LED ŸàÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™ ŸÅŸä ÿπŸÖŸëÿßŸÜ. ÿßÿ±ÿ≥ŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ ŸÖÿπ ÿßŸÑŸÖŸàŸÇÿπ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) Ÿàÿ≥ŸÜŸÇŸàŸÖ ÿ®ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÉ Ÿàÿ™ÿ¨ŸáŸäÿ≤ ÿßŸÑÿ∑ŸÑÿ® ÿ®ÿ≥ÿ±ÿπÿ©.
                    </p>

                    <div class="hero-actions">
                        <button class="btn-primary" id="openServiceRequestBtn" type="button">
                            <i class="fas fa-wrench"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ∑ŸÑÿ® ÿµŸäÿßŸÜÿ© ÿßŸÑÿ¢ŸÜ
                        </button>
                        <button class="btn-secondary" id="scrollToShopBtn" type="button">
                            <i class="fas fa-shopping-bag"></i> ÿßŸÑÿ∞Ÿáÿßÿ® ÿ•ŸÑŸâ ÿßŸÑŸÖÿ™ÿ¨ÿ±
                        </button>
                    </div>

                    <div class="trust-badges">
                        <span class="badge"><i class="fas fa-shield-alt"></i> ŸÅÿ≠ÿµ Ÿàÿ™ÿ¥ÿÆŸäÿµ</span>
                        <span class="badge"><i class="fas fa-truck"></i> ÿ™ŸàÿµŸäŸÑ ŸÖŸÜ Ÿàÿ•ŸÑŸâ ÿßŸÑŸÖŸÜÿ≤ŸÑ</span>
                        <span class="badge"><i class="fas fa-clock"></i> ÿ™ŸàÿßÿµŸÑ ÿ≥ÿ±Ÿäÿπ</span>
                        <span class="badge"><i class="fas fa-star"></i> ÿÆÿ®ÿ±ÿ© Ÿàÿ•ÿ™ŸÇÿßŸÜ</span>
                    </div>
</div>

                <div class="hero-side">
                    <h3><i class="fas fa-list-check"></i> ŸÖÿßÿ∞ÿß ŸÜÿ≠ÿ™ÿßÿ¨ ŸÖŸÜŸÉÿü</h3>
                    <ul class="quick-list">
                        <li><i class="fas fa-user"></i> ÿßŸÑÿßÿ≥ŸÖ + ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</li>
                        <li><i class="fas fa-tv"></i> ŸÜŸàÿπ ÿßŸÑÿ¨Ÿáÿßÿ≤ + ÿßŸÑÿ≠ÿ¨ŸÖ</li>
                        <li><i class="fas fa-triangle-exclamation"></i> ŸàÿµŸÅ ÿßŸÑÿπÿ∑ŸÑ</li>
                        <li><i class="fas fa-image"></i> ÿµŸàÿ±ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) + ÿ±ÿßÿ®ÿ∑Ÿáÿß</li>
                        <li><i class="fas fa-location-dot"></i> ŸÖŸàŸÇÿπŸÉ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</li>
                    </ul>
                    <p class="note">
                        ÿ®ÿπÿØ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®ÿå ÿ≥Ÿäÿ™ŸÖ ŸÅÿ™ÿ≠ Ÿàÿßÿ™ÿ≥ÿßÿ® ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿ¨ÿßŸáÿ≤ÿ© (ŸàŸäŸàÿ¨ÿØ ÿÆŸäÿßÿ± ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸäŸÖŸäŸÑ ÿ£Ÿäÿ∂ÿßŸã).
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Service Request Modal (New) -->
<div id="serviceRequestModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-tools"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ∑ŸÑÿ® ÿµŸäÿßŸÜÿ©</h3>
            <button class="close-modal" id="closeServiceRequestModal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="serviceRequestForm">
                <div class="service-grid">
                    <div class="form-group">
                        <label for="srCustomerName">ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ</label>
                        <input type="text" id="srCustomerName" placeholder="ŸÖÿ´ÿßŸÑ: ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ" required>
                    </div>
                    <div class="form-group">
                        <label for="srCustomerPhone">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</label>
                        <input type="tel" id="srCustomerPhone" placeholder="ŸÖÿ´ÿßŸÑ: 079xxxxxxx" required>
                    </div>

                    <div class="form-group">
                        <label for="srDeviceType">ŸÜŸàÿπ ÿßŸÑÿ¨Ÿáÿßÿ≤ / ÿßŸÑŸÖÿßÿ±ŸÉÿ©</label>
                        <input type="text" id="srDeviceType" placeholder="ŸÖÿ´ÿßŸÑ: ÿ≥ÿßŸÖÿ≥ŸàŸÜÿ¨ / ÿ™Ÿàÿ¥Ÿäÿ®ÿß / LG" required>
                    </div>
                    <div class="form-group">
                        <label for="srDeviceSize">ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¨Ÿáÿßÿ≤</label>
                        <input type="text" id="srDeviceSize" placeholder="ŸÖÿ´ÿßŸÑ: 55 ÿ®Ÿàÿµÿ© / 25 ŸÑÿ™ÿ± / ..." required>
                    </div>

                    <div class="form-group span-2">
                        <label for="srFaultDesc">ŸàÿµŸÅ ÿßŸÑÿπÿ∑ŸÑ</label>
                        <textarea id="srFaultDesc" rows="4" placeholder="ÿßÿ¥ÿ±ÿ≠ ÿßŸÑÿπÿ∑ŸÑ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑ..." required></textarea>
                    </div>

                    <div class="form-group span-2">
                        <label>ÿµŸàÿ±ÿ© ÿßŸÑÿπÿ∑ŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <input type="file" id="srFaultImage" accept="image/*">
                        
                        <div class="service-actions">
                            <button type="button" class="mini-btn" id="srUploadImageBtn"><i class="fas fa-arrow-up-right-from-square"></i> ŸÅÿ™ÿ≠ PostImages ŸÑÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©</button>
                            <button type="button" class="mini-btn" id="srClearImageBtn"><i class="fas fa-trash"></i> ÿ≠ÿ∞ŸÅ ÿßŸÑÿµŸàÿ±ÿ©</button>
                        </div>
                        <div class="note">ÿ®ÿπÿØ ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© ŸÅŸä PostImages ÿßŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ (Hotlink for websites) ŸàÿßŸÑÿµŸÇŸá ŸáŸÜÿß.</div>
                        <div id="srUploadStatus" class="upload-status" style="display:none;"></div>
                        <div class="form-group" style="margin-top:10px;">
                            <label for="srImageLink">ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                            <input type="url" id="srImageLink" placeholder="https://...">
                        </div>
                    </div>

                    <div class="form-group span-2">
                        <label>ŸÖŸàŸÇÿπ ÿßŸÑÿπŸÖŸäŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <div class="service-actions">
                            <button type="button" class="mini-btn" id="srGetLocationBtn"><i class="fas fa-location-crosshairs"></i> ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸàŸÇÿπŸä ÿßŸÑÿ¢ŸÜ</button>
                            <button type="button" class="mini-btn" id="srClearLocationBtn"><i class="fas fa-eraser"></i> ŸÖÿ≥ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ</button>
                        </div>
                        <div class="note" id="srLocationHint">ŸäŸÖŸÉŸÜŸÉ ÿ£Ÿäÿ∂ÿßŸã Ÿàÿ∂ÿπ ÿ±ÿßÿ®ÿ∑ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ£Ÿà ŸÉÿ™ÿßÿ®ÿ© ÿπŸÜŸàÿßŸÜ ŸÖÿÆÿ™ÿµÿ±.</div>
                        <input type="url" id="srLocationLink" placeholder="ÿ±ÿßÿ®ÿ∑ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ¨Ÿàÿ¨ŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)">
                        <input type="text" id="srAddressText" placeholder="ÿπŸÜŸàÿßŸÜ ŸÖÿÆÿ™ÿµÿ± (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)" style="margin-top:10px;">
                    </div>
                </div>

                <div class="form-actions" style="margin-top:14px;">
                    <button type="submit" class="save-btn" id="srSubmitBtn">
                        <i class="fab fa-whatsapp"></i> ÿ™ÿ¨ŸáŸäÿ≤ ÿßŸÑÿ∑ŸÑÿ® Ÿàÿ•ÿ±ÿ≥ÿßŸÑŸá ŸÑŸÑŸàÿßÿ™ÿ≥ÿßÿ®
                    </button>
                    <button type="button" class="email-btn" id="srEmailBtn">
                        <i class="fas fa-envelope"></i> ÿ•ÿ±ÿ≥ÿßŸÑ ŸÜŸÅÿ≥ ÿßŸÑÿ∑ŸÑÿ® ÿπÿ®ÿ± ÿßŸÑÿ•ŸäŸÖŸäŸÑ
                    </button>
                </div>
                <div class="note" style="margin-top:10px;">
                    ÿ≥Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ® ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸäÿ≥ŸáŸÑ ÿπŸÑŸäŸÉ ŸÖÿ™ÿßÿ®ÿπÿ™Ÿá ŸÖŸÜ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ.
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- Categories Section -->
    <section class="categories-section">
        <div class="container">
            <h2 class="section-title">ÿ™ÿµŸÜŸäŸÅÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™</h2>
            <div class="categories-grid" id="categoriesGrid"></div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products-section">
        <div class="container">
            <div class="products-header">
                <h2 id="productsSectionTitle"><i class="fas fa-th-large"></i> ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ© ŸàÿßŸÑÿ£ŸÅÿ∂ŸÑ</h2>
                <div class="products-controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨...">
                    </div>
                    <div class="sort-options">
                        <select id="sortOptions">
                            <option value="default">ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑÿ•ŸÅÿ™ÿ±ÿßÿ∂Ÿä</option>
                            <option value="price-low">ÿßŸÑÿ≥ÿπÿ±: ŸÖŸÜ ÿßŸÑÿ£ŸÇŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ£ÿπŸÑŸâ</option>
                            <option value="price-high">ÿßŸÑÿ≥ÿπÿ±: ŸÖŸÜ ÿßŸÑÿ£ÿπŸÑŸâ ÿ•ŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ</option>
                            <option value="name">ÿßŸÑÿßÿ≥ŸÖ: ÿ£ÿ®ÿ¨ÿØŸä</option>
                            <option value="stock">ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ: ÿßŸÑÿ£ÿπŸÑŸâ ÿ£ŸàŸÑÿßŸã</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div id="productsGrid" class="products-grid"></div>
            
            <div id="loading" class="loading">
                <i class="fas fa-spinner"></i>
                <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™...</p>
            </div>
            
            <div id="noProducts" class="no-products" style="display: none;">
                <i class="fas fa-box-open"></i>
                <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™</h3>
                <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿ≠ÿßŸÑŸäÿßŸã</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ÿπŸÜ Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™</h3>
                    <p id="footerAboutText">ŸÖÿ™ÿ¨ÿ± Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™ ŸáŸà ÿßŸÑŸàÿ¨Ÿáÿ© ÿßŸÑŸÖŸÅÿ∂ŸÑÿ© ŸÅŸä ÿπŸÖÿßŸÜ ŸÑÿ¥ÿ±ÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ© ŸàÿßŸÑÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™ ÿ∞ÿßÿ™ ÿßŸÑÿ¨ŸàÿØÿ© ÿßŸÑÿπÿßŸÑŸäÿ©. ŸÜŸÇÿØŸÖ ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÖÿπ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä.</p>
                    <p><i class="fas fa-award"></i> ÿ¨ŸàÿØÿ© Ÿàÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä</p>
                    <p><i class="fas fa-truck"></i> ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÑÿ¨ŸÖŸäÿπ ŸÖŸÜÿßÿ∑ŸÇ ÿπŸÖÿßŸÜ</p>
                </div>
                <div class="footer-section">
                    <h3>ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ</h3>
                    <p><i class="fas fa-map-marker-alt"></i> <span id="footerAddress">ÿπŸÖÿßŸÜ - ÿ¥ŸÅÿßÿ®ÿØÿ±ÿßŸÜ</span></p>
                    <p><i class="fas fa-phone"></i> <span id="footerPhone">0790781206</span></p>
                    <p><i class="fas fa-clock"></i> ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ: <span id="footerHours">9:00 ÿµ - 10:00 ŸÖ</span></p>
                    <p><i class="fas fa-envelope"></i> <span id="footerEmail">wesamelectronics@gmail.com</span></p>
                    
                    <div class="footer-social-links" id="footerSocialLinks"></div>
                </div>
                <div class="footer-section">
                    <h3>ÿÆÿØŸÖÿßÿ™ŸÜÿß</h3>
                    <ul id="footerServices">
                        <li><i class="fas fa-chevron-left"></i> ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ ŸÑÿ¨ŸÖŸäÿπ ŸÖŸÜÿßÿ∑ŸÇ ÿπŸÖÿßŸÜ</li>
                        <li><i class="fas fa-chevron-left"></i> ÿØŸÅÿπ ÿπŸÜÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ</li>
                        <li><i class="fas fa-chevron-left"></i> ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä ŸÅŸä ÿ≠ÿßŸÑÿ© Ÿàÿ¨ŸàÿØ ÿπŸäÿ®</li>
                        <li><i class="fas fa-chevron-left"></i> ÿ£ÿ≥ÿπÿßÿ± ÿ™ŸÜÿßŸÅÿ≥Ÿäÿ© Ÿàÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ©</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ© &copy; 2025 Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™</p>
                <p>ÿπŸÖÿßŸÜ - ÿßŸÑÿ£ÿ±ÿØŸÜ | Ÿáÿßÿ™ŸÅ: 0790781206</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Application Code -->
    <script>
        // ÿπŸÜÿßÿµÿ± DOM
        const elements = {
            firebaseLoading: document.getElementById('firebaseLoading'),
            firebaseErrorBanner: document.getElementById('firebaseErrorBanner'),
            errorMessage: document.getElementById('errorMessage'),
            connectionStatus: document.getElementById('connectionStatus'),
            categoriesGrid: document.getElementById('categoriesGrid'),
            productsGrid: document.getElementById('productsGrid'),
            searchInput: document.getElementById('searchInput'),
            sortOptions: document.getElementById('sortOptions'),
            loading: document.getElementById('loading'),
            noProducts: document.getElementById('noProducts'),
            cartIcon: document.getElementById('cartIcon'),
            cartCount: document.getElementById('cartCount'),
            mCartBtn: document.getElementById('mCartBtn'),
            mCartCount: document.getElementById('mCartCount'),
            cartModal: document.getElementById('cartModal'),
            closeCart: document.getElementById('closeCart'),
            cartItems: document.getElementById('cartItems'),
            customerName: document.getElementById('customerName'),
            customerPhone: document.getElementById('customerPhone'),
            customerAddress: document.getElementById('customerAddress'),
            deliveryAddress: document.getElementById('deliveryAddress'),
            pickupOption: document.getElementById('pickupOption'),
            deliveryOption: document.getElementById('deliveryOption'),
            subtotalPrice: document.getElementById('subtotalPrice'),
            shippingFee: document.getElementById('shippingFee'),
            totalPrice: document.getElementById('totalPrice'),
            whatsappOrderBtn: document.getElementById('whatsappOrderBtn'),
            emailOrderBtn: document.getElementById('emailOrderBtn'),
            overlay: document.getElementById('overlay'),

            // Service Request (New)
            serviceHome: document.getElementById('serviceHome'),
            navServiceBtn: document.getElementById('navServiceBtn'),
            navShopBtn: document.getElementById('navShopBtn'),
            navWhatsApp: document.getElementById('navWhatsApp'),
            navEmail: document.getElementById('navEmail'),
            openServiceRequestBtn: document.getElementById('openServiceRequestBtn'),
            scrollToShopBtn: document.getElementById('scrollToShopBtn'),
            serviceRequestModal: document.getElementById('serviceRequestModal'),
            closeServiceRequestModal: document.getElementById('closeServiceRequestModal'),
            serviceRequestForm: document.getElementById('serviceRequestForm'),
            srCustomerName: document.getElementById('srCustomerName'),
            srCustomerPhone: document.getElementById('srCustomerPhone'),
            srDeviceType: document.getElementById('srDeviceType'),
            srDeviceSize: document.getElementById('srDeviceSize'),
            srFaultDesc: document.getElementById('srFaultDesc'),
            srFaultImage: document.getElementById('srFaultImage'),
            srUploadImageBtn: document.getElementById('srUploadImageBtn'),
            srClearImageBtn: document.getElementById('srClearImageBtn'),
            srUploadStatus: document.getElementById('srUploadStatus'),
            srImageLink: document.getElementById('srImageLink'),
            srGetLocationBtn: document.getElementById('srGetLocationBtn'),
            srClearLocationBtn: document.getElementById('srClearLocationBtn'),
            srLocationLink: document.getElementById('srLocationLink'),
            srAddressText: document.getElementById('srAddressText'),
            srEmailBtn: document.getElementById('srEmailBtn'),

            // Service Requests Admin (New)
            refreshServiceRequestsBtn: document.getElementById('refreshServiceRequestsBtn'),
            serviceRequestsTableBody: document.getElementById('serviceRequestsTableBody'),
            adminLoginBtn: document.getElementById('adminLoginBtn'),
            userAccountBtn: document.getElementById('userAccountBtn'),
            mUserAccountBtn: document.getElementById('mUserAccountBtn'),
            mAdminPanelBtn: document.getElementById('mAdminPanelBtn'),
            userAuthModal: document.getElementById('userAuthModal'),
            closeUserAuthModal: document.getElementById('closeUserAuthModal'),
            userAccountModal: document.getElementById('userAccountModal'),
            closeUserAccountModal: document.getElementById('closeUserAccountModal'),
            userEmailLogin: document.getElementById('userEmailLogin'),
            userPasswordLogin: document.getElementById('userPasswordLogin'),
            userLoginBtn: document.getElementById('userLoginBtn'),
            userAuthError: document.getElementById('userAuthError'),
            userAuthErrorRegister: document.getElementById('userAuthErrorRegister'),
            userNameRegister: document.getElementById('userNameRegister'),
            userPhoneRegister: document.getElementById('userPhoneRegister'),
            userEmailRegister: document.getElementById('userEmailRegister'),
            userPasswordRegister: document.getElementById('userPasswordRegister'),
            userRegisterBtn: document.getElementById('userRegisterBtn'),
            userLogoutBtn: document.getElementById('userLogoutBtn'),
            accountName: document.getElementById('accountName'),
            accountEmail: document.getElementById('accountEmail'),
            userOrdersList: document.getElementById('userOrdersList'),
            userServiceRequestsList: document.getElementById('userServiceRequestsList'),
            loginModal: document.getElementById('loginModal'),
            closeLoginModal: document.getElementById('closeLoginModal'),
            adminEmail: document.getElementById('adminEmail'),
            adminPassword: document.getElementById('adminPassword'),
            loginBtn: document.getElementById('loginBtn'),
            loginError: document.getElementById('loginError'),
            adminPanel: document.getElementById('adminPanel'),
            adminLogoutBtn: document.getElementById('adminLogoutBtn'),
            adminTabs: document.querySelectorAll('.admin-tab'),
            adminSections: document.querySelectorAll('.admin-section'),
            addProductForm: document.getElementById('addProductForm'),
            productsTableBody: document.getElementById('productsTableBody'),
            productImageUrl: document.getElementById('productImageUrl'),
            productDescription: document.getElementById('productDescription'),
            productVideoUrl: document.getElementById('productVideoUrl'),
            additionalImagesContainer: document.getElementById('additionalImagesContainer'),
            addImageBtn: document.getElementById('addImageBtn'),
            imagePreviewContainer: document.getElementById('imagePreviewContainer'),
            galleryModal: document.getElementById('galleryModal'),
            closeGalleryModal: document.getElementById('closeGalleryModal'),
            galleryProductName: document.getElementById('galleryProductName'),
            galleryMainImage: document.getElementById('galleryMainImage'),
            galleryThumbnails: document.getElementById('galleryThumbnails'),
            galleryProductDetails: document.getElementById('galleryProductDetails'),
            socialLinks: document.getElementById('socialLinks'),
            footerSocialLinks: document.getElementById('footerSocialLinks'),
            storeSettingsForm: document.getElementById('storeSettingsForm'),
            whatsappLink: document.getElementById('whatsappLink'),
            facebookLink: document.getElementById('facebookLink'),
            googleMapsLink: document.getElementById('googleMapsLink'),
            youtubeLink: document.getElementById('youtubeLink'),
            storeEmailSettings: document.getElementById('storeEmailSettings'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            openAdminAccess: document.getElementById('openAdminAccess'),
            adminAccessModal: document.getElementById('adminAccessModal'),
            closeAdminAccess: document.getElementById('closeAdminAccess'),
            accessShowBtn: document.getElementById('accessShowBtn'),
            accessHideBtn: document.getElementById('accessHideBtn'),
            accessDirectLoginBtn: document.getElementById('accessDirectLoginBtn'),
            storeName: document.getElementById('storeName'),
            wesamLogoText: document.getElementById('wesamLogoText'),
            storeSlogan: document.getElementById('storeSlogan'),
            phoneNumber: document.getElementById('phoneNumber'),
            storeAddress: document.getElementById('storeAddress'),
            storeTagline: document.getElementById('storeTagline'),
            specializationText: document.getElementById('specializationText'),
            footerAbout: document.getElementById('footerAbout'),
            storeEmail: document.getElementById('storeEmail'),
            workingHours: document.getElementById('workingHours'),
            servicesList: document.getElementById('servicesList'),
            savePageContentBtn: document.getElementById('savePageContentBtn'),
            footerAboutText: document.getElementById('footerAboutText'),
            footerAddress: document.getElementById('footerAddress'),
            footerPhone: document.getElementById('footerPhone'),
            footerHours: document.getElementById('footerHours'),
            footerEmail: document.getElementById('footerEmail'),
            footerServices: document.getElementById('footerServices'),
            productOrderList: document.getElementById('productOrderList'),
            saveProductOrderBtn: document.getElementById('saveProductOrderBtn'),
            categoryOrderList: document.getElementById('categoryOrderList'),
            saveCategoryOrderBtn: document.getElementById('saveCategoryOrderBtn'),
            productCategory: document.getElementById('productCategory'),
            wesamLogo: document.getElementById('wesamLogo'),
            addCategoryForm: document.getElementById('addCategoryForm'),
            newCategoryName: document.getElementById('newCategoryName'),
            newCategoryIcon: document.getElementById('newCategoryIcon'),
            categoriesList: document.getElementById('categoriesList')
        };

        // ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        const state = {
            currentCategory: "all",
            cart: JSON.parse(localStorage.getItem('wassam_cart')) || [],
            products: [],
            filteredProducts: [],
            isAdmin: false,
            adminButtonVisible: true,
            currentUser: null,
            currentUserProfile: null,
            isFirebaseConnected: false,
            shippingMethod: 'pickup',
            currentGalleryProduct: null,
            storeSettings: JSON.parse(localStorage.getItem('wassam_settings')) || {
                whatsappLink: 'https://wa.me/962790781206',
                storeEmail: 'wesamelectronics@gmail.com',
                facebookLink: '',
                googleMapsLink: '',
                youtubeLink: ''
            },
            pageContent: JSON.parse(localStorage.getItem('wassam_page_content')) || {
                storeName: 'Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™',
                wesamLogoText: 'wesam',
                storeSlogan: 'ŸÖÿ™ÿÆÿµÿµŸàŸÜ ŸÅŸä ÿ£ÿ¨Ÿáÿ≤ÿ© TV-LCD-LED ŸàÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™',
                phoneNumber: '0790781206',
                storeAddress: 'ÿπŸÖÿßŸÜ - ÿ¥ŸÅÿßÿ®ÿØÿ±ÿßŸÜ',
                storeTagline: 'ÿ£ŸÅÿ∂ŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ© ÿ®ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± - ÿ¨ŸàÿØÿ© Ÿàÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä',
                specializationText: 'TV - LCD - LED - ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™',
                footerAbout: 'ŸÖÿ™ÿ¨ÿ± Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™ ŸáŸà ÿßŸÑŸàÿ¨Ÿáÿ© ÿßŸÑŸÖŸÅÿ∂ŸÑÿ© ŸÅŸä ÿπŸÖÿßŸÜ ŸÑÿ¥ÿ±ÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ© ŸàÿßŸÑÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™ ÿ∞ÿßÿ™ ÿßŸÑÿ¨ŸàÿØÿ© ÿßŸÑÿπÿßŸÑŸäÿ©. ŸÜŸÇÿØŸÖ ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÖÿπ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä.',
                storeEmail: 'wesamelectronics@gmail.com',
                workingHours: '9:00 ÿµ - 10:00 ŸÖ',
                servicesList: [
                    'ÿ™ŸàÿµŸäŸÑ ÿ≥ÿ±Ÿäÿπ ŸÑÿ¨ŸÖŸäÿπ ŸÖŸÜÿßÿ∑ŸÇ ÿπŸÖÿßŸÜ',
                    'ÿØŸÅÿπ ÿπŸÜÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ',
                    'ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ŸÅŸàÿ±Ÿä ŸÅŸä ÿ≠ÿßŸÑÿ© Ÿàÿ¨ŸàÿØ ÿπŸäÿ®',
                    'ÿ£ÿ≥ÿπÿßÿ± ÿ™ŸÜÿßŸÅÿ≥Ÿäÿ© Ÿàÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ©'
                ]
            },
            siteSettings: JSON.parse(localStorage.getItem('wassam_site_settings')) || {
                productOrder: [],
                categoryOrder: []
            },
            draggedProduct: null,
            draggedCategory: null,
            categories: [
                { id: "all", name: "ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ© ŸàÿßŸÑÿ£ŸÅÿ∂ŸÑ", icon: "fas fa-star" },
                { id: "ÿ≥ŸÖÿßÿπÿßÿ™", name: "ÿ≥ŸÖÿßÿπÿßÿ™", icon: "fas fa-headphones" },
                { id: "ÿ±ŸäŸÖŸàÿ™ÿßÿ™", name: "ÿ±ŸäŸÖŸàÿ™ÿßÿ™", icon: "fas fa-tv" },
                { id: "ÿ±ÿ≥ŸäŸÅÿ±ÿßÿ™", name: "ÿ±ÿ≥ŸäŸÅÿ±ÿßÿ™", icon: "fas fa-satellite-dish" },
                { id: "ÿ¥Ÿàÿßÿ≠ŸÜ Ÿàÿ£ÿ≥ŸÑÿßŸÉ", name: "ÿ¥Ÿàÿßÿ≠ŸÜ Ÿàÿ£ÿ≥ŸÑÿßŸÉ", icon: "fas fa-charging-station" },
                { id: "ÿ•ŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™", name: "ÿ•ŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™", icon: "fas fa-microchip" }
            ]
        };

        // ========== Ÿàÿ∏ÿßÿ¶ŸÅ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ==========

        function showFirebaseLoading(show) {
            elements.firebaseLoading.style.display = show ? 'flex' : 'none';
        }

        function showFirebaseError(show, message = '') {
            if (show) {
                elements.errorMessage.textContent = message || 'ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™';
                elements.firebaseErrorBanner.classList.add('show');
            } else {
                elements.firebaseErrorBanner.classList.remove('show');
            }
        }

        window.retryFirebaseConnection = async function() {
            showFirebaseError(false);
            showConnectionMessage('info', 'ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ...');
            
            try {
                const connection = await window.testFirebaseConnection();
                
                if (connection.success) {
                    await loadProducts();
                    showConnectionMessage('success', 'ÿ™ŸÖÿ™ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                } else {
                    showFirebaseError(true, 'ŸÅÿ¥ŸÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™.');
                }
            } catch (error) {
                showFirebaseError(true, 'ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ: ' + error.message);
            }
        };

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 20px;
                background-color: ${type === 'success' ? '#4caf50' : '#f44336'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // ========== ÿ•ÿØÿßÿ±ÿ© ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ ==========

        async function loadSiteSettings() {
            try {
                if (!firebaseInitialized) {
                    console.warn('Firebase ÿ∫Ÿäÿ± ŸÖŸáŸäÿ£ÿå ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©');
                    return;
                }
                
                const db = window.db;
                if (!db) {
                    console.warn('Firestore ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±');
                    return;
                }
                
                showFirebaseLoading(true);
                
                let orderingDoc, storeDoc, pageContentDoc;
                
                try {
                    [orderingDoc, storeDoc, pageContentDoc] = await Promise.allSettled([
                        db.collection('settings').doc('ordering').get(),
                        db.collection('settings').doc('store').get(),
                        db.collection('settings').doc('page_content').get()
                    ]);
                    
                    const getData = (result) => result.status === 'fulfilled' && result.value.exists ? result.value.data() : null;
                    
                    const orderingData = getData(orderingDoc);
                    const storeData = getData(storeDoc);
                    const pageContentData = getData(pageContentDoc);
                    
                    if (orderingData) {
                        state.siteSettings.productOrder = orderingData.productOrder || [];
                        state.siteSettings.categoryOrder = orderingData.categoryOrder || state.categories.map(c => c.id);
                    } else {
                        state.siteSettings.categoryOrder = state.categories.map(c => c.id);
                    }
                    
                    if (storeData) {
                        state.storeSettings = {
                            ...state.storeSettings,
                            ...storeData
                        };
                    }
                    
                    if (pageContentData) {
                        state.pageContent = {
                            ...state.pageContent,
                            ...pageContentData
                        };
                    }
                    
                } catch (error) {
                    console.warn('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿπÿ∂ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™:', error);
                }
                
                localStorage.setItem('wassam_site_settings', JSON.stringify(state.siteSettings));
                localStorage.setItem('wassam_settings', JSON.stringify(state.storeSettings));
                localStorage.setItem('wassam_page_content', JSON.stringify(state.pageContent));
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ:', error);
                showNotification('‚ö†Ô∏è ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖŸÜ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ≠ŸÑŸäÿ©', 'warning');
            } finally {
                showFirebaseLoading(false);
            }
        }

        // ========== ÿ•ÿØÿßÿ±ÿ© ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸàÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™ ==========

        async function loadProductOrder() {
            try {
                if (!firebaseInitialized || !window.db) {
                    console.warn('Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑÿå ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖÿ≠ŸÑŸä');
                    state.siteSettings.productOrder = state.products.map(p => p.id);
                    state.siteSettings.categoryOrder = state.categories.map(c => c.id);
                    return;
                }
                
                const db = window.db;
                const doc = await db.collection('settings').doc('ordering').get();
                
                if (doc.exists) {
                    const data = doc.data();
                    state.siteSettings.productOrder = data.productOrder || [];
                    state.siteSettings.categoryOrder = data.categoryOrder || state.categories.map(c => c.id);
                } else {
                    state.siteSettings.categoryOrder = state.categories.map(c => c.id);
                }
                
                if (state.siteSettings.productOrder.length === 0) {
                    state.siteSettings.productOrder = state.products.map(p => p.id);
                }
                
                displayProductOrderList();
                displayCategoryOrderList();
                displayCategoriesList();
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:', error);
                state.siteSettings.productOrder = state.products.map(p => p.id);
                state.siteSettings.categoryOrder = state.categories.map(c => c.id);
            }
        }

        function displayProductOrderList() {
            elements.productOrderList.innerHTML = '';
            
            const orderedProducts = [...state.products].sort((a, b) => {
                const indexA = state.siteSettings.productOrder.indexOf(a.id);
                const indexB = state.siteSettings.productOrder.indexOf(b.id);
                return indexA - indexB;
            });
            
            orderedProducts.forEach(product => {
                const orderItem = document.createElement('div');
                orderItem.className = 'product-order-item';
                orderItem.draggable = true;
                orderItem.dataset.id = product.id;
                
                orderItem.innerHTML = `
                    <i class="fas fa-grip-vertical"></i>
                    <img src="${product.image}" alt="${product.name}" class="product-order-item-image" 
                         onerror="this.src='https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'">
                    <div class="product-order-item-details">
                        <div class="product-order-item-name">${product.name}</div>
                        <div class="product-order-item-category">${product.category}</div>
                    </div>
                    <div class="product-order-item-price">${product.sell} ÿØŸäŸÜÿßÿ±</div>
                `;
                
                orderItem.addEventListener('dragstart', handleProductDragStart);
                orderItem.addEventListener('dragover', handleProductDragOver);
                orderItem.addEventListener('drop', handleProductDrop);
                orderItem.addEventListener('dragend', handleProductDragEnd);
                
                elements.productOrderList.appendChild(orderItem);
            });
        }

        function displayCategoryOrderList() {
            elements.categoryOrderList.innerHTML = '';
            
            const orderedCategories = [...state.categories].sort((a, b) => {
                const indexA = state.siteSettings.categoryOrder.indexOf(a.id);
                const indexB = state.siteSettings.categoryOrder.indexOf(b.id);
                return indexA - indexB;
            });
            
            orderedCategories.forEach(category => {
                const categoryCount = category.id === "all" 
                    ? state.products.length 
                    : state.products.filter(p => p.category === category.id).length;
                
                const orderItem = document.createElement('div');
                orderItem.className = 'category-order-item';
                orderItem.draggable = true;
                orderItem.dataset.id = category.id;
                
                orderItem.innerHTML = `
                    <i class="fas fa-grip-vertical"></i>
                    <i class="${category.icon}"></i>
                    <div class="category-order-item-name">${category.name}</div>
                    <div class="category-order-item-count">${categoryCount}</div>
                `;
                
                orderItem.addEventListener('dragstart', handleCategoryDragStart);
                orderItem.addEventListener('dragover', handleCategoryDragOver);
                orderItem.addEventListener('drop', handleCategoryDrop);
                orderItem.addEventListener('dragend', handleCategoryDragEnd);
                
                elements.categoryOrderList.appendChild(orderItem);
            });
        }

        function displayCategoriesList() {
            elements.categoriesList.innerHTML = '';
            
            state.categories.forEach(category => {
                if (category.id === "all") return;
                
                const categoryCount = state.products.filter(p => p.category === category.id).length;
                
                const listItem = document.createElement('div');
                listItem.className = 'category-list-item';
                listItem.innerHTML = `
                    <div>
                        <i class="${category.icon}"></i>
                        <strong>${category.name}</strong>
                        <span style="color: #666; font-size: 0.9rem; margin-right: 10px;">(${categoryCount} ŸÖŸÜÿ™ÿ¨)</span>
                    </div>
                    <button class="delete-btn delete-category-btn" data-category="${category.id}">
                        <i class="fas fa-trash"></i> ÿ≠ÿ∞ŸÅ
                    </button>
                `;
                
                elements.categoriesList.appendChild(listItem);
            });
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ≠ÿ∞ŸÅ
            elements.categoriesList.querySelectorAll('.delete-category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryId = this.dataset.category;
                    deleteCategory(categoryId);
                });
            });
        }

        async function deleteCategory(categoryId) {
            if (!confirm(`ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ™ÿµŸÜŸäŸÅ "${categoryId}"ÿü ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿ™ÿµŸÜŸäŸÅ.`)) {
                return;
            }
            
            try {
                // ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿ™ÿµŸÜŸäŸÅ
                const productsToDelete = state.products.filter(p => p.category === categoryId);
                for (const product of productsToDelete) {
                    await deleteProduct(product.id);
                }
                
                // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                state.categories = state.categories.filter(c => c.id !== categoryId);
                
                // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                updateCategoryDropdown();
                displayCategoriesList();
                updateUI();
                
                showNotification(`‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ${categoryId} Ÿàÿ¨ŸÖŸäÿπ ŸÖŸÜÿ™ÿ¨ÿßÿ™Ÿá`);
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ™ÿµŸÜŸäŸÅ:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ™ÿµŸÜŸäŸÅ: ${error.message}`);
            }
        }

        // ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™ ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
        function handleProductDragStart(e) {
            state.draggedProduct = this;
            this.classList.add('dragging');
        }

        function handleProductDragOver(e) {
            e.preventDefault();
        }

        function handleProductDrop(e) {
            e.preventDefault();
            if (state.draggedProduct !== this) {
                const allItems = Array.from(elements.productOrderList.children);
                const draggedIndex = allItems.indexOf(state.draggedProduct);
                const targetIndex = allItems.indexOf(this);
                
                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(state.draggedProduct, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(state.draggedProduct, this);
                }
            }
        }

        function handleProductDragEnd(e) {
            this.classList.remove('dragging');
            
            const newOrder = Array.from(elements.productOrderList.children).map(item => item.dataset.id);
            state.siteSettings.productOrder = newOrder;
        }

        // ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™ ŸÑŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™
        function handleCategoryDragStart(e) {
            state.draggedCategory = this;
            this.classList.add('dragging');
        }

        function handleCategoryDragOver(e) {
            e.preventDefault();
        }

        function handleCategoryDrop(e) {
            e.preventDefault();
            if (state.draggedCategory !== this) {
                const allItems = Array.from(elements.categoryOrderList.children);
                const draggedIndex = allItems.indexOf(state.draggedCategory);
                const targetIndex = allItems.indexOf(this);
                
                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(state.draggedCategory, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(state.draggedCategory, this);
                }
            }
        }

        function handleCategoryDragEnd(e) {
            this.classList.remove('dragging');
            
            const newOrder = Array.from(elements.categoryOrderList.children).map(item => item.dataset.id);
            state.siteSettings.categoryOrder = newOrder;
        }

        async function saveProductOrder() {
            try {
                if (!firebaseInitialized) {
                    throw new Error("Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ");
                }
                
                const db = getDbSafe();
                if (!db) throw new Error('ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ÿ©');
                showFirebaseLoading(true);
                
                await db.collection('settings').doc('ordering').set({
                    productOrder: state.siteSettings.productOrder,
                    categoryOrder: state.siteSettings.categoryOrder,
                    lastUpdated: getServerTimestamp()
                }, { merge: true });
                
                showNotification('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™');
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®: ${error.message}`);
            } finally {
                showFirebaseLoading(false);
            }
        }

        async function saveCategoryOrder() {
            try {
                if (!firebaseInitialized) {
                    throw new Error("Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ");
                }
                
                const db = getDbSafe();
                if (!db) throw new Error('ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ÿ©');
                showFirebaseLoading(true);
                
                await db.collection('settings').doc('ordering').set({
                    categoryOrder: state.siteSettings.categoryOrder,
                    lastUpdated: getServerTimestamp()
                }, { merge: true });
                
                showNotification('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™');
                
                displayCategories();
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®: ${error.message}`);
            } finally {
                showFirebaseLoading(false);
            }
        }

        // ========== ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿµŸÜŸäŸÅÿßÿ™ ÿ¨ÿØŸäÿØÿ© ==========

        async function addNewCategory(categoryName, icon) {
            try {
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ŸÖÿ≥ÿ®ŸÇÿßŸã
                const existingCategory = state.categories.find(c => c.id === categoryName);
                if (existingCategory) {
                    alert('Ÿáÿ∞ÿß ÿßŸÑÿ™ÿµŸÜŸäŸÅ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                    return;
                }
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ¨ÿØŸäÿØ
                const newCategory = {
                    id: categoryName,
                    name: categoryName,
                    icon: icon
                };
                
                state.categories.push(newCategory);
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®
                state.siteSettings.categoryOrder.push(categoryName);
                
                // ÿ≠ŸÅÿ∏ ŸÅŸä Firebase ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ™ÿµŸÑÿßŸã
                if (firebaseInitialized && window.db) {
                    const db = getDbSafe();
                    if (!db) throw new Error('ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ÿ©');
                    await db.collection('settings').doc('ordering').set({
                        categoryOrder: state.siteSettings.categoryOrder,
                        lastUpdated: getServerTimestamp()
                    }, { merge: true });
                }
                
                // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                updateCategoryDropdown();
                displayCategoriesList();
                updateUI();
                
                // ŸÖÿ≥ÿ≠ ÿßŸÑÿ≠ŸÇŸàŸÑ
                elements.newCategoryName.value = '';
                elements.newCategoryIcon.value = 'fas fa-headphones';
                
                showNotification(`‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ "${categoryName}" ÿ®ŸÜÿ¨ÿßÿ≠`);
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ: ${error.message}`);
            }
        }

        // ========== ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿ¨ÿ± ==========

        async function loadStoreSettings() {
            elements.whatsappLink.value = state.storeSettings.whatsappLink || '';
            if (elements.storeEmailSettings) elements.storeEmailSettings.value = state.storeSettings.storeEmail || 'wesamelectronics@gmail.com';
            elements.facebookLink.value = state.storeSettings.facebookLink || '';
            elements.googleMapsLink.value = state.storeSettings.googleMapsLink || '';
            elements.youtubeLink.value = state.storeSettings.youtubeLink || '';
            updateContactLinksUI();
            
            elements.storeName.value = state.pageContent.storeName;
            elements.wesamLogoText.value = state.pageContent.wesamLogoText;
            elements.storeSlogan.value = state.pageContent.storeSlogan;
            elements.phoneNumber.value = state.pageContent.phoneNumber;
            elements.storeAddress.value = state.pageContent.storeAddress;
            elements.storeTagline.value = state.pageContent.storeTagline;
            elements.specializationText.value = state.pageContent.specializationText;
            elements.footerAbout.value = state.pageContent.footerAbout;
            elements.storeEmail.value = state.pageContent.storeEmail;
            elements.workingHours.value = state.pageContent.workingHours;
            elements.servicesList.value = Array.isArray(state.pageContent.servicesList) 
                ? state.pageContent.servicesList.join('\n') 
                : state.pageContent.servicesList;
            
            updatePageContentUI();
            updateSocialLinks();
        }

        async function saveStoreSettings() {
            try {
                const settings = {
                    whatsappLink: elements.whatsappLink.value.trim(),
                    facebookLink: elements.facebookLink.value.trim(),
                    googleMapsLink: elements.googleMapsLink.value.trim(),
                    youtubeLink: elements.youtubeLink.value.trim(),
                    storeEmail: (elements.storeEmailSettings ? elements.storeEmailSettings.value.trim() : '')
                };
                
                state.storeSettings = settings;
                
                showFirebaseLoading(true);
                
                if (firebaseInitialized && window.db) {
                    const db = getDbSafe();
                    if (!db) throw new Error('ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ÿ©');
                    await db.collection('settings').doc('store').set({
                        ...settings,
                        updatedAt: getServerTimestamp()
                    }, { merge: true });
                }
                
                localStorage.setItem('wassam_settings', JSON.stringify(settings));
                updateSocialLinks();
                showNotification('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿ¨ÿ±');
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿ¨ÿ±:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™: ${error.code ? (error.code + ' - ') : ''}${error.message}`);
            } finally {
                showFirebaseLoading(false);
            }
        }

        async function savePageContent() {
            try {
                const pageContent = {
                    storeName: elements.storeName.value.trim(),
                    wesamLogoText: elements.wesamLogoText.value.trim(),
                    storeSlogan: elements.storeSlogan.value.trim(),
                    phoneNumber: elements.phoneNumber.value.trim(),
                    storeAddress: elements.storeAddress.value.trim(),
                    storeTagline: elements.storeTagline.value.trim(),
                    specializationText: elements.specializationText.value.trim(),
                    footerAbout: elements.footerAbout.value.trim(),
                    storeEmail: elements.storeEmail.value.trim(),
                    workingHours: elements.workingHours.value.trim(),
                    servicesList: elements.servicesList.value.trim().split('\n').filter(line => line.trim() !== ''),
                    updatedAt: getServerTimestamp()
                };
                
                state.pageContent = pageContent;
                
                showFirebaseLoading(true);
                
                if (firebaseInitialized && window.db) {
                    const db = getDbSafe();
                    if (!db) throw new Error('ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ÿ©');
                    await db.collection('settings').doc('page_content').set(pageContent, { merge: true });
                }
                
                localStorage.setItem('wassam_page_content', JSON.stringify(pageContent));
                updatePageContentUI();
                showNotification('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿµŸÅÿ≠ÿ©');
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿµŸÅÿ≠ÿ©:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ: ${error.code ? (error.code + ' - ') : ''}${error.message}`);
            } finally {
                showFirebaseLoading(false);
            }
        }

        function updatePageContentUI() {
            document.querySelector('.logo-subtext').textContent = state.pageContent.storeName;
            elements.wesamLogo.textContent = state.pageContent.wesamLogoText;
            document.querySelector('.logo-slogan').textContent = state.pageContent.storeSlogan;
            document.querySelector('.phone-number').innerHTML = `<i class="fas fa-phone"></i> ${state.pageContent.phoneNumber}`;
            
            const addressElement = document.querySelector('.contact-info div:nth-child(2)');
            addressElement.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${state.pageContent.storeAddress}`;
            
            document.querySelector('.tagline').textContent = state.pageContent.storeTagline;
            document.querySelector('.specialization').innerHTML = `<i class="fas fa-tv"></i> ${state.pageContent.specializationText}`;
            
            elements.footerAboutText.textContent = state.pageContent.footerAbout;
            elements.footerAddress.textContent = state.pageContent.storeAddress;
            elements.footerPhone.textContent = state.pageContent.phoneNumber;
            elements.footerHours.textContent = state.pageContent.workingHours;
            elements.footerEmail.textContent = state.pageContent.storeEmail;
            
            elements.footerServices.innerHTML = '';
            if (Array.isArray(state.pageContent.servicesList)) {
                state.pageContent.servicesList.forEach(service => {
                    const li = document.createElement('li');
                    li.innerHTML = `<i class="fas fa-chevron-left"></i> ${service}`;
                    elements.footerServices.appendChild(li);
                });
            }
        }

        
        // Normalize external links to ensure they open correctly (adds https:// when missing)
        function normalizeUrl(url) {
            try {
                if (!url) return '';
                url = String(url).trim();
                if (!url) return '';
                // allow special schemes
                if (/^(https?:\/\/|mailto:|tel:|whatsapp:)/i.test(url)) return url;
                // allow wa.me direct
                if (/^(wa\.me\/)/i.test(url)) return 'https://' + url;
                // if starts with // treat as https
                if (/^\/\//.test(url)) return 'https:' + url;
                // default
                return 'https://' + url;
            } catch (e) {
                return url || '';
            }
        }

function updateSocialLinks() {
            elements.socialLinks.innerHTML = '';
            
            if (state.storeSettings.whatsappLink) {
                const whatsappLink = document.createElement('a');
                whatsappLink.href = normalizeUrl(state.storeSettings.whatsappLink);
                whatsappLink.target = '_blank';
                whatsappLink.className = 'social-link whatsapp';
                whatsappLink.innerHTML = '<i class="fab fa-whatsapp"></i>';
                whatsappLink.title = 'ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß ÿπŸÑŸâ Ÿàÿßÿ™ÿ≥ÿßÿ®';
                elements.socialLinks.appendChild(whatsappLink);
            }
            
            if (state.storeSettings.facebookLink) {
                const facebookLink = document.createElement('a');
                facebookLink.href = normalizeUrl(state.storeSettings.facebookLink);
                facebookLink.target = '_blank';
                facebookLink.className = 'social-link facebook';
                facebookLink.innerHTML = '<i class="fab fa-facebook-f"></i>';
                facebookLink.title = 'ÿµŸÅÿ≠ÿ™ŸÜÿß ÿπŸÑŸâ ÿßŸÑŸÅŸäÿ≥ÿ®ŸàŸÉ';
                elements.socialLinks.appendChild(facebookLink);
            }
            
            if (state.storeSettings.googleMapsLink) {
                const mapLink = document.createElement('a');
                mapLink.href = normalizeUrl(state.storeSettings.googleMapsLink);
                mapLink.target = '_blank';
                mapLink.className = 'social-link map';
                mapLink.innerHTML = '<i class="fas fa-map-marker-alt"></i>';
                mapLink.title = 'ŸÖŸàŸÇÿπŸÜÿß ÿπŸÑŸâ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ¨Ÿàÿ¨ŸÑ';
                elements.socialLinks.appendChild(mapLink);
            }
            
            if (state.storeSettings.youtubeLink) {
                const youtubeLink = document.createElement('a');
                youtubeLink.href = normalizeUrl(state.storeSettings.youtubeLink);
                youtubeLink.target = '_blank';
                youtubeLink.className = 'social-link youtube';
                youtubeLink.innerHTML = '<i class="fab fa-youtube"></i>';
                youtubeLink.title = 'ŸÇŸÜÿßÿ™ŸÜÿß ÿπŸÑŸâ ÿßŸÑŸäŸàÿ™ŸäŸàÿ®';
                elements.socialLinks.appendChild(youtubeLink);
            }
            
            elements.footerSocialLinks.innerHTML = '';
            
            if (state.storeSettings.whatsappLink) {
                const footerWhatsapp = document.createElement('a');
                footerWhatsapp.href = state.storeSettings.whatsappLink;
                footerWhatsapp.target = '_blank';
                footerWhatsapp.className = 'footer-social-link';
                footerWhatsapp.innerHTML = '<i class="fab fa-whatsapp"></i>';
                footerWhatsapp.title = 'Ÿàÿßÿ™ÿ≥ÿßÿ®';
                elements.footerSocialLinks.appendChild(footerWhatsapp);
            }
            
            if (state.storeSettings.facebookLink) {
                const footerFacebook = document.createElement('a');
                footerFacebook.href = state.storeSettings.facebookLink;
                footerFacebook.target = '_blank';
                footerFacebook.className = 'footer-social-link';
                footerFacebook.innerHTML = '<i class="fab fa-facebook-f"></i>';
                footerFacebook.title = 'ŸÅŸäÿ≥ÿ®ŸàŸÉ';
                elements.footerSocialLinks.appendChild(footerFacebook);
            }
            
            if (state.storeSettings.googleMapsLink) {
                const footerMap = document.createElement('a');
                footerMap.href = state.storeSettings.googleMapsLink;
                footerMap.target = '_blank';
                footerMap.className = 'footer-social-link';
                footerMap.innerHTML = '<i class="fas fa-map-marker-alt"></i>';
                footerMap.title = 'ÿÆÿ±ÿßÿ¶ÿ∑ ÿ¨Ÿàÿ¨ŸÑ';
                elements.footerSocialLinks.appendChild(footerMap);
            }
            
            if (state.storeSettings.youtubeLink) {
                const footerYoutube = document.createElement('a');
                footerYoutube.href = state.storeSettings.youtubeLink;
                footerYoutube.target = '_blank';
                footerYoutube.className = 'footer-social-link';
                footerYoutube.innerHTML = '<i class="fab fa-youtube"></i>';
                footerYoutube.title = 'ŸäŸàÿ™ŸäŸàÿ®';
                elements.footerSocialLinks.appendChild(footerYoutube);
            }
            /* sync mobile quickstrip links */
            const mW = document.getElementById('mQSWhatsApp');
            const mF = document.getElementById('mQSFb');
            const mM = document.getElementById('mQSMaps');
            const mY = document.getElementById('mQSYt');
            const mE = document.getElementById('mQSEmail');

            if (mW) mW.href = normalizeUrl(state.storeSettings.whatsappLink) || 'https://wa.me/962790781206';
            if (mE) mE.href = (state.storeSettings.storeEmail ? ('mailto:' + String(state.storeSettings.storeEmail).trim()) : 'mailto:wesamelectronics@gmail.com');
            if (mF) mF.href = normalizeUrl(state.storeSettings.facebookLink) || 'https://facebook.com';
            if (mM) mM.href = normalizeUrl(state.storeSettings.googleMapsLink) || 'https://maps.google.com';
            if (mY) mY.href = normalizeUrl(state.storeSettings.youtubeLink) || 'https://youtube.com';


        }

        // ========== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ==========

        async function loadProducts() {
            try {
                elements.loading.style.display = 'flex';
                
                if (!firebaseInitialized) {
                    throw new Error("Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ ŸàÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™.");
                }
                
                const db = window.db;
                if (!db) {
                    throw new Error("Firestore ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±");
                }
                
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error("ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ")), 10000)
                );
                
                const queryPromise = db.collection('products').orderBy('createdAt', 'desc').get();
                
                const querySnapshot = await Promise.race([queryPromise, timeoutPromise]);
                
                const products = [];
                
                querySnapshot.forEach(doc => {
                    const product = doc.data();
                    product.id = doc.id;
                    if (!product.additionalImages) product.additionalImages = [];
                    if (!product.videoUrl) product.videoUrl = '';
                    products.push(product);
                });
                
                state.products = products;
                state.filteredProducts = [...products];
                
                console.log(`‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${products.length} ŸÖŸÜÿ™ÿ¨ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™`);
                showConnectionMessage('success', `ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${products.length} ŸÖŸÜÿ™ÿ¨`);
                
                state.isFirebaseConnected = true;
                showFirebaseError(false);
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:', error);
                
                if (state.products.length === 0) {
                    state.products = getSampleProducts();
                    state.filteredProducts = [...state.products];
                    console.log(`‚ö†Ô∏è ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ${state.products.length} ŸÖŸÜÿ™ÿ¨ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä`);
                    showConnectionMessage('warning', 'ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑÿå ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©');
                }
                
                state.isFirebaseConnected = false;
                showFirebaseError(true, `ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ: ${error.message}`);
                
            } finally {
                elements.loading.style.display = 'none';
                updateUI();
            }
        }

        function getSampleProducts() {
            return [
                {
                    id: '1',
                    name: 'ÿ≥ŸÖÿßÿπÿ© ÿ®ŸÑŸàÿ™Ÿàÿ´ ŸÑÿßÿ≥ŸÑŸÉŸäÿ©',
                    category: 'ÿ≥ŸÖÿßÿπÿßÿ™',
                    sell: 25,
                    stock: 10,
                    description: 'ÿ≥ŸÖÿßÿπÿ© ÿ®ŸÑŸàÿ™Ÿàÿ´ ÿπÿßŸÑŸäÿ© ÿßŸÑÿ¨ŸàÿØÿ©ÿå ÿ®ÿ∑ÿßÿ±Ÿäÿ© ÿ™ÿØŸàŸÖ 8 ÿ≥ÿßÿπÿßÿ™',
                    image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
                    deliveryFee: 2,
                    videoUrl: '',
                    additionalImages: []
                },
                {
                    id: '2',
                    name: 'ÿ±ŸäŸÖŸàÿ™ ÿ™ŸÑŸÅÿ≤ŸäŸàŸÜ ÿπÿßŸÑŸÖŸä',
                    category: 'ÿ±ŸäŸÖŸàÿ™ÿßÿ™',
                    sell: 15,
                    stock: 5,
                    description: 'ÿ±ŸäŸÖŸàÿ™ ŸäÿπŸÖŸÑ ŸÖÿπ ŸÖÿπÿ∏ŸÖ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ™ŸÑŸÅÿ≤ŸäŸàŸÜÿßÿ™',
                    image: 'https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
                    deliveryFee: 2,
                    videoUrl: '',
                    additionalImages: []
                }
            ];
        }

        async function saveProduct(productData) {
            try {
                if (!firebaseInitialized) {
                    throw new Error("Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ");
                }
                
                const db = getDbSafe();
                if (!db) throw new Error('ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ÿ©');
                showFirebaseLoading(true);
                
                productData.name = document.getElementById('productName').value;
                productData.category = document.getElementById('productCategory').value;
                productData.sell = parseFloat(document.getElementById('productPrice').value);
                productData.stock = parseInt(document.getElementById('productStock').value);
                productData.featured = !!document.getElementById('productFeatured')?.checked;
                productData.description = document.getElementById('productDescription').value || '';
                productData.deliveryFee = parseFloat(document.getElementById('productDeliveryFee').value) || 2;
                productData.videoUrl = document.getElementById('productVideoUrl').value.trim() || '';
                
                const mainImageUrl = document.getElementById('productImageUrl').value.trim();
                if (!mainImageUrl.startsWith('http')) {
                    alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ±ÿßÿ®ÿ∑ ÿµÿ≠Ÿäÿ≠ ŸÑŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© Ÿäÿ®ÿØÿ£ ÿ®ŸÄ http:// ÿ£Ÿà https://');
                    return;
                }
                productData.image = mainImageUrl;
                
                const additionalImageInputs = document.querySelectorAll('.additional-image-url');
                const additionalImages = [];
                additionalImageInputs.forEach(input => {
                    const url = input.value.trim();
                    if (url && url.startsWith('http')) {
                        additionalImages.push(url);
                    }
                });
                productData.additionalImages = additionalImages;
                
                productData.updatedAt = getServerTimestamp();
                
                if (!productData.createdAt) {
                    productData.createdAt = getServerTimestamp();
                }
                
                const saveBtn = elements.addProductForm.querySelector('.save-btn');
                if (saveBtn.dataset.productId) {
                    await db.collection('products').doc(saveBtn.dataset.productId).update(productData);
                    showNotification('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠');
                } else {
                    await db.collection('products').add(productData);
                    showNotification('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠');
                }
                
                await loadProducts();
                clearForm();
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨: ${error.code ? (error.code + ' - ') : ''}${error.message}`);
            } finally {
                showFirebaseLoading(false);
            }
        }

        async function deleteProduct(productId) {
            if (!confirm("ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ÿü")) {
                return;
            }
            
            try {
                if (!firebaseInitialized) {
                    throw new Error("Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ");
                }
                
                const db = getDbSafe();
                if (!db) throw new Error('ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ÿ©');
                showFirebaseLoading(true);
                await db.collection('products').doc(productId).delete();
                showNotification('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠');
                await loadProducts();
                
            } catch (error) {
                console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨:', error);
                alert(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÜÿ™ÿ¨: ${error.message}`);
            } finally {
                showFirebaseLoading(false);
            }
        }

        function updateCategoryCounts() {
            state.categories.forEach(category => {
                category.count = category.id === "all" 
                    ? state.products.length 
                    : state.products.filter(p => p.category === category.id).length;
            });
        }

        function displayCategories() {
            elements.categoriesGrid.innerHTML = '';
            
            const orderedCategories = [...state.categories].sort((a, b) => {
                const indexA = state.siteSettings.categoryOrder.indexOf(a.id);
                const indexB = state.siteSettings.categoryOrder.indexOf(b.id);
                return indexA - indexB;
            });
            
            orderedCategories.forEach(category => {
                const categoryCard = document.createElement('div');
                categoryCard.className = `category-card ${state.currentCategory === category.id ? 'active' : ''}`;
                categoryCard.dataset.category = category.id;
                
                categoryCard.innerHTML = `
                    <div class="category-icon">
                        <i class="${category.icon}"></i>
                    </div>
                    <div class="category-name">
                        ${category.name}
                        <div class="category-count">${category.count} ŸÖŸÜÿ™ÿ¨</div>
                    </div>
                `;
                
                categoryCard.addEventListener('click', () => {
                    state.currentCategory = category.id;
                    displayCategories();
                    filterProducts();
                });
                
                elements.categoriesGrid.appendChild(categoryCard);
            });
        }

        function truncateDescription(description, maxLength = 100) {
            if (!description) return '';
            if (description.length <= maxLength) return description;
            return description.substring(0, maxLength) + '...';
        }

        function displayProducts(products) {
            elements.productsGrid.innerHTML = '';
            
            if (products.length === 0) {
                elements.noProducts.style.display = 'block';
                return;
            }
            
            elements.noProducts.style.display = 'none';
            
            const orderedProducts = [...products].sort((a, b) => {
                const indexA = state.siteSettings.productOrder.indexOf(a.id);
                const indexB = state.siteSettings.productOrder.indexOf(b.id);
                
                if (indexA === -1) return 1;
                if (indexB === -1) return -1;
                
                return indexA - indexB;
            });
            
            orderedProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                let stockClass = 'in-stock';
                let stockText = `ŸÖÿ™ŸàŸÅÿ± (${product.stock})`;
                if (product.stock === 0) {
                    stockClass = 'out-of-stock';
                    stockText = 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±';
                } else if (product.stock <= 2) {
                    stockClass = 'low-stock';
                    stockText = `ŸÉŸÖŸäÿ© ŸÖÿ≠ÿØŸàÿØÿ© (${product.stock})`;
                }
                
                const hasAdditionalImages = product.additionalImages && product.additionalImages.length > 0;
                const allImages = [product.image, ...(product.additionalImages || [])].filter(img => img);
                const hasVideo = product.videoUrl && product.videoUrl.trim() !== '';
                
                productCard.innerHTML = `
                    <div class="product-image" data-product-id="${product.id}">
                        ${hasVideo ? `<button class="video-btn-card" data-video-url="${product.videoUrl}" onclick="if(event){event.stopPropagation();} openVideoPopup(this.dataset.videoUrl); return false;"><i class="fas fa-play"></i></button>` : ''}
                        <div class="product-category">${product.category}</div>
                        <img src="${product.image}" 
                             alt="${product.name}" 
                             onerror="this.src='https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'">
                        ${hasAdditionalImages ? 
                            `<div class="more-images-badge show">
                                <i class="fas fa-images"></i> ${allImages.length} ÿµŸàÿ±
                            </div>` : ''
                        }
                    </div>
                    <div class="product-details">
                        <h3 class="product-name" data-product-id="${product.id}">${product.name}</h3>
                        ${product.description ? `
                            <div class="product-description" id="desc-${product.id}">
                                ${truncateDescription(product.description)}
                            </div>
                            ${product.description.length > 100 ? `
                                <button class="read-more" onclick="toggleDescription('${product.id}')">
                                    ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≤ŸäÿØ
                                </button>
                            ` : ''}
                        ` : ''}
                        <div class="product-price">
                            <i class="fas fa-dollar-sign"></i>
                            ${product.sell} ÿØŸäŸÜÿßÿ±
                        </div>
                        <div class="delivery-fee">
                            <i class="fas fa-truck"></i>
                            ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ: ${product.deliveryFee || 2} ÿØŸäŸÜÿßÿ±
                        </div>
                        <div class="product-stock ${stockClass}">
                            <i class="fas ${product.stock > 0 ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                            ${stockText}
                        </div>
                        <div class="product-actions">
                            <button class="details-btn" title="ÿπÿ±ÿ∂ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨" onclick="openGallery('${product.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="buy-btn" ${product.stock === 0 ? 'disabled' : ''}>
                                <i class="fas fa-shopping-cart"></i>
                                ${product.stock === 0 ? 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±' : 'ÿ£ÿ∂ŸÅ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©'}
                            </button>
                        </div>
                    </div>
                `;
                
                const buyBtn = productCard.querySelector('.buy-btn');
                if (buyBtn && product.stock > 0) {
                    buyBtn.addEventListener('click', () => addToCart(product));
                }
                
                const productImage = productCard.querySelector('.product-image');
                productImage.addEventListener('click', () => openGallery(product.id));

                const videoBtn = productCard.querySelector('.video-btn-card');
                if (videoBtn) {
                    videoBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openVideoPopup(videoBtn.dataset.videoUrl);
                    });
                }

                
                const productName = productCard.querySelector('.product-name');
                productName.addEventListener('click', () => openGallery(product.id));
                
                elements.productsGrid.appendChild(productCard);
            });
        }

        // Ÿàÿ∏ŸäŸÅÿ© ŸÑÿπÿ±ÿ∂/ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸàÿµŸÅ
        

        // ŸÅÿ™ÿ≠ ŸÅŸäÿØŸäŸà ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÅŸä ŸÖŸÜÿµÿ© ÿÆÿßÿ±ÿ¨Ÿäÿ© (YouTube/Facebook/TikTok/Instagram)
        

        window.toggleDescription = function(productId) {
            const descElement = document.getElementById(`desc-${productId}`);
            const button = descElement.nextElementSibling;
            
            if (descElement.classList.contains('expanded')) {
                descElement.classList.remove('expanded');
                const product = state.products.find(p => p.id === productId);
                descElement.textContent = truncateDescription(product ? product.description : '');
                button.textContent = 'ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≤ŸäÿØ';
            } else {
                const product = state.products.find(p => p.id === productId);
                descElement.classList.add('expanded');
                descElement.textContent = product ? product.description : '';
                button.textContent = 'ÿπÿ±ÿ∂ ÿ£ŸÇŸÑ';
            }
        };

        // Ÿàÿ∏ŸäŸÅÿ© ŸÅÿ™ÿ≠ ŸÖÿπÿ±ÿ∂ ÿßŸÑÿµŸàÿ±
        window.openGallery = function(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return;
            
            state.currentGalleryProduct = product;
            
            elements.galleryProductName.textContent = product.name;
            elements.galleryMainImage.src = product.image;
            
            elements.galleryThumbnails.innerHTML = '';
            const allImages = [product.image, ...(product.additionalImages || [])].filter(img => img);
            
            allImages.forEach((imageUrl, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = `gallery-thumbnail ${index === 0 ? 'active' : ''}`;
                thumbnail.innerHTML = `<img src="${imageUrl}" alt="ÿµŸàÿ±ÿ© ${index + 1}">`;
                
                thumbnail.addEventListener('click', () => {
                    elements.galleryMainImage.src = imageUrl;
                    document.querySelectorAll('.gallery-thumbnail').forEach(t => t.classList.remove('active'));
                    thumbnail.classList.add('active');
                });
                
                elements.galleryThumbnails.appendChild(thumbnail);
            });
            
            let detailsHTML = `
                <h4>ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨</h4>
                <p><strong>ÿßŸÑÿ≥ÿπÿ±:</strong> ${product.sell} ÿØŸäŸÜÿßÿ±</p>
                <p><strong>ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ:</strong> ${product.deliveryFee || 2} ÿØŸäŸÜÿßÿ±</p>
                <p><strong>ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ:</strong> ${product.stock > 0 ? `ŸÖÿ™ŸàŸÅÿ± (${product.stock})` : 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±'}</p>
                <p><strong>ÿßŸÑŸÅÿ¶ÿ©:</strong> ${product.category}</p>
            `;
            
            if (product.videoUrl) {
                detailsHTML += `
                    <button class="video-btn" onclick="openVideoPopup('${product.videoUrl}');">
                        <i class="fab fa-youtube"></i> ŸÖÿ¥ÿßŸáÿØÿ© ŸÅŸäÿØŸäŸà ÿßŸÑŸÖŸÜÿ™ÿ¨
                    </button>
                `;
            }
            
            if (product.description) {
                detailsHTML += `<div style="margin-top: 15px;"><strong>ÿßŸÑŸàÿµŸÅ ŸàÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™:</strong><p>${product.description}</p></div>`;
            }
            
            elements.galleryProductDetails.innerHTML = detailsHTML;
            
            elements.galleryModal.style.display = 'block';
            elements.overlay.classList.add('active');
        };

        function updateProductsSectionTitle() {
            const titleEl = document.getElementById('productsSectionTitle');
            if (!titleEl) return;
            const cat = state.categories.find(c => c.id === state.currentCategory);
            if (state.currentCategory === 'all') {
                titleEl.innerHTML = '<i class="fas fa-star"></i> ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ© ŸàÿßŸÑÿ£ŸÅÿ∂ŸÑ';
            } else {
                titleEl.innerHTML = `<i class="fas fa-layer-group"></i> ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ™ÿµŸÜŸäŸÅ: ${cat ? cat.name : state.currentCategory}`;
            }
        }

        function filterProducts() {
            const searchTerm = elements.searchInput.value.toLowerCase();
            const sortOption = elements.sortOptions.value;
            
            let filtered = state.products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                     (product.description && product.description.toLowerCase().includes(searchTerm));
                const matchesCategory = state.currentCategory === 'all' ? !!product.featured : (product.category === state.currentCategory);
                return matchesSearch && matchesCategory;
            });
            
            filtered.sort((a, b) => {
                const indexA = state.siteSettings.productOrder.indexOf(a.id);
                const indexB = state.siteSettings.productOrder.indexOf(b.id);
                
                if (indexA === -1 && indexB === -1) return 0;
                if (indexA === -1) return 1;
                if (indexB === -1) return -1;
                
                return indexA - indexB;
            });
            
            filtered.sort((a, b) => {
                switch (sortOption) {
                    case 'price-low': return a.sell - b.sell;
                    case 'price-high': return b.sell - a.sell;
                    case 'name': return a.name.localeCompare(b.name, 'ar');
                    case 'stock': return b.stock - a.stock;
                    default: return 0;
                }
            });
            
            state.filteredProducts = filtered;
            displayProducts(filtered);
        }

        // ========== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≥ŸÑÿ© ==========
        // ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑÿ≥ŸÑÿ© ŸÖŸÜ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä (ŸÖŸáŸÖ ÿÆÿµŸàÿµÿßŸã ÿπŸÑŸâ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ ÿ®ÿπÿØ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©)
        function syncCartFromStorage() {
            try {
                const raw = localStorage.getItem('wassam_cart');
                const parsed = raw ? JSON.parse(raw) : [];
                state.cart = Array.isArray(parsed) ? parsed : [];
            } catch (e) {
                state.cart = [];
            }
        }

        function openCartModal() {
            // ‚úÖ ŸÅÿ™ÿ≠ ÿßŸÑÿ≥ŸÑÿ© ÿ®ÿ¥ŸÉŸÑ ÿ¢ŸÖŸÜ (ÿ≠ÿ™Ÿâ ŸÑŸà ÿ™ÿπÿ∑ŸëŸÑ initApp ÿ£Ÿà ŸÅÿ¥ŸÑ Firebase)
            syncCartFromStorage();

            const cartModal = (elements && elements.cartModal) ? elements.cartModal : document.getElementById('cartModal');
            const overlayEl = (elements && elements.overlay) ? elements.overlay : document.getElementById('overlay');

            if (!cartModal) {
                console.error('‚ùå Cart modal not found (#cartModal)');
                return;
            }

            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπ
            if (typeof elements === 'object' && elements) {
                elements.cartModal = cartModal;
                elements.overlay = overlayEl;
            }

            // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ŸÑÿ© (ÿ®ÿØŸàŸÜ ŸÉÿ≥ÿ± ÿßŸÑŸÅÿ™ÿ≠ ŸÑŸà ÿ≠ÿµŸÑ ÿÆÿ∑ÿ£)
            try { updateCart(); } catch (e) { console.warn('‚ö†Ô∏è updateCart failed:', e); }

            cartModal.style.display = 'block';
            cartModal.classList.add('show');
            overlayEl && overlayEl.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCartModal() {
            const cartModal = (elements && elements.cartModal) ? elements.cartModal : document.getElementById('cartModal');
            const overlayEl = (elements && elements.overlay) ? elements.overlay : document.getElementById('overlay');

            if (cartModal) {
                cartModal.style.display = 'none';
                cartModal.classList.remove('show');
            }
            overlayEl && overlayEl.classList.remove('active');
            document.body.style.overflow = '';
        }

        // ‚úÖ ÿ±ÿ®ÿ∑ ŸÅÿ™ÿ≠ ÿßŸÑÿ≥ŸÑÿ© ÿ®ÿ¥ŸÉŸÑ ÿ¥ÿßŸÖŸÑ (ŸäÿπŸÖŸÑ ÿ≠ÿ™Ÿâ ŸÑŸà ÿ™ÿπÿ∑ŸÑ initApp ÿ£Ÿà ŸÑŸÖ ÿ™Ÿèÿ¨ŸáŸëŸéÿ≤ events)
        function bindCartOpenAlways() {
            const tryBind = (el) => {
                if (!el || el.__cartBound) return;
                el.__cartBound = true;

                const handler = (ev) => {
                    try {
                        // ŸÖŸÜÿπ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±/ÿßŸÑŸÜŸÇÿ± ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ÿπŸÑŸâ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ
                        if (ev && typeof ev.preventDefault === 'function') ev.preventDefault();
                        if (ev && typeof ev.stopPropagation === 'function') ev.stopPropagation();
                    } catch (e) {}
                    openCartModal();
                };

                el.addEventListener('click', handler, { passive: false });
                el.addEventListener('touchend', handler, { passive: false });
                el.addEventListener('pointerup', handler, { passive: false });
            };

            // ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
            tryBind(document.getElementById('mCartBtn'));
            tryBind(document.getElementById('cartIcon'));

            // Delegation: ÿ£ŸäŸÇŸàŸÜÿ© ÿ≥ŸÑÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© (ÿ•ŸÜ ŸàŸèÿ¨ÿØÿ™) ÿØÿßÿÆŸÑ ÿßŸÑŸáŸäÿØÿ± ÿ£Ÿà ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿπŸÑŸàŸä
            if (!document.__cartDelegationBound) {
                document.__cartDelegationBound = true;

                const delegated = (ev) => {
                    const t = ev && ev.target ? ev.target.closest('#mCartBtn, #cartIcon, [data-open-cart], .m-cart-btn, .cart-icon, i.fa-shopping-cart, i.fa-cart-shopping') : null;
                    if (!t) return;
                    try {
                        if (typeof ev.preventDefault === 'function') ev.preventDefault();
                        if (typeof ev.stopPropagation === 'function') ev.stopPropagation();
                    } catch (e) {}
                    openCartModal();
                };

                document.addEventListener('click', delegated, { passive: false });
                document.addEventListener('touchend', delegated, { passive: false });
                document.addEventListener('pointerup', delegated, { passive: false });
            }
        }

        // ŸÜŸÅŸëÿ∞ ÿßŸÑÿ±ÿ®ÿ∑ ŸÖÿ®ŸÉÿ±Ÿãÿß (ÿ®ÿØŸàŸÜ ÿßŸÑÿßÿπÿ™ŸÖÿßÿØ ÿπŸÑŸâ initApp)
        try { bindCartOpenAlways(); } catch (e) { console.warn(e); }
        document.addEventListener('DOMContentLoaded', () => {
            try { bindCartOpenAlways(); } catch (e) { console.warn(e); }
        });




        function addToCart(product) {
            const existingItem = state.cart.find(item => item.id === product.id);
            
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity += 1;
                } else {
                    alert(`ÿπŸÅŸàÿßŸãÿå ŸÑÿß ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨. ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©: ${product.stock}`);
                    return;
                }
            } else {
                state.cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateCart();
            showNotification(`‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ${product.name} ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©`);
        }

        function updateCart() {
            localStorage.setItem('wassam_cart', JSON.stringify(state.cart));
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
            elements.cartCount.textContent = totalItems;
            if (elements.mCartCount) elements.mCartCount.textContent = totalItems;
            updateCartDisplay();
            updateOrderSummary();
        }

        function updateCartDisplay() {
            elements.cartItems.innerHTML = '';
            
            if (state.cart.length === 0) {
                elements.cartItems.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ÿ≥ŸÑÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ ŸÅÿßÿ±ÿ∫ÿ©</p>';
                return;
            }
            
            state.cart.forEach(item => {
                const itemTotal = item.sell * item.quantity;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image">
                        <img src="${item.image || 'https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'}" 
                             alt="${item.name}" 
                             onerror="this.src='https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'">
                    </div>
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${item.sell} ÿØŸäŸÜÿßÿ±</div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn decrease-btn" data-id="${item.id}">-</button>
                            <span>${item.quantity}</span>
                            <button class="quantity-btn increase-btn" data-id="${item.id}">+</button>
                        </div>
                    </div>
                    <button class="remove-item" data-id="${item.id}" title="ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                elements.cartItems.appendChild(cartItem);
            });
            
            // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©
            elements.cartItems.querySelectorAll('.decrease-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    updateCartItemQuantity(id, -1);
                });
            });
            
            elements.cartItems.querySelectorAll('.increase-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.closest('button').dataset.id;
                    updateCartItemQuantity(id, 1);
                });
            });
            
            elements.cartItems.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.closest('button').dataset.id;
                    removeFromCart(id);
                });
            });
        }

        function updateCartItemQuantity(id, change) {
            const item = state.cart.find(item => item.id === id);
            if (!item) return;
            
            const product = state.products.find(p => p.id === id);
            if (!product) return;
            
            const newQuantity = item.quantity + change;
            
            if (newQuantity < 1) {
                removeFromCart(id);
            } else if (newQuantity > product.stock) {
                alert(`ÿπŸÅŸàÿßŸãÿå ŸÑÿß ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨. ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©: ${product.stock}`);
            } else {
                item.quantity = newQuantity;
                updateCart();
            }
        }

        function removeFromCart(id) {
            state.cart = state.cart.filter(item => item.id !== id);
            updateCart();
            showNotification('‚úÖ ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©');
        }

        function updateOrderSummary() {
            const subtotal = state.cart.reduce((sum, item) => sum + (item.sell * item.quantity), 0);
            const shipping = state.shippingMethod === 'delivery' ? 2 : 0;
            const total = subtotal + shipping;
            
            elements.subtotalPrice.textContent = `${subtotal.toFixed(2)} ÿØŸäŸÜÿßÿ±`;
            elements.shippingFee.textContent = `${shipping.toFixed(2)} ÿØŸäŸÜÿßÿ±`;
            elements.totalPrice.textContent = `${total.toFixed(2)} ÿØŸäŸÜÿßÿ±`;
        }

        function validateCustomerInfo() {
            const name = elements.customerName.value.trim();
            const phone = elements.customerPhone.value.trim();
            const address = elements.customerAddress.value.trim();
            
            if (!name) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖŸÉ ÿßŸÑŸÉÿßŸÖŸÑ');
                elements.customerName.focus();
                return false;
            }
            
            if (!phone || !/^07\d{8}$/.test(phone)) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅ ÿµÿ≠Ÿäÿ≠ (Ÿäÿ®ÿØÿ£ ÿ®ŸÄ 07 ŸàŸäÿ™ŸÉŸàŸÜ ŸÖŸÜ 10 ÿ£ÿ±ŸÇÿßŸÖ)');
                elements.customerPhone.focus();
                return false;
            }
            
            if (state.shippingMethod === 'delivery' && !address) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ™ŸàÿµŸäŸÑ');
                elements.customerAddress.focus();
                return false;
            }
            
            return true;
        }

        function createOrderMessage() {
            const name = elements.customerName.value.trim();
            const phone = elements.customerPhone.value.trim();
            const address = elements.customerAddress.value.trim();
            const shippingMethod = state.shippingMethod === 'delivery' ? 'ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÑŸÑŸÖŸÜÿ≤ŸÑ' : 'ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ¨ÿ±';
            
            let message = `üì¶ ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ - Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™\n`;
            message += `==========================\n\n`;
            message += `üë§ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿπŸÖŸäŸÑ:\n`;
            message += `ÿßŸÑÿßÿ≥ŸÖ: ${name}\n`;
            message += `ÿßŸÑŸáÿßÿ™ŸÅ: ${phone}\n`;
            message += `ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ: ${shippingMethod}\n`;
            
            if (state.shippingMethod === 'delivery' && address) {
                message += `ÿßŸÑÿπŸÜŸàÿßŸÜ: ${address}\n`;
            }
            
            message += `\nüõí ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©:\n`;
            message += `==========================\n`;
            
            state.cart.forEach((item, index) => {
                const itemTotal = item.sell * item.quantity;
                message += `${index + 1}. ${item.name}\n`;
                message += `   ÿßŸÑŸÉŸÖŸäÿ©: ${item.quantity}\n`;
                message += `   ÿßŸÑÿ≥ÿπÿ±: ${item.sell} ÿØŸäŸÜÿßÿ±\n`;
                message += `   ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${itemTotal.toFixed(2)} ÿØŸäŸÜÿßÿ±\n\n`;
            });
            
            const subtotal = state.cart.reduce((sum, item) => sum + (item.sell * item.quantity), 0);
            const shipping = state.shippingMethod === 'delivery' ? 2 : 0;
            const total = subtotal + shipping;
            
            message += `üí∞ ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ®:\n`;
            message += `==========================\n`;
            message += `ÿ≥ÿπÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™: ${subtotal.toFixed(2)} ÿØŸäŸÜÿßÿ±\n`;
            message += `ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ: ${shipping.toFixed(2)} ÿØŸäŸÜÿßÿ±\n`;
            message += `ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä: ${total.toFixed(2)} ÿØŸäŸÜÿßÿ±\n\n`;
            
            message += `üìû ŸÑŸÑÿ™ŸàÿßÿµŸÑ: 0790781206\n`;
            if (state.storeSettings.whatsappLink) {
                message += `üí¨ Ÿàÿßÿ™ÿ≥ÿßÿ®: ${state.storeSettings.whatsappLink}\n`;
            }
            message += `üìç ÿßŸÑÿπŸÜŸàÿßŸÜ: ÿπŸÖÿßŸÜ - ÿ¥ŸÅÿßÿ®ÿØÿ±ÿßŸÜ\n`;
            message += `‚è∞ ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ: 9:00 ÿµ - 10:00 ŸÖ`;
            
            return message;
        }

        
// ========== ÿßŸÑÿµŸäÿßŸÜÿ© (New) ==========

function normalizeWaLink(input) {
    if (!input) return 'https://wa.me/962790781206';
    const trimmed = input.trim();
    // accept full wa.me link
    if (trimmed.startsWith('http')) return trimmed.replace('00962', '962').replace('+962', '962');
    // accept number formats
    let num = trimmed.replace(/\s+/g,'').replace(/^00/,'').replace(/^\+/,'');
    if (num.startsWith('0')) num = '962' + num.slice(1);
    if (!num.startsWith('962')) num = '962' + num;
    return `https://wa.me/${num}`;
}

function updateContactLinksUI() {
    const wa = normalizeWaLink(state.storeSettings.whatsappLink || 'https://wa.me/962790781206');
    const email = (state.storeSettings.storeEmail || 'wesamelectronics@gmail.com').trim() || 'wesamelectronics@gmail.com';

    if (elements.navWhatsApp) elements.navWhatsApp.href = wa;
    if (elements.navEmail) elements.navEmail.href = `mailto:${email}`;

    // Footer email
    const footerEmailEl = document.getElementById('footerEmail');
    if (footerEmailEl) footerEmailEl.textContent = email;
}

function openModal(modalEl) {
    if (!modalEl) return;
    modalEl.style.display = 'block';
    elements.overlay && (elements.overlay.style.display = 'block');
    document.body.style.overflow = 'hidden';
}

function closeModal(modalEl) {
    if (!modalEl) return;
    modalEl.style.display = 'none';
    elements.overlay && (elements.overlay.style.display = 'none');
    document.body.style.overflow = '';
}

function scrollToSection(sectionEl) {
    if (!sectionEl) return;
    sectionEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function setUploadStatus(text, ok=true) {
    if (!elements.srUploadStatus) return;
    elements.srUploadStatus.style.display = 'block';
    elements.srUploadStatus.textContent = text;
    elements.srUploadStatus.classList.remove('ok','err');
    elements.srUploadStatus.classList.add(ok ? 'ok' : 'err');
}

async function uploadImageExternal(file) {
    // ÿ±ŸÅÿπ ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ∫Ÿäÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ≠ÿßŸÑŸäÿßŸã (ÿ™ŸÖ ÿßÿπÿ™ŸÖÿßÿØ PostImages ŸäÿØŸàŸäÿßŸã)
    throw new Error('AUTO_UPLOAD_DISABLED');
}

function buildServiceRequestMessage(data) {
    const lines = [];
    lines.push('üõ†Ô∏è ÿ∑ŸÑÿ® ÿµŸäÿßŸÜÿ© ÿ¨ÿØŸäÿØ');
    lines.push('==========================');
    lines.push(`üßæ ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®: ${data.requestId}`);
    lines.push(`üë§ ÿßŸÑÿßÿ≥ŸÖ: ${data.customerName}`);
    lines.push(`üìû ÿßŸÑŸáÿßÿ™ŸÅ: ${data.customerPhone}`);
    lines.push(`üß∞ ÿßŸÑÿ¨Ÿáÿßÿ≤: ${data.deviceType}`);
    lines.push(`üìè ÿßŸÑÿ≠ÿ¨ŸÖ: ${data.deviceSize}`);
    lines.push('');
    lines.push('üìù ŸàÿµŸÅ ÿßŸÑÿπÿ∑ŸÑ:');
    lines.push(data.faultDesc);
    lines.push('');

    if (data.imageLink) {
        lines.push(`üñºÔ∏è ÿ±ÿßÿ®ÿ∑ ÿµŸàÿ±ÿ© ÿßŸÑÿπÿ∑ŸÑ: ${data.imageLink}`);
    }
    if (data.locationLink) {
        lines.push(`üìç ÿßŸÑŸÖŸàŸÇÿπ (ÿÆÿ±ÿßÿ¶ÿ∑): ${data.locationLink}`);
    }
    if (data.addressText) {
        lines.push(`üè† ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖÿÆÿ™ÿµÿ±: ${data.addressText}`);
    }

    lines.push('');
    lines.push('‚úÖ ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ŸÖŸÜ ŸÖŸàŸÇÿπ Ÿàÿ≥ÿßŸÖ ŸÑŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™');
    return lines.join('\n');
}

async function saveServiceRequestToFirestore(docData) {
    if (!firebaseInitialized || !db) return; // allow graceful fallback
    try {
        // Prefer server timestamps for consistent ordering
        const ts = getServerTimestamp();

        const payload = {
            ...docData,
            createdAt: docData.createdAt || ts,
            updatedAt: ts
        };

        await db.collection('service_requests').doc(docData.requestId).set(payload, { merge: true });
        return true;
    } catch (e) {
        console.warn('Firestore save service request failed:', e);
        return false;
    }
}


// ===== ÿ£ÿØŸàÿßÿ™ ŸÖÿ≥ÿßÿπÿØÿ© (ŸÑŸÖŸÜÿπ ÿ£ÿÆÿ∑ÿßÿ° HTML) =====
function escapeHtml(input) {
    if (input === null || input === undefined) return '';
    return String(input)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

async function refreshServiceRequests() {
    if (!elements.serviceRequestsTableBody) return;

    // If Firebase not available, show message
    if (!firebaseInitialized || !db) {
        elements.serviceRequestsTableBody.innerHTML = `
            <tr><td colspan="7" style="text-align:center; padding:18px;">
                Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ. ŸÑÿß ŸäŸÖŸÉŸÜ ÿπÿ±ÿ∂ ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ© ÿßŸÑÿ¢ŸÜ.
            </td></tr>`;
        return;
    }

    elements.serviceRequestsTableBody.innerHTML = `
        <tr><td colspan="7" style="text-align:center; padding:18px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</td></tr>`;

    const renderError = (msg) => {
        elements.serviceRequestsTableBody.innerHTML = `
            <tr><td colspan="7" style="text-align:center; padding:18px;">
                ${msg}
            </td></tr>`;
    };

    try {
        // 1) Try ordered query (fast + correct)
        let docs = [];
        try {
            const snap = await db.collection('service_requests')
                .orderBy('createdAt', 'desc')
                .limit(200)
                .get();
            snap.forEach(d => docs.push({ id: d.id, data: d.data() || {} }));
        } catch (orderErr) {
            // 2) Fallback: if createdAt has inconsistent type or missing index, fetch without orderBy and sort in JS
            console.warn('service_requests orderBy failed, falling back to unordered get():', orderErr);
            const snap = await db.collection('service_requests')
                .limit(200)
                .get();
            snap.forEach(d => docs.push({ id: d.id, data: d.data() || {} }));
        }

        if (!docs.length) {
            elements.serviceRequestsTableBody.innerHTML = `
                <tr><td colspan="7" style="text-align:center; padding:18px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ÿµŸäÿßŸÜÿ© ÿ®ÿπÿØ</td></tr>`;
            return;
        }

        // Normalize + sort (newest first)
        docs = docs.map(x => {
            const d = x.data || {};
            const created =
                d.createdAt && d.createdAt.toDate ? d.createdAt.toDate() :
                (typeof d.createdAt === 'number' ? new Date(d.createdAt) :
                 (d.createdAt ? new Date(d.createdAt) : null));
            return { ...x, created };
        }).sort((a,b) => {
            const ta = a.created ? a.created.getTime() : 0;
            const tb = b.created ? b.created.getTime() : 0;
            return tb - ta;
        });

        const rows = [];
        for (const item of docs) {
            const d = item.data || {};
            const created = item.created;
            const createdStr = created ? created.toLocaleString('ar-JO') : '-';
            const status = d.status || 'ÿ¨ÿØŸäÿØ';

            rows.push(`
                <tr data-id="${escapeHtml(d.requestId || item.id)}">
                    <td>${createdStr}</td>
                    <td>${escapeHtml(d.customerName || '')}</td>
                    <td>${escapeHtml(d.customerPhone || '')}</td>
                    <td>${escapeHtml(d.deviceType || '')}</td>
                    <td>${escapeHtml(d.deviceSize || '')}</td>
                    <td>
                        <select class="sr-status-select" style="padding:8px; border-radius:10px; border:1px solid rgba(0,0,0,0.12);">
                            ${['ÿ¨ÿØŸäÿØ','ÿ™ŸÖ ÿßŸÑÿ™ŸàÿßÿµŸÑ','ŸÇŸäÿØ ÿßŸÑÿ™ÿ¨ŸáŸäÿ≤','ÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠','ÿ™ŸÖ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ','ŸÖŸÑÿ∫Ÿä'].map(s => `<option value="${s}" ${s===status?'selected':''}>${s}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary sr-view-btn" type="button">ÿπÿ±ÿ∂</button>
                        <button class="btn btn-sm btn-outline-danger sr-delete-btn" type="button">ÿ≠ÿ∞ŸÅ</button>
                    </td>
                </tr>
            `);
        }

        elements.serviceRequestsTableBody.innerHTML = rows.join('');

        // Wire actions
        elements.serviceRequestsTableBody.querySelectorAll('tr').forEach(row => {
            const id = row.getAttribute('data-id');

            const statusSel = row.querySelector('.sr-status-select');
            if (statusSel) {
                statusSel.addEventListener('change', async () => {
                    const newStatus = statusSel.value;
                    try {
                        await db.collection('service_requests').doc(id).set({ status: newStatus, updatedAt: new Date() }, { merge: true });
                    } catch (e) {
                        alert('ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≠ÿßŸÑÿ©. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ.');
                        console.error(e);
                    }
                });
            }

            const viewBtn = row.querySelector('.sr-view-btn');
            if (viewBtn) {
                viewBtn.addEventListener('click', async () => {
                    try {
                        const doc = await db.collection('service_requests').doc(id).get();
                        if (!doc.exists) return;
                        const d = doc.data() || {};
                        const msg = buildServiceRequestMessage(d);
                        const wa = normalizeWaLink(state.storeSettings.whatsappLink || 'https://wa.me/962790781206');
                        window.open(`${wa}?text=${encodeURIComponent(msg)}`, '_blank');
                    } catch (e) {
                        console.error(e);
                        alert('ÿ™ÿπÿ∞ÿ± ŸÅÿ™ÿ≠ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®.');
                    }
                });
            }

            const delBtn = row.querySelector('.sr-delete-btn');
            if (delBtn) {
                delBtn.addEventListener('click', async () => {
                    if (!confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ®ÿü')) return;
                    try {
                        await db.collection('service_requests').doc(id).delete();
                        refreshServiceRequests();
                    } catch (e) {
                        console.error(e);
                        alert('ÿ™ÿπÿ∞ÿ± ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ŸÑÿ®.');
                    }
                });
            }
        });

    } catch (e) {
        console.error(e);
        const code = e && (e.code || e.message) ? (e.code || e.message) : '';
        renderError(`ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™. ${code ? `<div style="margin-top:8px; opacity:.75; font-size:.9em;">${escapeHtml(String(code))}</div>` : ''}`);
    }
}


        // ========== ÿ•ÿØÿßÿ±ÿ© ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ==========

        function switchTab(tabId) {
            
// ÿ∂ŸÖÿßŸÜ ÿ™ŸàŸÅÿ± ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™/ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ ÿ≠ÿ™Ÿâ ŸÑŸà ÿ™ÿ∫Ÿäÿ± DOM
if (!elements || !elements.adminTabs || typeof elements.adminTabs.forEach !== 'function') {
    try { elements.adminTabs = document.querySelectorAll('.admin-tab'); } catch(e){}
}
if (!elements || !elements.adminSections || typeof elements.adminSections.forEach !== 'function') {
    try { elements.adminSections = document.querySelectorAll('.admin-section'); } catch(e){}
}
elements.adminTabs.forEach(tab => {
                if (tab.dataset.tab === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            elements.adminSections.forEach(section => {
                if (section.id === `${tabId}Section`) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
    // ÿ™ÿ≠ŸÖŸäŸÑ ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ© ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿ™ÿ®ŸàŸäÿ®
    if (tabId === 'serviceRequests') {
        refreshServiceRequests();
    }
}


// === Admin Tabs: binding robust (prevents overlays/forms from breaking clicks) ===
window.switchAdminTab = function(tabId){
    try{
        tabId = (tabId || '').trim();
        if(!tabId) return false;

        // Prefer existing function if available
        if (typeof switchTab === 'function') {
            switchTab(tabId);
        } else {
            // Fallback (manual)
            document.querySelectorAll('.admin-tab').forEach(btn=>{
                const id = btn.getAttribute('data-tab');
                btn.classList.toggle('active', id === tabId);
            });
            document.querySelectorAll('.admin-section').forEach(sec=>{
                sec.classList.toggle('active', sec.id === (tabId + 'Section'));
            });
            if (tabId === 'serviceRequests' && typeof refreshServiceRequests === 'function') {
                refreshServiceRequests();
            }
        }
    }catch(e){
        console.error('switchAdminTab error:', e);
    }
    return false;
};

// Capture clicks early to avoid other handlers/overlays preventing them
document.addEventListener('click', function(e){
    const btn = e.target && e.target.closest ? e.target.closest('.admin-tab') : null;
    if(!btn) return;
    e.preventDefault();
    e.stopPropagation();
    const tabId = btn.getAttribute('data-tab') || (btn.dataset ? btn.dataset.tab : '');
    window.switchAdminTab(tabId);
}, true);

function updateProductsTable() {
            elements.productsTableBody.innerHTML = '';
            
            if (state.products.length === 0) {
                elements.productsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™
                        </td>
                    </tr>
                `;
                return;
            }
            
            state.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="product-image-small">` : 
                            '<i class="fas fa-image" style="color: #ccc; font-size: 1.5rem;"></i>'
                        }
                    </td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.sell} ÿØŸäŸÜÿßÿ±</td>
                    <td>${product.stock}</td>
                    <td>
                        ${product.videoUrl ? 
                            '<i class="fab fa-youtube" style="color: #FF0000;"></i>' : 
                            '<i class="fas fa-times" style="color: #ccc;"></i>'
                        }
                    </td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i> ÿ™ÿπÿØŸäŸÑ
                        </button>
                        <button class="action-btn remove-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i> ÿ≠ÿ∞ŸÅ
                        </button>
                    </td>
                `;
                
                elements.productsTableBody.appendChild(row);
            });
            
            elements.productsTableBody.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').dataset.id;
                    editProduct(productId);
                });
            });
            
            elements.productsTableBody.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').dataset.id;
                    deleteProduct(productId);
                });
            });
        }

        function editProduct(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productPrice').value = product.sell;
            document.getElementById('productStock').value = product.stock;
            if (document.getElementById('productFeatured')) document.getElementById('productFeatured').checked = product.featured === true;
            const pf = document.getElementById('productFeatured');
            if (pf) pf.checked = !!product.featured;
            if (elements.productFeatured) elements.productFeatured.checked = !!product.featured;
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productDeliveryFee').value = product.deliveryFee || 2;
            document.getElementById('productVideoUrl').value = product.videoUrl || '';
            document.getElementById('productImageUrl').value = product.image || '';
            
            elements.additionalImagesContainer.innerHTML = '';
            if (product.additionalImages && product.additionalImages.length > 0) {
                product.additionalImages.forEach(imageUrl => {
                    const inputDiv = document.createElement('div');
                    inputDiv.className = 'form-group additional-image-input';
                    inputDiv.innerHTML = `
                        <input type="url" class="additional-image-url" value="${imageUrl}" 
                               placeholder="https://example.com/image2.jpg">
                    `;
                    elements.additionalImagesContainer.appendChild(inputDiv);
                });
            } else {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'form-group additional-image-input';
                inputDiv.innerHTML = `
                    <input type="url" class="additional-image-url" 
                           placeholder="https://example.com/image2.jpg">
                `;
                elements.additionalImagesContainer.appendChild(inputDiv);
            }
            
            updateImagePreviews();
            
            const saveBtn = elements.addProductForm.querySelector('.save-btn');
            saveBtn.innerHTML = '<i class="fas fa-save"></i> ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÜÿ™ÿ¨';
            saveBtn.dataset.productId = productId;
            
            switchTab('addProduct');
        }

        function clearForm() {
            elements.addProductForm.reset();
            document.getElementById('productDeliveryFee').value = 2;
            document.getElementById('productVideoUrl').value = '';
            elements.additionalImagesContainer.innerHTML = `
                <div class="form-group additional-image-input">
                    <input type="url" class="additional-image-url" 
                           placeholder="https://example.com/image2.jpg">
                </div>
            `;
            elements.imagePreviewContainer.innerHTML = '';
            
            const saveBtn = elements.addProductForm.querySelector('.save-btn');
            saveBtn.innerHTML = '<i class="fas fa-save"></i> ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÜÿ™ÿ¨';
            delete saveBtn.dataset.productId;
        }

        function updateImagePreviews() {
            elements.imagePreviewContainer.innerHTML = '';
            
            const mainImageUrl = document.getElementById('productImageUrl').value.trim();
            if (mainImageUrl && mainImageUrl.startsWith('http')) {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview';
                previewDiv.innerHTML = `
                    <img src="${mainImageUrl}" alt="ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸàÿ±ÿ©">
                    <button class="remove-image" onclick="removeImagePreview(this, 'main')">&times;</button>
                `;
                elements.imagePreviewContainer.appendChild(previewDiv);
            }
            
            const additionalInputs = document.querySelectorAll('.additional-image-url');
            additionalInputs.forEach((input, index) => {
                const imageUrl = input.value.trim();
                if (imageUrl && imageUrl.startsWith('http')) {
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'image-preview';
                    previewDiv.innerHTML = `
                        <img src="${imageUrl}" alt="ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©">
                        <button class="remove-image" onclick="removeImagePreview(this, ${index})">&times;</button>
                    `;
                    elements.imagePreviewContainer.appendChild(previewDiv);
                }
            });
        }

        window.removeImagePreview = function(button, type) {
            if (type === 'main') {
                document.getElementById('productImageUrl').value = '';
            } else {
                const inputs = document.querySelectorAll('.additional-image-url');
                if (inputs[type]) {
                    inputs[type].value = '';
                }
            }
            button.parentElement.remove();
        };

        // ========== ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ==========

        function updateUI() {
            updateCategoryCounts();
            displayCategories();
            updateProductsSectionTitle();
            filterProducts();
            updateCart();
            
            if (state.isAdmin) {
                updateProductsTable();
                displayProductOrderList();
                displayCategoryOrderList();
                displayCategoriesList();
                updateCategoryDropdown();
            }
        }

        function updateCategoryDropdown() {
            elements.productCategory.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ¶ÿ©</option>';
            state.categories.forEach(category => {
                if (category.id !== "all") {
                    elements.productCategory.innerHTML += `<option value="${category.id}">${category.name}</option>`;
                }
            });
        }

        // ========== ÿ•ÿØÿßÿ±ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ==========

        // ‚úÖ ÿ£ÿØŸÖŸÜ ÿπÿ®ÿ± Firebase Auth + ÿ™ÿ≠ŸÉŸÖ ÿ®ÿßŸÑŸàÿßÿ¨Ÿáÿ© Ÿàÿ±ÿ≥ÿßÿ¶ŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
        // ÿ∂ÿπ ÿ•ŸäŸÖŸäŸÑÿßÿ™ ÿßŸÑÿ£ÿØŸÖŸÜ ŸáŸÜÿß (ÿ®ÿØŸàŸÜ ŸÉŸÑŸÖÿßÿ™ ŸÖÿ±Ÿàÿ±)
        const ADMIN_EMAILS = ['wesam@store.store']; // ÿπÿØŸëŸÑŸáÿß ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ

        let _authObserverAttached = false;
        let _authObserverFirstRun = true;

        function setLoginError(msg = '') {
            if (!elements.loginError) return;
            elements.loginError.textContent = msg || 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
            elements.loginError.style.display = msg ? 'block' : 'none';
        }

        function setLoginLoading(isLoading) {
            if (!elements.loginBtn) return;
            elements.loginBtn.disabled = !!isLoading;
            elements.loginBtn.style.opacity = isLoading ? '0.8' : '1';
            const txt = elements.loginBtn.querySelector('.btn-text');
            if (txt) txt.textContent = isLoading ? 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ...' : 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
        }

        function closeLoginModalSafe() {
            if (elements.loginModal) elements.loginModal.style.display = 'none';
            if (elements.overlay) elements.overlay.classList.remove('active');
            try { document.body.style.overflow = 'auto'; } catch (e) {}
        }

        function mapAuthError(err) {
            const code = (err && err.code) ? String(err.code) : '';
            switch (code) {
                case 'auth/invalid-email': return 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠';
                case 'auth/user-not-found': return 'Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ';
                case 'auth/wrong-password': return 'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©';
                case 'auth/too-many-requests': return 'ŸÖÿ≠ÿßŸàŸÑÿßÿ™ ŸÉÿ´Ÿäÿ±ÿ©ÿå ÿ≠ÿßŸàŸÑ ŸÑÿßÿ≠ŸÇÿßŸã';
                case 'auth/network-request-failed': return 'ŸÖÿ¥ŸÉŸÑÿ© ÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™';
                case 'auth/unauthorized-domain': return 'ÿßŸÑÿØŸàŸÖŸäŸÜ ÿ∫Ÿäÿ± ŸÖÿµÿ±ÿ≠ ÿ®Ÿá ŸÅŸä Firebase (ÿ£ÿ∂ŸÅ ÿßŸÑÿØŸàŸÖŸäŸÜ ŸÖŸÜ Authentication > Settings > Authorized domains)';
                case 'auth/operation-not-allowed': return 'ÿ™ÿ≥ÿ¨ŸäŸÑ Email/Password ÿ∫Ÿäÿ± ŸÖŸÅÿπŸëŸÑ ŸÅŸä Firebase (ŸÅÿπŸëŸÑŸá ŸÖŸÜ Authentication > Sign-in method)';
                case 'auth/too-many-requests': return 'ŸÖÿ≠ÿßŸàŸÑÿßÿ™ ŸÉÿ´Ÿäÿ±ÿ© ÿ¨ÿØÿßŸãÿå ÿ≠ÿßŸàŸÑ ŸÑÿßÿ≠ŸÇÿßŸã';
                case 'auth/user-disabled': return 'ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ®';
                default:
                    return (err && err.message) ? 'ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ: ' + err.message : 'ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ';
            }
        }

        function emailInAdminList(email) {
            const e = (email || '').trim().toLowerCase();
            return ADMIN_EMAILS.map(x => String(x).trim().toLowerCase()).includes(e);
        }

        async function checkAdminByAdminsDoc(user) {
            // Ÿáÿ∞Ÿá ÿßŸÑÿÆÿ∑Ÿàÿ© ÿ™ÿ≥ÿßÿπÿØŸÉ ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿ≥ÿ™ÿÆÿØŸÖ rules ÿ™ÿπÿ™ŸÖÿØ ÿπŸÑŸâ /admins/{uid}
            // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÄ rules ŸäŸÖŸÜÿπ ŸÇÿ±ÿßÿ°ÿ© adminsÿå ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑŸÅÿ≠ÿµ ÿ®ÿØŸàŸÜ ŸÉÿ≥ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
            try {
                if (!user || !window.db) return null;
                const snap = await window.db.collection('admins').doc(user.uid).get();
                return !!snap.exists;
            } catch (e) {
                console.warn('admins doc check failed:', e);
                return null;
            }
        }

        async function isFirebaseAdmin(user) {
            if (!user) return false;

            // 1) ÿ£ŸàŸÑÿßŸã: ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ•ŸäŸÖŸäŸÑÿßÿ™ (ÿ≥ÿ±Ÿäÿπ)
            if (emailInAdminList(user.email)) return true;

            // 2) ÿ´ÿßŸÜŸäÿßŸã: ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖÿ≥ÿ™ŸÜÿØ admins (ÿ•ŸÜ ÿ£ŸÖŸÉŸÜ)
            const exists = await checkAdminByAdminsDoc(user);
            if (exists === true) return true;

            return false;
        }

        async function applyAdminMode(isAdmin, options = {}) {
            const announce = !!options.announce;

            state.isAdmin = !!isAdmin;

            if (state.isAdmin) {
                elements.adminPanel && (elements.adminPanel.style.display = 'block');
                if (elements.adminLoginBtn) elements.adminLoginBtn.style.display = 'block';

                // ÿ™ÿ∞ŸÉŸäÿ± ÿßŸÑŸàÿßÿ¨Ÿáÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
                localStorage.setItem('wassam_admin', 'true');

                // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿØŸäÿ±
                try { updateProductsTable(); } catch (e) { console.warn(e); }
                try { await loadStoreSettings(); } catch (e) { console.warn(e); }
                try { await loadSiteSettings(); } catch (e) { console.warn(e); }
                try { displayProductOrderList(); } catch (e) { console.warn(e); }
                try { displayCategoryOrderList(); } catch (e) { console.warn(e); }
                try { displayCategoriesList(); } catch (e) { console.warn(e); }
                try { updateCategoryDropdown(); } catch (e) { console.warn(e); }
                try { refreshServiceRequests(); } catch (e) { console.warn(e); }

                if (announce) showNotification('‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉÿ£ÿØŸÖŸÜ');
            } else {
                elements.adminPanel && (elements.adminPanel.style.display = 'none');
                localStorage.removeItem('wassam_admin');

                if (announce) showNotification('‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨');
            }
        }


        // ===== Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (ÿ≠ÿ≥ÿßÿ®Ÿä) =====
        function setUserAuthError(msg = '') {
            const el1 = document.getElementById('userAuthError');
            const el2 = document.getElementById('userAuthErrorRegister');
            [el1, el2].forEach(el => {
                if (!el) return;
                el.textContent = msg || '';
                el.style.display = msg ? 'block' : 'none';
            });
        }


        function mapUserAuthError(err) {
            const code = (err && err.code) ? String(err.code) : '';
            switch (code) {
                case 'auth/invalid-email': return 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠';
                case 'auth/user-not-found': return 'Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ';
                case 'auth/wrong-password': return 'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©';
                case 'auth/email-already-in-use': return 'Ÿáÿ∞ÿß ÿßŸÑÿ®ÿ±ŸäÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ';
                case 'auth/weak-password': return 'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∂ÿπŸäŸÅÿ©';
                case 'auth/network-request-failed': return 'ŸÖÿ¥ŸÉŸÑÿ© ÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™';
                case 'auth/unauthorized-domain': return 'ÿßŸÑÿØŸàŸÖŸäŸÜ ÿ∫Ÿäÿ± ŸÖÿµÿ±ÿ≠ ÿ®Ÿá ŸÅŸä Firebase (ÿ£ÿ∂ŸÅ ÿßŸÑÿØŸàŸÖŸäŸÜ ŸÖŸÜ Authentication > Settings > Authorized domains)';
                case 'auth/operation-not-allowed': return 'ÿ™ÿ≥ÿ¨ŸäŸÑ Email/Password ÿ∫Ÿäÿ± ŸÖŸÅÿπŸëŸÑ ŸÅŸä Firebase (ŸÅÿπŸëŸÑŸá ŸÖŸÜ Authentication > Sign-in method)';
                case 'auth/too-many-requests': return 'ŸÖÿ≠ÿßŸàŸÑÿßÿ™ ŸÉÿ´Ÿäÿ±ÿ© ÿ¨ÿØÿßŸãÿå ÿ≠ÿßŸàŸÑ ŸÑÿßÿ≠ŸÇÿßŸã';
                default:
                    return (err && err.message) ? 'ÿÆÿ∑ÿ£: ' + err.message : 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£';
            }
        }

        function closeMobileDrawer() {
            const d = document.getElementById('mDrawer');
            const b = document.getElementById('mDrawerBackdrop');
            if (d) { d.classList.remove('open'); d.setAttribute('aria-hidden', 'true'); }
            if (b) { b.classList.remove('show'); }
        }

        async function saveUserProfile(user, profile = {}) {
            if (!firebaseInitialized || !db || !user) return { ok: false, error: 'firebase_not_ready' };
            try {
                const ts = getServerTimestamp();
                const ref = db.collection('users').doc(user.uid);

                // ŸÜÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ createdAt ÿßŸÑŸÇÿØŸäŸÖ ÿ•ŸÜ Ÿàÿ¨ÿØ
                const snap = await ref.get().catch(() => null);
                const existingCreatedAt = (snap && snap.exists && snap.data && snap.data().createdAt) ? snap.data().createdAt : null;

                const payload = {
                    uid: user.uid,
                    email: user.email || '',
                    name: profile.name || (user.displayName || ''),
                    phone: profile.phone || '',
                    updatedAt: ts,
                    createdAt: existingCreatedAt || ts
                };

                await ref.set(payload, { merge: true });
                return { ok: true };
            } catch (e) {
                console.warn('saveUserProfile failed:', e);
                return { ok: false, error: e };
            }
        }

        async function trySaveOrderForUser(channel = 'unknown') {
            try {
                if (!firebaseInitialized || !db) return false;
                if (!state.currentUser) {
                    showNotification('‚ÑπÔ∏è ŸÑÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™ŸÉ ÿØÿßÿÆŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉÿå ÿßŸÅÿ™ÿ≠ "ÿ≠ÿ≥ÿßÿ®Ÿä" Ÿàÿ≥ÿ¨ŸëŸÑ ÿßŸÑÿØÿÆŸàŸÑ', 'info');
                    return false;
                }

                const orderId = `OR-${Date.now()}`;
                const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const shippingFee = state.shippingMethod === 'delivery' ? 2 : 0;
                const total = subtotal + shippingFee;

                const payload = {
                    orderId,
                    userId: (state.currentUser ? state.currentUser.uid : null),
                    userEmail: (state.currentUser ? (state.currentUser.email || '') : ''),
                    customerName: (elements.customerName ? elements.customerName.value : '') || '',
                    customerPhone: (elements.customerPhone ? elements.customerPhone.value : '') || '',
                    shippingMethod: state.shippingMethod,
                    customerAddress: (elements.customerAddress ? elements.customerAddress.value : '') || '',
                    items: state.cart.map(i => ({
                        id: i.id || '',
                        name: i.name || '',
                        price: i.price || 0,
                        quantity: i.quantity || 0
                    })),
                    subtotal,
                    shippingFee,
                    total,
                    channel,
                    status: 'ÿ¨ÿØŸäÿØ',
                    createdAt: getServerTimestamp(),
                    updatedAt: getServerTimestamp()
                };

                await db.collection('orders').doc(orderId).set(payload, { merge: true });
                return true;
            } catch (e) {
                console.warn('save order failed:', e);
                return false;
            }
        }

        function renderMiniItems(container, items, emptyText) {
            if (!container) return;
            if (!items || !items.length) {
                container.innerHTML = `<div class="mini-item"><div class="mini-muted">${escapeHtml(emptyText || 'ŸÑÿß ŸäŸàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿπÿØ')}</div></div>`;
                return;
            }
            container.innerHTML = items.map(it => {
                return `
                    <div class="mini-item">
                        <div class="row">
                            <div><strong>${escapeHtml(it.title || '')}</strong></div>
                            <div class="mini-muted">${escapeHtml(it.right || '')}</div>
                        </div>
                        ${it.lines && it.lines.length ? `<div style="margin-top:8px;" class="mini-muted">${it.lines.map(l=>escapeHtml(l)).join('<br>')}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        async function loadUserAccountData() {
            if (!state.currentUser) return;
            const u = state.currentUser;

            if (elements.accountEmail) elements.accountEmail.textContent = u.email || '';
            if (elements.accountName) elements.accountName.textContent = (state.currentUserProfile && state.currentUserProfile.name) ? state.currentUserProfile.name : (u.displayName || 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ');

            if (!firebaseInitialized || !db) {
                renderMiniItems(elements.userOrdersList, [], 'Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ ÿ≠ÿßŸÑŸäÿßŸã');
                renderMiniItems(elements.userServiceRequestsList, [], 'Firebase ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ ÿ≠ÿßŸÑŸäÿßŸã');
                return;
            }

            try {
                let snap;
                try {
                    snap = await db.collection('orders').where('userId', '==', u.uid).orderBy('createdAt', 'desc').limit(20).get();
                } catch (orderErr) {
                    snap = await db.collection('orders').where('userId', '==', u.uid).limit(20).get();
                }
                const orders = [];
                snap.forEach(doc => {
                    const d = doc.data() || {};
                    orders.push({
                        title: `ÿ∑ŸÑÿ® #${d.orderId || doc.id}`,
                        right: d.status || '',
                        lines: [
                            `ÿßŸÑŸÖÿ¨ŸÖŸàÿπ: ${d.total || 0} ÿØŸäŸÜÿßÿ±`,
                            `ÿßŸÑÿ¥ÿ≠ŸÜ: ${d.shippingMethod === 'delivery' ? 'ÿ™ŸàÿµŸäŸÑ' : 'ÿßÿ≥ÿ™ŸÑÿßŸÖ'}`,
                            `ÿßŸÑŸÇŸÜÿßÿ©: ${d.channel || ''}`
                        ]
                    });
                });
                renderMiniItems(elements.userOrdersList, orders, 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ÿ®ÿπÿØ');
            } catch (e) {
                console.warn(e);
                renderMiniItems(elements.userOrdersList, [], 'ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™');
            }

            try {
                let snap;
                try {
                    snap = await db.collection('service_requests').where('userId', '==', u.uid).orderBy('createdAt', 'desc').limit(20).get();
                } catch (reqErr) {
                    snap = await db.collection('service_requests').where('userId', '==', u.uid).limit(20).get();
                }
                const reqs = [];
                snap.forEach(doc => {
                    const d = doc.data() || {};
                    reqs.push({
                        title: `ÿ∑ŸÑÿ® ÿµŸäÿßŸÜÿ© #${d.requestId || doc.id}`,
                        right: d.status || '',
                        lines: [
                            `${d.deviceType || ''} - ${d.deviceSize || ''}`,
                            `${d.customerPhone || ''}`
                        ]
                    });
                });
                renderMiniItems(elements.userServiceRequestsList, reqs, 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ÿµŸäÿßŸÜÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ© ÿ®ÿπÿØ');
            } catch (e) {
                console.warn(e);
                renderMiniItems(elements.userServiceRequestsList, [], 'ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿµŸäÿßŸÜÿ©');
            }
        }

        async function applyUserState(user, options = {}) {
            state.currentUser = user || null;
            state.currentUserProfile = null;

            if (!user) {
                if (elements.userAccountBtn) elements.userAccountBtn.innerHTML = '<i class="fas fa-user"></i> ÿ≠ÿ≥ÿßÿ®Ÿä';
                if (elements.mUserAccountBtn) elements.mUserAccountBtn.innerHTML = '<i class="fas fa-user"></i> ÿ≠ÿ≥ÿßÿ®Ÿä';
                return;
            }

            try {
                if (firebaseInitialized && db) {
                    const snap = await db.collection('users').doc(user.uid).get();
                    if (snap && snap.exists) state.currentUserProfile = snap.data() || null;
                }
            } catch (e) {
                console.warn('load user profile failed:', e);
            }

            const name = (state.currentUserProfile && state.currentUserProfile.name) ? state.currentUserProfile.name : (user.displayName || 'ÿ≠ÿ≥ÿßÿ®Ÿä');
            if (elements.userAccountBtn) elements.userAccountBtn.innerHTML = '<i class="fas fa-user"></i> ' + escapeHtml(name);
            if (elements.mUserAccountBtn) elements.mUserAccountBtn.innerHTML = '<i class="fas fa-user"></i> ' + escapeHtml(name);

            if (options.announce) showNotification('‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ');
        }


        function setupAuthObserver() {
            if (_authObserverAttached) return;
            _authObserverAttached = true;

            if (!window.auth) {
                console.warn('Auth ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±');
                return;
            }

            window.auth.onAuthStateChanged(async (user) => {
                try {
                    if (!user) {
                        await applyAdminMode(false, { announce: !_authObserverFirstRun });
                        await applyUserState(null, { announce: false });
                        _authObserverFirstRun = false;
                        return;
                    }

                    const ok = await isFirebaseAdmin(user);
                    if (ok) {
                        await applyAdminMode(true, { announce: !_authObserverFirstRun });
                        await applyUserState(user, { announce: false });
                    } else {
                        await applyAdminMode(false, { announce: false });
                        await applyUserState(user, { announce: !_authObserverFirstRun });
                    }} catch (e) {
                    console.warn('Auth observer error:', e);
                } finally {
                    _authObserverFirstRun = false;
                }
            });
        }

        async function handleAdminLogin() {
            const email = (elements.adminEmail ? elements.adminEmail.value.trim() : '');
            const password = elements.adminPassword ? elements.adminPassword.value : '';

            if (!email || !password) {
                setLoginError('ÿ£ÿØÿÆŸÑ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±');
                showNotification('‚ö†Ô∏è ÿ£ŸÉŸÖŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ', 'error');
                return;
            }

            if (!firebaseInitialized || !window.auth) {
                setLoginError('Firebase ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ ÿ≠ÿßŸÑŸäÿßŸã');
                showNotification('‚ùå Firebase ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤', 'error');
                return;
            }

            setLoginError('');
            setLoginLoading(true);

            try {
                const cred = await window.auth.signInWithEmailAndPassword(email, password);
                const user = cred && cred.user;

                const ok = await isFirebaseAdmin(user);

                // ŸÖŸÑÿßÿ≠ÿ∏ÿ© ŸÖŸáŸÖÿ©: ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ™ÿπÿ™ŸÖÿØ ŸÅŸä rules ÿπŸÑŸâ /admins/{uid} ŸÑÿßÿ≤ŸÖ ÿ™ŸÜÿ¥ÿ¶ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ ŸäÿØŸàŸäÿßŸã ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©
                const adminsDocExists = await checkAdminByAdminsDoc(user);
                if (adminsDocExists === false) {
                    // ÿ•ÿ∞ÿß ÿ£ŸÖŸÉŸÜ ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ Ÿàÿ´ÿ®ÿ™ ÿ£ŸÜŸá ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ -> ŸÑÿß ŸÜÿ≥ŸÖÿ≠ ÿ®ÿßŸÑÿØÿÆŸàŸÑ ŸÉÿ£ÿØŸÖŸÜ
                    await window.auth.signOut();
                    setLoginError('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑÿå ŸÑŸÉŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ£ÿØŸÖŸÜ ÿ∫Ÿäÿ± ŸÖŸÅÿπŸëŸÑÿ© (ÿ£ÿ∂ŸÅ ŸÖÿ≥ÿ™ŸÜÿØ admins)');
                    showNotification('‚ö†Ô∏è ÿ£ŸÜÿ¥ÿ¶ /admins/UID ŸÅŸä Firestore ŸÑÿ™ŸÅÿπŸäŸÑ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ£ÿØŸÖŸÜ', 'error');
                    showConnectionMessage('error', 'ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ£ÿØŸÖŸÜ ÿ∫Ÿäÿ± ŸÖŸÅÿπŸëŸÑÿ©');
                    return;
                }

                if (!ok) {
                    await window.auth.signOut();
                    setLoginError('Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ® ŸÑŸäÿ≥ ŸÑÿØŸäŸá ÿµŸÑÿßÿ≠Ÿäÿ© ÿ£ÿØŸÖŸÜ');
                    showNotification('‚ùå Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ® ŸÑŸäÿ≥ ÿ£ÿØŸÖŸÜ', 'error');
                    showConnectionMessage('error', 'ÿ™ŸÖ ÿ±ŸÅÿ∂ ÿßŸÑÿØÿÆŸàŸÑ: ŸÑŸäÿ≥ ÿ£ÿØŸÖŸÜ');
                    return;
                }

                // ŸÜÿ¨ÿßÿ≠
                await applyAdminMode(true, { announce: true });
                closeLoginModalSafe();

                // ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿ¨ÿßÿ≠ Ÿàÿßÿ∂ÿ≠ÿ©
                showConnectionMessage('success', 'ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉÿ£ÿØŸÖŸÜ ŸÅŸä Firebase');

            } catch (err) {
                const msg = mapAuthError(err);
                setLoginError(msg);
                showNotification('‚ùå ' + msg, 'error');
                showConnectionMessage('error', msg);
            } finally {
                setLoginLoading(false);
                if (elements.adminPassword) elements.adminPassword.value = '';
            }
        }

        async function handleAdminLogout() {
    try {
        if (window.auth) await window.auth.signOut();
    } catch (e) {
        console.warn('signOut failed:', e);
    }
    await applyAdminMode(false, { announce: true });
    showConnectionMessage('info', 'ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨');
}

// ===== ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (ÿ™ÿ≥ÿ¨ŸäŸÑ / ÿ•ŸÜÿ¥ÿßÿ° / ÿÆÿ±Ÿàÿ¨) =====
async function handleUserLogin() {
    if (!firebaseInitialized || !window.auth) {
        setUserAuthError('Firebase ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ ÿ≠ÿßŸÑŸäÿßŸã');
        showNotification('‚ùå Firebase ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤', 'error');
        return;
    }

    const email = (elements.userEmailLogin ? elements.userEmailLogin.value.trim() : '');
    const password = elements.userPasswordLogin ? elements.userPasswordLogin.value : '';

    if (!email || !password) {
        setUserAuthError('ÿ£ÿØÿÆŸÑ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±');
        return;
    }

    // ŸÖÿ§ÿ¥ÿ± ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
    const btn = elements.userLoginBtn;
    const oldText = btn ? btn.innerHTML : '';
    if (btn) { btn.disabled = true; btn.innerHTML = '<span class="btn-text">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ...</span>'; }

    setUserAuthError('');
    try {
        await window.auth.signInWithEmailAndPassword(email, password);

        // ÿ£ÿ∫ŸÑŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ
        if (elements.userAuthModal) elements.userAuthModal.style.display = 'none';
        if (elements.overlay) elements.overlay.classList.remove('active');

        showNotification('‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ');

        // ÿßŸÅÿ™ÿ≠ ÿ≠ÿ≥ÿßÿ®Ÿä ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        try {
            if (elements.userAccountModal) {
                elements.userAccountModal.style.display = 'block';
                if (elements.overlay) elements.overlay.classList.add('active');
                await loadUserAccountData();
            }
        } catch (e) {
            console.warn(e);
        }

    } catch (err) {
        const msg = mapUserAuthError(err);
        setUserAuthError(msg);
        showNotification('‚ùå ' + msg, 'error');
    } finally {
        if (elements.userPasswordLogin) elements.userPasswordLogin.value = '';
        if (btn) { btn.disabled = false; btn.innerHTML = oldText; }
    }
}

async function handleUserRegister() {
    if (!firebaseInitialized || !window.auth) {
        setUserAuthError('Firebase ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤ ÿ≠ÿßŸÑŸäÿßŸã');
        showNotification('‚ùå Firebase ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤', 'error');
        return;
    }

    const name = (elements.userNameRegister ? elements.userNameRegister.value.trim() : '');
    const phone = (elements.userPhoneRegister ? elements.userPhoneRegister.value.trim() : '');
    const email = (elements.userEmailRegister ? elements.userEmailRegister.value.trim() : '');
    const password = elements.userPasswordRegister ? elements.userPasswordRegister.value : '';

    if (!email || !password) {
        setUserAuthError('ÿ£ÿØÿÆŸÑ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±');
        return;
    }
    if (password.length < 6) {
        setUserAuthError('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 6 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ');
        return;
    }

    const btn = elements.userRegisterBtn;
    const oldText = btn ? btn.innerHTML : '';
    if (btn) { btn.disabled = true; btn.innerHTML = '<span class="btn-text">ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®...</span>'; }

    setUserAuthError('');
    try {
        const cred = await window.auth.createUserWithEmailAndPassword(email, password);
        const user = cred && cred.user;

        // ÿßŸÑÿßÿ≥ŸÖ ÿØÿßÿÆŸÑ Firebase Auth
        if (user && name) {
            try { await user.updateProfile({ displayName: name }); } catch (e) { console.warn(e); }
        }

        // ÿ®ÿ±ŸàŸÅÿßŸäŸÑ ÿØÿßÿÆŸÑ Firestore
        try { await saveUserProfile(user, { name, phone }); } catch (e) { console.warn(e); }

        // ÿ£ÿ∫ŸÑŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ
        if (elements.userAuthModal) elements.userAuthModal.style.display = 'none';
        if (elements.overlay) elements.overlay.classList.remove('active');

        showNotification('‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠');

        // ÿßŸÅÿ™ÿ≠ ÿ≠ÿ≥ÿßÿ®Ÿä ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        try {
            if (elements.userAccountModal) {
                elements.userAccountModal.style.display = 'block';
                if (elements.overlay) elements.overlay.classList.add('active');
                await loadUserAccountData();
            }
        } catch (e) { console.warn(e); }

    } catch (err) {
        const msg = mapUserAuthError(err);
        setUserAuthError(msg);
        showNotification('‚ùå ' + msg, 'error');
    } finally {
        if (elements.userPasswordRegister) elements.userPasswordRegister.value = '';
        if (btn) { btn.disabled = false; btn.innerHTML = oldText; }
    }
}

async function handleUserLogout() {
    try {
        if (window.auth) await window.auth.signOut();
    } catch (e) {
        console.warn('user signOut failed:', e);
    }
    if (elements.userAccountModal) elements.userAccountModal.style.display = 'none';
    if (elements.userAuthModal) elements.userAuthModal.style.display = 'none';
    if (elements.overlay) elements.overlay.classList.remove('active');
    showNotification('‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨');
}

// ========== ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ==========


        function setupEventListeners() {
            
            // ŸÖŸÜÿπ ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸÖÿ±ÿ™ŸäŸÜ
            if (window.__wesamEventsBound) return;
            window.__wesamEventsBound = true;
const bind = (el, ev, fn, opts) => { if(el) el.addEventListener(ev, fn, opts); };

            // ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑŸÅÿ±ÿ≤
            bind(elements.searchInput, 'input', filterProducts);
            bind(elements.sortOptions, 'change', filterProducts);
            
            // ÿßŸÑÿ≥ŸÑÿ©
            bind(elements.cartIcon, 'click', openCartModal);

            // ÿ≤ÿ± ÿßŸÑÿ≥ŸÑÿ© ŸÅŸä ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ
            if (elements.mCartBtn) {
                bind(elements.mCartBtn, 'click', openCartModal);
            }
            
            bind(elements.closeCart, 'click', closeCartModal);
            
            bind(elements.closeGalleryModal, 'click', () => {
                if (elements.galleryModal) elements.galleryModal.style.display = 'none';
                elements.overlay.classList.remove('active');
            });
            
            bind(elements.overlay, 'click', () => {
                closeCartModal();
                if (elements.galleryModal) elements.galleryModal.style.display = 'none';
                if (elements.loginModal) elements.loginModal.style.display = 'none';
                if (elements.userAuthModal) elements.userAuthModal.style.display = 'none';
                if (elements.userAccountModal) elements.userAccountModal.style.display = 'none';
                elements.overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
            
            // ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ¥ÿ≠ŸÜ
            bind(elements.pickupOption, 'click', () => {
                state.shippingMethod = 'pickup';
                elements.pickupOption.classList.add('selected');
                elements.deliveryOption.classList.remove('selected');
                document.getElementById('pickup').checked = true;
                elements.deliveryAddress.classList.remove('show');
                updateOrderSummary();
            });
            
            bind(elements.deliveryOption, 'click', () => {
                state.shippingMethod = 'delivery';
                elements.deliveryOption.classList.add('selected');
                elements.pickupOption.classList.remove('selected');
                document.getElementById('delivery').checked = true;
                elements.deliveryAddress.classList.add('show');
                updateOrderSummary();
            });
            
            // ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸàÿ±
            bind(elements.productImageUrl, 'input', updateImagePreviews);
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿµŸàÿ± ÿ•ÿ∂ÿßŸÅŸäÿ©
            bind(elements.addImageBtn, 'click', () => {
                const inputDiv = document.createElement('div');
                inputDiv.className = 'form-group additional-image-input';
                inputDiv.innerHTML = `
                    <input type="url" class="additional-image-url" 
                           placeholder="https://example.com/image2.jpg">
                `;
                elements.additionalImagesContainer.appendChild(inputDiv);
                
                inputDiv.querySelector('input').addEventListener('input', updateImagePreviews);
            });
            
            // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®
            bind(elements.whatsappOrderBtn, 'click', async () => {
                if (state.cart.length === 0) {
                    alert('ÿ≥ŸÑÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ ŸÅÿßÿ±ÿ∫ÿ©');
                    return;
                }
                if (!validateCustomerInfo()) return;

                try { await trySaveOrderForUser('whatsapp'); } catch(e){ console.warn(e); }

                const orderMessage = createOrderMessage();
                const whatsappUrl = state.storeSettings.whatsappLink || 'https://wa.me/962790781206';
                const finalUrl = `${whatsappUrl}?text=${encodeURIComponent(orderMessage)}`;
                window.open(finalUrl, '_blank');

                state.cart = [];
                updateCart();
                elements.addProductForm.reset();
                elements.deliveryAddress.classList.remove('show');
                elements.pickupOption.click();

                showNotification('‚úÖ ÿ™ŸÖ ŸÅÿ™ÿ≠ Ÿàÿßÿ™ÿ≥ÿßÿ® ŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®. ÿ¥ŸÉÿ±ÿßŸã ŸÑÿ¥ÿ±ÿßÿ¶ŸÉ!');
            });
// ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ÿßŸÑÿ®ÿ±ŸäÿØ
            bind(elements.emailOrderBtn, 'click', async () => {
                if (state.cart.length === 0) {
                    alert('ÿ≥ŸÑÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ ŸÅÿßÿ±ÿ∫ÿ©');
                    return;
                }
                if (!validateCustomerInfo()) return;

                try { await trySaveOrderForUser('email'); } catch(e){ console.warn(e); }

                const orderMessage = createOrderMessage();
                const emailAddress = (state.storeSettings.storeEmail || 'wesamelectronics@gmail.com').trim() || 'wesamelectronics@gmail.com';
                const emailSubject = `ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ ŸÖŸÜ ${elements.customerName.value}`;
                const emailBody = orderMessage;
                const mailtoUrl = `mailto:${emailAddress}?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
                window.location.href = mailtoUrl;

                showNotification('‚úÖ ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®');
            });

            // ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ≠ÿ≥ÿßÿ® (ŸÖÿ≥ÿ™ÿÆÿØŸÖ / ÿ£ÿØŸÖŸÜ)
            const openAdminLoginModal = () => {
                setLoginError('');
                if (elements.adminEmail) elements.adminEmail.value = '';
                if (elements.adminPassword) elements.adminPassword.value = '';
                if (elements.loginModal) elements.loginModal.style.display = 'block';
                if (elements.overlay) elements.overlay.classList.add('active');
                setTimeout(() => { try { if (elements.adminEmail) elements.adminEmail.focus(); else if (elements.adminPassword) elements.adminPassword.focus(); } catch(e){} }, 80);
            };

            const openUserAuthOrAccount = () => {
                if (state.currentUser) {
                    if (elements.userAccountModal) {
                        elements.userAccountModal.style.display = 'block';
                        if (elements.overlay) elements.overlay.classList.add('active');
                        try { loadUserAccountData(); } catch(e){ console.warn(e); }
                    }
                } else {
                    if (elements.userAuthModal) {
                        elements.userAuthModal.style.display = 'block';
                        if (elements.overlay) elements.overlay.classList.add('active');
                        try { setUserAuthError(''); } catch(e){}
                    }
                }
            };

            bind(elements.adminLoginBtn, 'click', openAdminLoginModal);
            bind(elements.mAdminPanelBtn, 'click', () => { try { closeMobileDrawer(); } catch(e){} openAdminLoginModal(); });

            bind(elements.userAccountBtn, 'click', openUserAuthOrAccount);
            bind(elements.mUserAccountBtn, 'click', () => { try { closeMobileDrawer(); } catch(e){} openUserAuthOrAccount(); });

            // ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            const authTabs = document.querySelectorAll('#userAuthModal .auth-tab');
            authTabs.forEach(t => bind(t, 'click', () => {
                authTabs.forEach(x => x.classList.remove('active'));
                t.classList.add('active');
                const tab = t.getAttribute('data-tab');
                const loginPane = document.getElementById('authLoginPane');
                const regPane = document.getElementById('authRegisterPane');
                if (tab === 'register') {
                    if (loginPane) loginPane.style.display = 'none';
                    if (regPane) regPane.style.display = 'block';
                } else {
                    if (loginPane) loginPane.style.display = 'block';
                    if (regPane) regPane.style.display = 'none';
                }
            }));

            // ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            const accountTabs = document.querySelectorAll('#userAccountModal .account-tab');
            accountTabs.forEach(t => bind(t, 'click', () => {
                accountTabs.forEach(x => x.classList.remove('active'));
                t.classList.add('active');
                const tab = t.getAttribute('data-tab');
                const ordersPane = document.getElementById('accountOrdersPane');
                const reqPane = document.getElementById('accountRequestsPane');
                if (tab === 'requests') {
                    if (ordersPane) ordersPane.style.display = 'none';
                    if (reqPane) reqPane.style.display = 'block';
                } else {
                    if (ordersPane) ordersPane.style.display = 'block';
                    if (reqPane) reqPane.style.display = 'none';
                }
            }));
bind(elements.closeLoginModal, 'click', () => {
                elements.loginModal.style.display = 'none';
                elements.overlay.classList.remove('active');
                elements.loginError.style.display = 'none';
                elements.adminPassword.value = '';
            });
            
            
            bind(elements.closeUserAuthModal, 'click', () => {
                if (elements.userAuthModal) elements.userAuthModal.style.display = 'none';
                if (elements.overlay) elements.overlay.classList.remove('active');
                setUserAuthError('');
            });

            bind(elements.closeUserAccountModal, 'click', () => {
                if (elements.userAccountModal) elements.userAccountModal.style.display = 'none';
                if (elements.overlay) elements.overlay.classList.remove('active');
            });

bind(elements.loginBtn, 'click', handleAdminLogin);

            // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            bind(elements.userLoginBtn, 'click', handleUserLogin);
            bind(elements.userRegisterBtn, 'click', handleUserRegister);
            bind(elements.userLogoutBtn, 'click', handleUserLogout);


            // Enter ŸÑŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®ÿ≥ÿ±ÿπÿ©
            bind(elements.adminEmail, 'keydown', (e) => { if (e.key === 'Enter') handleAdminLogin(); });
            bind(elements.adminPassword, 'keydown', (e) => { if (e.key === 'Enter') handleAdminLogin(); });

            
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
            bind(elements.adminLogoutBtn, 'click', handleAdminLogout);
            
            // ÿ≤ÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿ∏ÿßŸáÿ± ÿØÿßÿ¶ŸÖÿßŸã
// ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
            elements.adminTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });
            
            // ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨
            bind(elements.addProductForm, 'submit', async (e) => {
                e.preventDefault();
                
                const productData = {};
                await saveProduct(productData);
            });
            
            // ŸÖÿ≥ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
            document.getElementById('clearFormBtn').addEventListener('click', clearForm);
            
            // ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ¨ÿØŸäÿØ
            bind(elements.addCategoryForm, 'submit', async (e) => {
                e.preventDefault();
                
                const categoryName = elements.newCategoryName.value.trim();
                const categoryIcon = elements.newCategoryIcon.value;
                
                if (!categoryName) {
                    alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿµŸÜŸäŸÅ');
                    return;
                }
                
                await addNewCategory(categoryName, categoryIcon);
            });
            
            // ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿ¨ÿ±
            bind(elements.storeSettingsForm, 'submit', (e) => {
                e.preventDefault();
                saveStoreSettings();
            });
            
            // ÿ≠ŸÅÿ∏ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿµŸÅÿ≠ÿ©
            bind(elements.savePageContentBtn, 'click', savePageContent);
            
            // ÿ≠ŸÅÿ∏ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
            bind(elements.saveProductOrderBtn, 'click', saveProductOrder);
            
            // ÿ≠ŸÅÿ∏ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™
            bind(elements.saveCategoryOrderBtn, 'click', saveCategoryOrder);
            
            // ŸÑŸàÿ≠ÿ© ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖÿØŸäÿ± (ÿßŸÑŸáÿßÿ™ŸÅ)
            bind(elements.openAdminAccess, 'click', () => {
                elements.adminAccessModal.style.display = 'flex';
                elements.overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
            
            bind(elements.closeAdminAccess, 'click', () => {
                elements.adminAccessModal.style.display = 'none';
                elements.overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
            
            bind(elements.accessShowBtn, 'click', () => {
                state.adminButtonVisible = true;
                elements.adminLoginBtn.style.display = 'block';
                elements.adminAccessModal.style.display = 'none';
                elements.overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
                showNotification('üîì ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ÿ≤ÿ± ÿßŸÑŸÖÿØŸäÿ± ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ');
                
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
            
            bind(elements.accessHideBtn, 'click', () => {
                state.adminButtonVisible = false;
                elements.adminLoginBtn.style.display = 'block';
                elements.adminAccessModal.style.display = 'none';
                elements.overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
                showNotification('üîí ÿ™ŸÖ ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑŸÖÿØŸäÿ±');
            });
            
            bind(elements.accessDirectLoginBtn, 'click', () => {
                elements.adminAccessModal.style.display = 'none';
                elements.overlay.classList.remove('active');
                document.body.style.overflow = 'auto';

                // ÿ™ÿ¨ŸáŸäÿ≤ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿØÿÆŸàŸÑ
                if (elements.adminEmail) {
                    elements.adminEmail.value = '';
                }
                setLoginError('');

                elements.loginModal.style.display = 'block';
                elements.overlay.classList.add('active');
                setTimeout(() => { try { if (elements.adminEmail) elements.adminEmail.focus(); else if (elements.adminPassword) elements.adminPassword.focus(); } catch(e){} }, 80);
            });

bind(elements.adminAccessModal, 'click', (e) => {
                if (e.target === elements.adminAccessModal) {
                    elements.adminAccessModal.style.display = 'none';
                    elements.overlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿØÿ´ ŸÑŸÑŸÖÿπÿßŸäŸÜÿ© ÿπŸÜÿØ ŸÉÿ™ÿßÿ®ÿ© ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('additional-image-url')) {
                    updateImagePreviews();
                }
            });
// ====== Service (New) ======
if (elements.navServiceBtn) {
    bind(elements.navServiceBtn, 'click', () => {
        elements.navServiceBtn.classList.add('active');
        elements.navShopBtn && elements.navShopBtn.classList.remove('active');
        scrollToSection(elements.serviceHome);
    });
}
if (elements.navShopBtn) {
    bind(elements.navShopBtn, 'click', () => {
        elements.navShopBtn.classList.add('active');
        elements.navServiceBtn && elements.navServiceBtn.classList.remove('active');
        const shopSection = document.querySelector('.categories-section') || document.querySelector('.products-section');
        scrollToSection(shopSection);
    });
}

if (elements.scrollToShopBtn) {
    bind(elements.scrollToShopBtn, 'click', () => {
        elements.navShopBtn && elements.navShopBtn.click();
    });
}

if (elements.openServiceRequestBtn) {
    bind(elements.openServiceRequestBtn, 'click', () => openModal(elements.serviceRequestModal));
}
if (elements.closeServiceRequestModal) {
    bind(elements.closeServiceRequestModal, 'click', () => closeModal(elements.serviceRequestModal));
}
if (elements.overlay) {
    bind(elements.overlay, 'click', () => {
        // close service modal if open
        if (elements.serviceRequestModal && elements.serviceRequestModal.style.display === 'block') {
            closeModal(elements.serviceRequestModal);
        }
    });
}

if (elements.srClearImageBtn) {
    bind(elements.srClearImageBtn, 'click', () => {
        if (elements.srFaultImage) elements.srFaultImage.value = '';
        if (elements.srImageLink) elements.srImageLink.value = '';
        setUploadStatus('ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿµŸàÿ±ÿ©/ÿßŸÑÿ±ÿßÿ®ÿ∑.', true);
    });
}

if (elements.srUploadImageBtn) {
    bind(elements.srUploadImageBtn, 'click', () => {
        window.open('https://postimages.org/', '_blank', 'noopener');
        setUploadStatus('ÿßŸÅÿ™ÿ≠ PostImagesÿå ÿßÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©ÿå ÿ´ŸÖ ÿßŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ (Hotlink for websites) ŸàÿßŸÑÿµŸÇŸá ŸÅŸä ÿÆÿßŸÜÿ© ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ©.', true);
    });
}

if (elements.srGetLocationBtn) {
    bind(elements.srGetLocationBtn, 'click', () => {
        if (!navigator.geolocation) {
            alert('ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑÿß ŸäÿØÿπŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ.');
            return;
        }
        elements.srGetLocationBtn.disabled = true;
        navigator.geolocation.getCurrentPosition(
            (pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                const gmaps = `https://www.google.com/maps?q=${lat},${lon}`;
                if (elements.srLocationLink) elements.srLocationLink.value = gmaps;
                if (elements.srLocationHint) elements.srLocationHint.textContent = 'ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸàŸÇÿπ ÿ®ŸÜÿ¨ÿßÿ≠ ‚úÖ';
                elements.srGetLocationBtn.disabled = false;
            },
            (err) => {
                console.warn(err);
                alert('ÿ™ÿπÿ∞ÿ± ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖŸàŸÇÿπ. ŸäŸÖŸÉŸÜŸÉ ŸÑÿµŸÇ ÿ±ÿßÿ®ÿ∑ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ£Ÿà ŸÉÿ™ÿßÿ®ÿ© ÿπŸÜŸàÿßŸÜ.');
                elements.srGetLocationBtn.disabled = false;
            },
            { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
        );
    });
}

if (elements.srClearLocationBtn) {
    bind(elements.srClearLocationBtn, 'click', () => {
        if (elements.srLocationLink) elements.srLocationLink.value = '';
        if (elements.srAddressText) elements.srAddressText.value = '';
        if (elements.srLocationHint) elements.srLocationHint.textContent = 'ŸäŸÖŸÉŸÜŸÉ ÿ£Ÿäÿ∂ÿßŸã Ÿàÿ∂ÿπ ÿ±ÿßÿ®ÿ∑ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ£Ÿà ŸÉÿ™ÿßÿ®ÿ© ÿπŸÜŸàÿßŸÜ ŸÖÿÆÿ™ÿµÿ±.';
    });
}

if (elements.serviceRequestForm) {
    bind(elements.serviceRequestForm, 'submit', async (e) => {
        e.preventDefault();

        const customerName = (elements.srCustomerName.value || '').trim();
        const customerPhone = (elements.srCustomerPhone.value || '').trim();
        const deviceType = (elements.srDeviceType.value || '').trim();
        const deviceSize = (elements.srDeviceSize.value || '').trim();
        const faultDesc = (elements.srFaultDesc.value || '').trim();
        const imageLink = (elements.srImageLink ? (elements.srImageLink.value || '').trim() : '');
        const locationLink = (elements.srLocationLink ? (elements.srLocationLink.value || '').trim() : '');
        const addressText = (elements.srAddressText ? (elements.srAddressText.value || '').trim() : '');

        if (!customerName || !customerPhone || !deviceType || !deviceSize || !faultDesc) {
            alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ™ÿπÿ®ÿ¶ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©.');
            return;
        }

        const requestId = `SR-${Date.now()}`;
        const docData = {
            requestId,
            userId: (state.currentUser ? state.currentUser.uid : null),
            userEmail: (state.currentUser ? (state.currentUser.email || '') : ''),
            customerName,
            customerPhone,
            deviceType,
            deviceSize,
            faultDesc,
            imageLink,
            locationLink,
            addressText,
            status: 'ÿ¨ÿØŸäÿØ',
            createdAt: new Date(),
            updatedAt: new Date()
        };

        const savedOk = await saveServiceRequestToFirestore(docData);
        if (!savedOk) {
            alert('ÿ™ÿπÿ∞ÿ± ÿ≠ŸÅÿ∏ ÿ∑ŸÑÿ® ÿßŸÑÿµŸäÿßŸÜÿ© ÿπŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®/ÿ•ŸäŸÖŸäŸÑ ŸÅŸÇÿ∑.');
        }
        const msg = buildServiceRequestMessage(docData);
        const wa = normalizeWaLink(state.storeSettings.whatsappLink || 'https://wa.me/962790781206');
        window.open(`${wa}?text=${encodeURIComponent(msg)}`, '_blank');

        // reset form (keep link if you want? reset all)
        elements.serviceRequestForm.reset();
        if (elements.srUploadStatus) elements.srUploadStatus.style.display = 'none';
        closeModal(elements.serviceRequestModal);

        // refresh table if admin open
        if (state.isAdmin && elements.serviceRequestsTableBody) {
            refreshServiceRequests();
        }
    });
}

if (elements.srEmailBtn) {
    bind(elements.srEmailBtn, 'click', async () => {
        const customerName = (elements.srCustomerName.value || '').trim();
        const customerPhone = (elements.srCustomerPhone.value || '').trim();
        const deviceType = (elements.srDeviceType.value || '').trim();
        const deviceSize = (elements.srDeviceSize.value || '').trim();
        const faultDesc = (elements.srFaultDesc.value || '').trim();
        const imageLink = (elements.srImageLink ? (elements.srImageLink.value || '').trim() : '');
        const locationLink = (elements.srLocationLink ? (elements.srLocationLink.value || '').trim() : '');
        const addressText = (elements.srAddressText ? (elements.srAddressText.value || '').trim() : '');

        if (!customerName || !customerPhone || !deviceType || !deviceSize || !faultDesc) {
            alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ™ÿπÿ®ÿ¶ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©.');
            return;
        }

        const requestId = `SR-${Date.now()}`;
        const msg = buildServiceRequestMessage({ requestId, customerName, customerPhone, deviceType, deviceSize, faultDesc, imageLink, locationLink, addressText });
        const email = (state.storeSettings.storeEmail || 'wesamelectronics@gmail.com').trim() || 'wesamelectronics@gmail.com';
        const subject = encodeURIComponent(`ÿ∑ŸÑÿ® ÿµŸäÿßŸÜÿ© ÿ¨ÿØŸäÿØ - ${requestId}`);
        const body = encodeURIComponent(msg);
        window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
    });
}

if (elements.refreshServiceRequestsBtn) {
    bind(elements.refreshServiceRequestsBtn, 'click', refreshServiceRequests);
}


        }

        // ========== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ==========

        async function initApp() {
    console.log("=== ÿ®ÿØÿ° ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ===");

    showConnectionMessage('info', 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...');

        // ‚úÖ ÿßÿ±ÿ®ÿ∑ ÿ£ÿ≤ÿ±ÿßÿ± (ÿ≠ÿ≥ÿßÿ®Ÿä / ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ) ŸÅŸàÿ±ÿßŸã ÿ≠ÿ™Ÿâ ŸÑŸà ÿ™ÿπÿ∑ŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    try { setupEventListeners(); } catch (e) { console.warn(e); }
    try { updateUI(); } catch (e) { console.warn(e); }

// ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÑŸÑÿ≤Ÿàÿßÿ±
    try { await loadSiteSettings(); } catch (e) { console.warn(e); }
    try { await loadStoreSettings(); } catch (e) { console.warn(e); }
    updateContactLinksUI();
    // ‚úÖ ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ≠ÿßŸÑÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (Firebase Auth)
    try { setupAuthObserver(); } catch (e) { console.warn(e); }

    // ‚úÖ ÿßÿ±ÿ®ÿ∑ ÿßŸÑÿ≥ŸÑÿ© ŸÖÿ®ŸÉÿ±Ÿãÿß ÿØÿßÿ¶ŸÖÿßŸã
    try { bindCartOpenAlways(); } catch (e) { console.warn(e); }

    // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
    try { await loadProducts(); } catch (e) { console.warn('‚ö†Ô∏è loadProducts failed:', e); showConnectionMessage('warning', 'ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ÿå ŸÑŸÉŸÜ ÿßŸÑŸÖŸàŸÇÿπ ŸäÿπŸÖŸÑ'); }

    // ÿ®ŸäÿßŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑŸÖÿØŸäÿ±
    if (state.isAdmin) {
        try { await loadProductOrder(); } catch (e) { console.warn(e); }
        try { await loadSiteSettings(); } catch (e) { console.warn(e); }
        try { await loadStoreSettings(); } catch (e) { console.warn(e); }
    }

    setupEventListeners();
    updateUI();
    // ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑÿ≥ŸÑÿ© ŸÅŸàÿ±ÿßŸã ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàŸÇÿπ (ÿ≠ÿ™Ÿâ ÿ™ÿ∏Ÿáÿ± ÿπŸÜÿßÿµÿ± ÿßŸÑÿ≥ŸÑÿ© ÿπŸÑŸâ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ)
    syncCartFromStorage();
    updateCart();
    elements.pickupOption && elements.pickupOption.click();

    console.log("‚úÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ");
}


        // ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

<!-- Video Modal -->
<script>
/* ===== Video Popup (works for YouTube/Facebook/TikTok/Instagram) ===== */
function openVideoPopup(url){
  url = (url || "").trim();
  if(!url){
    alert("ŸÑÿß ŸäŸàÿ¨ÿØ ÿ±ÿßÿ®ÿ∑ ŸÅŸäÿØŸäŸà ŸÑŸáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨");
    return;
  }
  const w = Math.min(980, screen.width - 40);
  const h = Math.min(620, screen.height - 80);
  const left = Math.max(0, (screen.width - w) / 2);
  const top  = Math.max(0, (screen.height - h) / 2);

  const features =
    `width=${w},height=${h},left=${left},top=${top},` +
    `resizable=yes,scrollbars=yes,noopener,noreferrer`;

  const win = window.open(url, "productVideoPopup", features);
  if(!win){
    window.open(url, "_blank", "noopener,noreferrer");
  }else{
    win.focus();
  }
}

// Delegated click for any video buttons
document.addEventListener('click', function(e){
  const btn = e.target.closest('.video-btn-card, .video-btn');
  if(!btn) return;
  e.preventDefault();
  e.stopPropagation();
  const url = btn.dataset.videoUrl || btn.getAttribute('data-video-url') || btn.getAttribute('href') || '';
  openVideoPopup(url);
}, true);
</script>


<script>
/* ===== Detect platform and color video button ===== */
(function(){
    function detectPlatform(url){
        url = (url || "").toLowerCase();
        if(url.includes("youtube") || url.includes("youtu.be")) return "video-youtube";
        if(url.includes("facebook") || url.includes("fb.watch")) return "video-facebook";
        if(url.includes("tiktok")) return "video-tiktok";
        if(url.includes("instagram")) return "video-instagram";
        return "video-youtube";
    }

    function applyPlatformColors(){
        document.querySelectorAll(".video-btn-card").forEach(btn=>{
            const url = btn.dataset.videoUrl || "";
            const cls = detectPlatform(url);
            btn.classList.add(cls);
        });
    }

    document.addEventListener("DOMContentLoaded", applyPlatformColors);
    setTimeout(applyPlatformColors, 500);
})();
</script>


<script>
/* REMOVED */
document.addEventListener("DOMContentLoaded", function(){
    const socialBox = document.getElementById("socialLinks");
    const navEmail = document.getElementById("navEmail");

    if(socialBox && navEmail){
        const parent = navEmail.parentElement;

        while(socialBox.firstChild){
            const el = socialBox.firstChild;
            el.classList.add("nav-social-inline");
            parent.appendChild(el);
        }

        socialBox.style.display = "none";
    }
});
</script>


<script>
/* ===== Move social buttons next to WhatsApp & Email buttons ===== */
document.addEventListener("DOMContentLoaded", function(){
    const socialBox = document.getElementById("socialLinks");
    const navWhatsApp = document.getElementById("navWhatsApp");
    const navEmail = document.getElementById("navEmail");

    if(!socialBox || !navWhatsApp || !navEmail) return;

    const parent = navWhatsApp.parentElement;

    // insert after email button
    let insertAfter = navEmail.nextSibling;

    while(socialBox.firstChild){
        const el = socialBox.firstChild;
        el.classList.add("nav-social-inline");
        parent.insertBefore(el, insertAfter);
    }

    socialBox.style.display = "none";
});
</script>





<script>
/* ===== Social buttons beside WhatsApp/Email (MutationObserver) ===== */
(function(){
  function navCtaContainer(){
    const wa = document.getElementById("navWhatsApp");
    const email = document.getElementById("navEmail");
    if(!wa || !email) return null;
    return wa.parentElement;
  }

  function getSourceLinks(){
    const box1 = document.getElementById("socialLinks");
    const box2 = document.getElementById("footerSocialLinks");
    const list = [];
    [box1, box2].forEach(box=>{
      if(!box) return;
      box.querySelectorAll("a").forEach(a=>list.push(a));
    });
    return list;
  }

  function alreadyInserted(href){
    const cta = navCtaContainer();
    if(!cta) return false;
    return Array.from(cta.querySelectorAll("a.nav-social-inline")).some(a => (a.getAttribute("href")||"") === href);
  }

  function insertNow(){
    const cta = navCtaContainer();
    const email = document.getElementById("navEmail");
    if(!cta) return false;

    const links = getSourceLinks();
    if(!links.length) return false;

    links.forEach(a=>{
      const href = a.getAttribute("href") || "";
      if(!href) return;
      if(alreadyInserted(href)) return;

      const clone = a.cloneNode(true);
      clone.classList.add("nav-social-inline");

      // Keep platform classes (youtube/facebook/maps/whatsapp) if any
      const cls = a.className || "";
      cls.split(/\s+/).forEach(c=>{
        if(c && c !== "nav-social-inline") clone.classList.add(c);
      });

      clone.removeAttribute("id");
      cta.insertBefore(clone, email ? email.nextSibling : null);
    });

    // hide original containers to "remove" old buttons
    const box1 = document.getElementById("socialLinks");
    const box2 = document.getElementById("footerSocialLinks");
    if(box1) box1.style.display = "none";
    if(box2) box2.style.display = "none";

    return true;
  }

  // Try immediately + retries
  function scheduleTries(){
    let tries = 0;
    const iv = setInterval(()=>{
      tries++;
      if(insertNow() || tries > 20){
        clearInterval(iv);
      }
    }, 500);
  }

  // Observe changes (social links might be created after Firebase/settings load)
  function observe(){
    const targets = [document.body];
    const obs = new MutationObserver(()=>{
      insertNow();
    });
    obs.observe(document.body, {subtree:true, childList:true});
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    scheduleTries();
    observe();
  });

  // also expose for manual call if needed
  window.__insertSocialButtonsToNav = insertNow;
})();
</script>


<script>
(function(){
  function setLinks(){
    const phone = (document.getElementById('phoneNumberHeader')?.textContent || '0790781206').replace(/\D/g,'');
    const wa = 'https://wa.me/962' + (phone.startsWith('0') ? phone.slice(1) : phone);

    const fb = document.querySelector('.social-links a.facebook')?.href || 'https://facebook.com';
    const maps = document.querySelector('.social-links a.map')?.href || 'https://maps.google.com';
    const emailMatch = document.body.innerText.match(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i);
    const email = emailMatch ? 'mailto:' + emailMatch[0] : 'mailto:wesamelectronics@gmail.com';

    const set = (id, link) => { const el = document.getElementById(id); if(el) el.href = link; };

    set('mQSWhatsApp', wa);
    set('mQSFb', fb);
    set('mQSMaps', maps);
    set('mQSEmail', email);

    set('mWhatsAppLink', wa);
    set('mFacebookLink', fb);
    set('mMapsLink', maps);
    set('mEmailLink', email);
  }

  document.addEventListener('DOMContentLoaded', setLinks);
})();
</script>


<!-- ===== 3D BUTTONS + METALLIC LOGO + DARK MODE ===== -->
<style>
/* =========================
   3D BUTTONS (BUY / CTA)
========================= */
.buy-btn, .btn-primary, .btn-secondary, .whatsapp-btn, .email-btn {
  position: relative;
  box-shadow:
    inset 0 2px 3px rgba(255,255,255,0.45),
    inset 0 -3px 5px rgba(0,0,0,0.25),
    0 10px 22px rgba(0,0,0,0.28);
  transition: transform .25s ease, box-shadow .25s ease;
}
.buy-btn:hover, .btn-primary:hover, .btn-secondary:hover,
.whatsapp-btn:hover, .email-btn:hover {
  transform: translateY(-3px) scale(1.04);
  box-shadow:
    inset 0 1px 2px rgba(255,255,255,0.55),
    inset 0 -2px 4px rgba(0,0,0,0.28),
    0 16px 32px rgba(0,0,0,0.38);
}
.buy-btn:active, .btn-primary:active {
  transform: translateY(0) scale(0.98);
  box-shadow:
    inset 0 4px 6px rgba(0,0,0,0.35),
    0 6px 12px rgba(0,0,0,0.3);
}

/* =========================
   METALLIC / EMBOSS LOGO
========================= */
.logo-text, .m-brand-name {
  background: linear-gradient(
    135deg,
    #f5f7fa 0%,
    #e0e0e0 20%,
    #ffffff 40%,
    #cfcfcf 60%,
    #ffffff 80%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow:
    0 1px 0 rgba(255,255,255,0.9),
    0 2px 4px rgba(0,0,0,0.35);
}

/* =========================
   DARK MODE THEME
========================= */
  --light-color: #121212;
  --dark-color: #ffffff;
  --text-color: #eaeaea;
  --border-color: #2c2c2c;
  background-color: #121212;
  color: var(--text-color);
}
.cta::after, .buy-btn::after, .btn-primary::after, .whatsapp-btn::after{
  content:'';
  position:absolute;
  inset:-2px;
  border-radius: inherit;
  background: radial-gradient(60% 60% at 50% 50%,
      rgba(255,152,0,.55),
      rgba(255,152,0,.15) 55%,
      rgba(255,152,0,0) 70%);
  filter: blur(10px);
  opacity:.0;
  transition: opacity .25s ease;
  z-index:-1;
}
.cta:hover::after,
.buy-btn:hover::after,
.btn-primary:hover::after,
.whatsapp-btn:hover::after{
  opacity:1;
}

/* =========================
   MICRO-ANIMATIONS (Premium)
========================= */
@keyframes pressPop {
  0%{ transform: translateY(0) scale(1); }
  40%{ transform: translateY(1px) scale(.98); }
  100%{ transform: translateY(0) scale(1); }
}
@keyframes sheen {
  0%{ background-position: -120% 0; }
  100%{ background-position: 220% 0; }
}
.buy-btn, .btn-primary, .btn-secondary, .whatsapp-btn, .email-btn{
  overflow:hidden;
}
.buy-btn::before, .btn-primary::before, .btn-secondary::before{
  content:'';
  position:absolute;
  top:0; left:-120%;
  width:120%;
  height:100%;
  background: linear-gradient(120deg,
    transparent 0%,
    rgba(255,255,255,.35) 50%,
    transparent 100%);
  transform: skewX(-20deg);
}
.buy-btn:hover::before,
.btn-primary:hover::before,
.btn-secondary:hover::before{
  animation: sheen .9s ease forwards;
}
.buy-btn:active,
.btn-primary:active,
.btn-secondary:active,
.whatsapp-btn:active{
  animation: pressPop .18s ease;
}

/* =========================
   METALLIC LOGO VARIANTS
========================= */
/* Light Metal */
.logo-text.metal-light, .m-brand-name.metal-light{
  background: linear-gradient(135deg,#ffffff,#e6e6e6 30%,#ffffff 55%,#cfcfcf 75%,#ffffff);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  text-shadow: 0 1px 0 rgba(255,255,255,.9), 0 2px 4px rgba(0,0,0,.35);
}
/* Dark Metal */
.logo-text.metal-dark, .m-brand-name.metal-dark{
  background: linear-gradient(135deg,#e0e0e0,#9e9e9e 30%,#f5f5f5 55%,#7a7a7a 75%,#e0e0e0);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  text-shadow: 0 1px 0 rgba(255,255,255,.5), 0 3px 6px rgba(0,0,0,.6);
}

/* =========================
   AUTO DARK MODE (System)
========================= */
/* default follows system */
}
/* manual overrides already supported via .dark on body */
</style>

<!-- ===== SMART NEON + CARD LIFT + GLASS TOP + ADS MODE ===== -->
<style>
/* =========================
   SMART NEON (High Conversion Only)
   Mark buttons with: data-convert="high"
========================= */
[data-convert="high"]{
  position:relative; isolation:isolate;
}
[data-convert="high"]::after{
  content:'';
  position:absolute; inset:-3px; border-radius:inherit;
  background: radial-gradient(60% 60% at 50% 50%,
    rgba(255,152,0,.65),
    rgba(255,152,0,.18) 55%,
    rgba(255,152,0,0) 72%);
  filter: blur(12px);
  opacity:0; transition: opacity .25s ease;
  z-index:-1;
}
[data-convert="high"]:hover::after{ opacity:1; }

/* =========================
   CARD LIFT (Products / Categories / Feature Cards)
========================= */
.card, .product-card, .category-card, .hero-card{
  transition: transform .25s ease, box-shadow .25s ease;
}
.card:hover, .product-card:hover, .category-card:hover, .hero-card:hover{
  transform: translateY(-6px);
  box-shadow: 0 18px 36px rgba(0,0,0,.18);
}

/* =========================
   GLASS / FROSTED TOP SECTIONS
========================= */
.glass{
  background: rgba(255,255,255,.72);
  backdrop-filter: blur(14px) saturate(120%);
  -webkit-backdrop-filter: blur(14px) saturate(120%);
  border: 1px solid rgba(255,255,255,.35);
}
  background: rgba(20,20,20,.65);
  border-color: rgba(255,255,255,.08);
}

/* Apply glass to top areas */
header, .top-nav, .m-topbar{
  background-clip: padding-box;
}
header.glass, .top-nav.glass, .m-topbar.glass{}

/* =========================
   ADS MODE (Lightweight, Focused)
   Activate via URL: ?ads=1
========================= */
body.ads-mode .categories-section,
body.ads-mode footer,
  display:none !important;
}
body.ads-mode .hero{
  padding-top: 10px;
}
body.ads-mode .products-section{
  padding-top: 10px;
}
body.ads-mode .buy-btn{
  font-size:1.05rem;
}
</style>

<script>
/* ===== Runtime Enhancements ===== */
(function(){
  // Add glass class to top sections
  document.querySelectorAll('header, .top-nav, .m-topbar').forEach(el=>el.classList.add('glass'));

  // Auto-mark highest conversion buttons if not set
  document.querySelectorAll('.buy-btn, .btn-primary, .whatsapp-btn').forEach(btn=>{
    if(!btn.hasAttribute('data-convert')) btn.setAttribute('data-convert','high');
  });

  // Ads mode by query
  const params = new URLSearchParams(location.search);
  if(params.get('ads')==='1'){
    document.body.classList.add('ads-mode');
  }
})();
</script>


<!-- ===== COLLAPSIBLE / EXPAND SERVICE FORM ===== -->
<style>
/* Wrapper */
.service-card.collapsible {
  transition: all .35s ease;
}

/* Header clickable */
.form-toggle {
  display:flex;
  align-items:center;
  justify-content:space-between;
  cursor:pointer;
  user-select:none;
  padding:10px 12px;
  border-radius:12px;
  background: rgba(0,0,0,0.03);
  margin-bottom:8px;
}
.form-toggle h3{
  margin:0;
  font-size:1rem;
}
.form-toggle i{
  transition: transform .3s ease;
}

/* Body */
.form-body {
  overflow:hidden;
  transition: max-height .45s ease, opacity .35s ease;
  max-height: 0;
  opacity:0;
}

/* Expanded */
.service-card.expanded .form-body{
  max-height: 900px;
  opacity:1;
}
.service-card.expanded .form-toggle i{
  transform: rotate(180deg);
}

/* Compact when collapsed */
.service-card:not(.expanded){
  box-shadow: 0 6px 16px rgba(0,0,0,.12);
}
</style>

<script>
/* ===== Expand / Collapse Logic ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  const card = document.querySelector('.service-card');
  if(!card) return;

  card.classList.add('collapsible');

  const header = document.createElement('div');
  header.className = 'form-toggle';
  header.innerHTML = `
    <h3>ŸÖÿßÿ∞ÿß ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖŸÜŸÉÿü</h3>
    <i class="fas fa-chevron-down"></i>
  `;

  const body = document.createElement('div');
  body.className = 'form-body';

  // move existing children into body
  [...card.children].forEach(ch => body.appendChild(ch));
  card.appendChild(header);
  card.appendChild(body);

  header.addEventListener('click', ()=>{
    card.classList.toggle('expanded');
  });

  // start collapsed on mobile, expanded on desktop
  if(window.innerWidth > 768){
    card.classList.add('expanded');
  }
});
</script>


<!-- ===== AUTO OPEN SERVICE FORM ON BUTTON CLICK ===== -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const serviceCard = document.querySelector('.service-card');
  if(!serviceCard) return;

  // any button/link that should open the form
  const triggers = document.querySelectorAll(
    '[data-open-service], .open-service, .service-btn'
  );

  triggers.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      serviceCard.classList.add('expanded');
      serviceCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });
  });
});
</script>


<!-- ===== ANIMATION PRESETS (LIGHT / STRONG) ===== -->
<style>
:root{
  --lift-y: -6px;
  --lift-shadow: 0 18px 36px rgba(0,0,0,.18);
  --btn-pop: 0.18s;
}
body.anim-strong{
  --lift-y: -12px;
  --lift-shadow: 0 28px 56px rgba(0,0,0,.28);
  --btn-pop: 0.28s;
}
.product-card, .category-card, .hero-card{
  transition: transform .35s ease, box-shadow .35s ease;
}
.product-card:hover, .category-card:hover, .hero-card:hover{
  transform: translateY(var(--lift-y));
  box-shadow: var(--lift-shadow);
}
.buy-btn, .btn-primary, .whatsapp-btn{
  transition: transform .25s ease, box-shadow .25s ease;
}
.buy-btn:active, .btn-primary:active, .whatsapp-btn:active{
  animation: btnPop var(--btn-pop) ease;
}
@keyframes btnPop{
  0%{ transform: scale(1); }
  40%{ transform: scale(.96); }
  100%{ transform: scale(1); }
}
</style>


<!-- ===== GSAP-STYLE TIMELINE (NO LIBRARY) ===== -->
<style>
/* Easing curves */
:root{
  --ease-out: cubic-bezier(.16,1,.3,1);
  --ease-inout: cubic-bezier(.65,0,.35,1);
}

/* Stagger-ready elements */
[data-anim="card"]{
  opacity:0;
  transform: translateY(18px) scale(.98);
}
[data-anim="btn"]{
  transform: translateY(0) scale(1);
}
body.anim-ready [data-anim="card"]{
  animation: cardIn .7s var(--ease-out) forwards;
}
body.anim-ready [data-anim="card"]:nth-child(2){ animation-delay:.08s }
body.anim-ready [data-anim="card"]:nth-child(3){ animation-delay:.16s }
body.anim-ready [data-anim="card"]:nth-child(4){ animation-delay:.24s }

@keyframes cardIn{
  to{
    opacity:1;
    transform: translateY(0) scale(1);
  }
}

/* Button hover micro timeline */
[data-anim="btn"]:hover{
  animation: btnFloat .45s var(--ease-inout);
}
@keyframes btnFloat{
  0%{ transform: translateY(0) scale(1); }
  50%{ transform: translateY(-2px) scale(1.03); }
  100%{ transform: translateY(0) scale(1); }
}
</style>

<script>
/* ===== GSAP-like timeline without library ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  // mark cards automatically
  document.querySelectorAll('.product-card, .category-card, .hero-card')
    .forEach(el=>el.setAttribute('data-anim','card'));

  // mark buttons
  document.querySelectorAll('.buy-btn, .btn-primary, .whatsapp-btn')
    .forEach(el=>el.setAttribute('data-anim','btn'));

  // trigger timeline when in viewport
  const io = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        document.body.classList.add('anim-ready');
        io.disconnect();
      }
    });
  },{threshold:.15});

  io.observe(document.querySelector('main') || document.body);
});
</script>


<!-- ===== LOTTIE-STYLE VECTOR MOTION (NO LOTTIE) ===== -->
<style>
/* SVG Stroke Animation */
[data-lottie="stroke"] path,
[data-lottie="stroke"] circle,
[data-lottie="stroke"] line {
  stroke-dasharray: 1200;
  stroke-dashoffset: 1200;
  animation: drawLine 1.6s cubic-bezier(.16,1,.3,1) forwards;
}
@keyframes drawLine {
  to { stroke-dashoffset: 0; }
}

/* Fill Pop */
[data-lottie="fill"] {
  animation: fillPop .6s ease-out forwards;
  animation-delay: 1.1s;
  opacity:0;
}
@keyframes fillPop {
  to { opacity:1; }
}

/* Bounce Icon */
[data-lottie="bounce"] {
  animation: iconBounce 1.4s cubic-bezier(.34,1.56,.64,1) forwards;
  transform-origin:center;
}
@keyframes iconBounce {
  0%{ transform: scale(.4); opacity:0; }
  60%{ transform: scale(1.15); opacity:1; }
  100%{ transform: scale(1); }
}
</style>

<script>
/* Auto apply Lottie-style animations */
document.addEventListener('DOMContentLoaded', ()=>{
  // SVG logos / icons
  document.querySelectorAll('svg').forEach(svg=>{
    svg.setAttribute('data-lottie','stroke');
  });

  // CTA icons bounce
  document.querySelectorAll('.buy-btn i, .btn-primary i')
    .forEach(i=> i.setAttribute('data-lottie','bounce'));

  // Accent fills
  document.querySelectorAll('.logo-text, .m-brand-name')
    .forEach(el=> el.setAttribute('data-lottie','fill'));
});
</script>


<!-- ‚úÖ Admin Panel Patch (ensures "ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ" works even if other scripts fail) -->
<script>
(function(){
  if (window.__wesamAdminPatchBound) return;
  window.__wesamAdminPatchBound = true;

  const $ = (id) => document.getElementById(id);

  function showMsg(text, ok){
    // Try to use existing notification system if available
    try{
      if (typeof window.showNotification === 'function') return window.showNotification(text);
    }catch(e){}
    // Fallback
    try{ console.log(text); }catch(e){}
    if (!ok) {
      try { alert(text); } catch(e){}
    }
  }

  function setLoginError(msg){
    const el = $('loginError');
    if(!el) return;
    if(msg){
      el.textContent = msg;
      el.style.display = 'block';
    }else{
      el.style.display = 'none';
    }
  }

  function openAdminModal(){
    const modal = $('loginModal');
    const overlay = $('overlay');
    if(modal) modal.style.display = 'block';
    if(overlay) overlay.classList.add('active');
    setLoginError('');
    setTimeout(() => {
      const email = $('adminEmail');
      const pass = $('adminPassword');
      try { (email || pass).focus(); } catch(e){}
    }, 60);
  }

  function closeAdminModal(){
    const modal = $('loginModal');
    const overlay = $('overlay');
    if(modal) modal.style.display = 'none';
    if(overlay) overlay.classList.remove('active');
    setLoginError('');
  }

  function openAdminPanel(){
    const panel = $('adminPanel');
    if(panel) panel.style.display = 'block';
    // close modals/overlays if open
    closeAdminModal();
    // scroll to panel for clarity
    try { panel.scrollIntoView({behavior:'smooth', block:'start'}); } catch(e){}
  }

  function hideAdminPanel(){
    const panel = $('adminPanel');
    if(panel) panel.style.display = 'none';
  }

  async function isCurrentUserAdmin(){
    try{
      const auth = window.auth || (window.firebase && firebase.auth && firebase.auth());
      const db = window.db || (window.firebase && firebase.firestore && firebase.firestore());
      if(!auth || !db) return false;
      const u = auth.currentUser;
      if(!u) return false;
      const doc = await db.collection('admins').doc(u.uid).get();
      return !!(doc && doc.exists);
    }catch(e){
      return false;
    }
  }

  function bindOnce(el, ev, fn){
    if(!el) return;
    const key = '__bound_' + ev;
    if(el[key]) return;
    el[key] = true;
    el.addEventListener(ev, fn);
  }

  async function onAdminButtonClick(ev){
    try{ ev.preventDefault(); ev.stopPropagation(); }catch(e){}
    // If already logged in as admin, open panel directly; otherwise open login modal
    const ok = await isCurrentUserAdmin();
    if(ok) openAdminPanel();
    else openAdminModal();
  }

  async function doAdminLogin(){
    const email = ($('adminEmail') && $('adminEmail').value || '').trim();
    const pass  = ($('adminPassword') && $('adminPassword').value || '');
    if(!email || !pass){
      setLoginError('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±');
      return;
    }

    try{
      const auth = window.auth || (window.firebase && firebase.auth && firebase.auth());
      const db = window.db || (window.firebase && firebase.firestore && firebase.firestore());
      if(!auth || !db){
        setLoginError('Firebase ÿ∫Ÿäÿ± ÿ¨ÿßŸáÿ≤. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ Ÿàÿ•ÿπÿØÿßÿØÿßÿ™ Firebase.');
        return;
      }

      setLoginError('');
      const btn = $('loginBtn');
      const oldText = btn ? btn.innerHTML : '';
      if(btn){
        btn.disabled = true;
        btn.style.opacity = '0.85';
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ...';
      }

      const cred = await auth.signInWithEmailAndPassword(email, pass);
      const uid = cred && cred.user && cred.user.uid;
      if(!uid){
        setLoginError('ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ.');
        if(btn){ btn.disabled=false; btn.style.opacity=''; btn.innerHTML=oldText; }
        return;
      }

      const snap = await db.collection('admins').doc(uid).get();
      if(!snap.exists){
        try{ await auth.signOut(); }catch(e){}
        setLoginError('Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ® ŸÑŸäÿ≥ ŸÖÿØŸäÿ±ÿßŸã.');
        if(btn){ btn.disabled=false; btn.style.opacity=''; btn.innerHTML=oldText; }
        return;
      }

      if(btn){ btn.disabled=false; btn.style.opacity=''; btn.innerHTML=oldText; }
      showMsg('‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÉŸÖÿØŸäÿ± ÿ®ŸÜÿ¨ÿßÿ≠', true);
      openAdminPanel();
    }catch(err){
      try{ console.warn(err); }catch(e){}
      setLoginError('ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© ÿ£Ÿà ŸÑÿß ŸäŸàÿ¨ÿØ ÿµŸÑÿßÿ≠Ÿäÿ©.');
      const btn = $('loginBtn');
      if(btn){
        btn.disabled = false;
        btn.style.opacity = '';
        // restore basic label safely
        btn.innerHTML = '<span class="btn-text">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</span>';
      }
    }
  }

  async function doAdminLogout(){
    try{
      const auth = window.auth || (window.firebase && firebase.auth && firebase.auth());
      if(auth) await auth.signOut();
    }catch(e){}
    hideAdminPanel();
    showMsg('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨', true);
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Buttons
    bindOnce($('adminLoginBtn'), 'click', onAdminButtonClick);
    bindOnce($('mAdminPanelBtn'), 'click', onAdminButtonClick);

    // Close modal
    bindOnce($('closeLoginModal'), 'click', (e)=>{ try{e.preventDefault()}catch(_){} closeAdminModal(); });
    const modal = $('loginModal');
    if(modal) bindOnce(modal, 'click', (e)=>{ if(e.target === modal) closeAdminModal(); });

    // Login action
    bindOnce($('loginBtn'), 'click', (e)=>{ try{e.preventDefault()}catch(_){} doAdminLogin(); });

    // Enter key
    const pass = $('adminPassword');
    if(pass) bindOnce(pass, 'keydown', (e)=>{ if(e.key === 'Enter'){ doAdminLogin(); } });

    // Logout in panel
    bindOnce($('adminLogoutBtn'), 'click', (e)=>{ try{e.preventDefault()}catch(_){} doAdminLogout(); });
  });
})();
</script>

</body>
</html>